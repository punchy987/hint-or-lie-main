--- FICHIER : .gitignore ---
node_modules 
.DS_Store 
*.log 
.env 
hint-or-lie-firebase-adminsdk-fbsvc-fcfacbacb.json 
hint-or-lie-firebase-adminsdk-fbsvc-fcfacb4301e.json 
# Firebase keys
hint-or-lie-firebase-adminsdk-*.json
*_serviceaccount*.json
secrets/**
config/firebase-service-account.json


--- FICHIER : pack.js ---
const fs = require('fs');
const path = require('path');

const dirsToScan = ['public', 'routes', 'config', 'utils'];
let output = "STRUCTURE DU PROJET HINT OR LIE\n\n";
let fileCount = 0;

function scan(dir) {
    if (!fs.existsSync(dir)) return;
    const files = fs.readdirSync(dir);
    files.forEach(file => {
        const fullPath = path.join(dir, file);
        if (fs.statSync(fullPath).isDirectory()) {
            if (file !== 'node_modules' && file !== '.git') scan(fullPath);
        } else {
            console.log(`ðŸ“– Lecture de : ${fullPath}`); // Ã‡a va s'afficher dans ton terminal
            const content = fs.readFileSync(fullPath, 'utf8');
            output += `--- FICHIER : ${fullPath} ---\n${content}\n\n`;
            fileCount++;
        }
    });
}

console.log("ðŸš€ Lancement du scan des fichiers...");
dirsToScan.forEach(d => scan(d));

fs.writeFileSync('CONTEXTE_PROJET.txt', output);
console.log(`\nâœ… TerminÃ© ! ${fileCount} fichiers ont Ã©tÃ© regroupÃ©s.`);
console.log("ðŸ‘‰ Regarde maintenant dans ta barre latÃ©rale VS Code : CONTEXTE_PROJET.txt est lÃ  !");


--- FICHIER : package-lock.json ---
{
  "name": "hint-or-lie",
  "version": "1.0.0",
  "lockfileVersion": 3,
  "requires": true,
  "packages": {
    "": {
      "name": "hint-or-lie",
      "version": "1.0.0",
      "license": "ISC",
      "dependencies": {
        "express": "^5.1.0",
        "firebase-admin": "^13.4.0",
        "socket.io": "^4.8.1"
      }
    },
    "node_modules/@fastify/busboy": {
      "version": "3.1.1",
      "resolved": "https://registry.npmjs.org/@fastify/busboy/-/busboy-3.1.1.tgz",
      "integrity": "sha512-5DGmA8FTdB2XbDeEwc/5ZXBl6UbBAyBOOLlPuBnZ/N1SwdH9Ii+cOX3tBROlDgcTXxjOYnLMVoKk9+FXAw0CJw==",
      "license": "MIT"
    },
    "node_modules/@firebase/app-check-interop-types": {
      "version": "0.3.3",
      "resolved": "https://registry.npmjs.org/@firebase/app-check-interop-types/-/app-check-interop-types-0.3.3.tgz",
      "integrity": "sha512-gAlxfPLT2j8bTI/qfe3ahl2I2YcBQ8cFIBdhAQA4I2f3TndcO+22YizyGYuttLHPQEpWkhmpFW60VCFEPg4g5A==",
      "license": "Apache-2.0"
    },
    "node_modules/@firebase/app-types": {
      "version": "0.9.3",
      "resolved": "https://registry.npmjs.org/@firebase/app-types/-/app-types-0.9.3.tgz",
      "integrity": "sha512-kRVpIl4vVGJ4baogMDINbyrIOtOxqhkZQg4jTq3l8Lw6WSk0xfpEYzezFu+Kl4ve4fbPl79dvwRtaFqAC/ucCw==",
      "license": "Apache-2.0"
    },
    "node_modules/@firebase/auth-interop-types": {
      "version": "0.2.4",
      "resolved": "https://registry.npmjs.org/@firebase/auth-interop-types/-/auth-interop-types-0.2.4.tgz",
      "integrity": "sha512-JPgcXKCuO+CWqGDnigBtvo09HeBs5u/Ktc2GaFj2m01hLarbxthLNm7Fk8iOP1aqAtXV+fnnGj7U28xmk7IwVA==",
      "license": "Apache-2.0"
    },
    "node_modules/@firebase/component": {
      "version": "0.7.0",
      "resolved": "https://registry.npmjs.org/@firebase/component/-/component-0.7.0.tgz",
      "integrity": "sha512-wR9En2A+WESUHexjmRHkqtaVH94WLNKt6rmeqZhSLBybg4Wyf0Umk04SZsS6sBq4102ZsDBFwoqMqJYj2IoDSg==",
      "license": "Apache-2.0",
      "dependencies": {
        "@firebase/util": "1.13.0",
        "tslib": "^2.1.0"
      },
      "engines": {
        "node": ">=20.0.0"
      }
    },
    "node_modules/@firebase/database": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/@firebase/database/-/database-1.1.0.tgz",
      "integrity": "sha512-gM6MJFae3pTyNLoc9VcJNuaUDej0ctdjn3cVtILo3D5lpp0dmUHHLFN/pUKe7ImyeB1KAvRlEYxvIHNF04Filg==",
      "license": "Apache-2.0",
      "dependencies": {
        "@firebase/app-check-interop-types": "0.3.3",
        "@firebase/auth-interop-types": "0.2.4",
        "@firebase/component": "0.7.0",
        "@firebase/logger": "0.5.0",
        "@firebase/util": "1.13.0",
        "faye-websocket": "0.11.4",
        "tslib": "^2.1.0"
      },
      "engines": {
        "node": ">=20.0.0"
      }
    },
    "node_modules/@firebase/database-compat": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/@firebase/database-compat/-/database-compat-2.1.0.tgz",
      "integrity": "sha512-8nYc43RqxScsePVd1qe1xxvWNf0OBnbwHxmXJ7MHSuuTVYFO3eLyLW3PiCKJ9fHnmIz4p4LbieXwz+qtr9PZDg==",
      "license": "Apache-2.0",
      "dependencies": {
        "@firebase/component": "0.7.0",
        "@firebase/database": "1.1.0",
        "@firebase/database-types": "1.0.16",
        "@firebase/logger": "0.5.0",
        "@firebase/util": "1.13.0",
        "tslib": "^2.1.0"
      },
      "engines": {
        "node": ">=20.0.0"
      }
    },
    "node_modules/@firebase/database-types": {
      "version": "1.0.16",
      "resolved": "https://registry.npmjs.org/@firebase/database-types/-/database-types-1.0.16.tgz",
      "integrity": "sha512-xkQLQfU5De7+SPhEGAXFBnDryUWhhlFXelEg2YeZOQMCdoe7dL64DDAd77SQsR+6uoXIZY5MB4y/inCs4GTfcw==",
      "license": "Apache-2.0",
      "dependencies": {
        "@firebase/app-types": "0.9.3",
        "@firebase/util": "1.13.0"
      }
    },
    "node_modules/@firebase/logger": {
      "version": "0.5.0",
      "resolved": "https://registry.npmjs.org/@firebase/logger/-/logger-0.5.0.tgz",
      "integrity": "sha512-cGskaAvkrnh42b3BA3doDWeBmuHFO/Mx5A83rbRDYakPjO9bJtRL3dX7javzc2Rr/JHZf4HlterTW2lUkfeN4g==",
      "license": "Apache-2.0",
      "dependencies": {
        "tslib": "^2.1.0"
      },
      "engines": {
        "node": ">=20.0.0"
      }
    },
    "node_modules/@firebase/util": {
      "version": "1.13.0",
      "resolved": "https://registry.npmjs.org/@firebase/util/-/util-1.13.0.tgz",
      "integrity": "sha512-0AZUyYUfpMNcztR5l09izHwXkZpghLgCUaAGjtMwXnCg3bj4ml5VgiwqOMOxJ+Nw4qN/zJAaOQBcJ7KGkWStqQ==",
      "hasInstallScript": true,
      "license": "Apache-2.0",
      "dependencies": {
        "tslib": "^2.1.0"
      },
      "engines": {
        "node": ">=20.0.0"
      }
    },
    "node_modules/@google-cloud/firestore": {
      "version": "7.11.3",
      "resolved": "https://registry.npmjs.org/@google-cloud/firestore/-/firestore-7.11.3.tgz",
      "integrity": "sha512-qsM3/WHpawF07SRVvEJJVRwhYzM7o9qtuksyuqnrMig6fxIrwWnsezECWsG/D5TyYru51Fv5c/RTqNDQ2yU+4w==",
      "license": "Apache-2.0",
      "optional": true,
      "dependencies": {
        "@opentelemetry/api": "^1.3.0",
        "fast-deep-equal": "^3.1.1",
        "functional-red-black-tree": "^1.0.1",
        "google-gax": "^4.3.3",
        "protobufjs": "^7.2.6"
      },
      "engines": {
        "node": ">=14.0.0"
      }
    },
    "node_modules/@google-cloud/paginator": {
      "version": "5.0.2",
      "resolved": "https://registry.npmjs.org/@google-cloud/paginator/-/paginator-5.0.2.tgz",
      "integrity": "sha512-DJS3s0OVH4zFDB1PzjxAsHqJT6sKVbRwwML0ZBP9PbU7Yebtu/7SWMRzvO2J3nUi9pRNITCfu4LJeooM2w4pjg==",
      "license": "Apache-2.0",
      "optional": true,
      "dependencies": {
        "arrify": "^2.0.0",
        "extend": "^3.0.2"
      },
      "engines": {
        "node": ">=14.0.0"
      }
    },
    "node_modules/@google-cloud/projectify": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/@google-cloud/projectify/-/projectify-4.0.0.tgz",
      "integrity": "sha512-MmaX6HeSvyPbWGwFq7mXdo0uQZLGBYCwziiLIGq5JVX+/bdI3SAq6bP98trV5eTWfLuvsMcIC1YJOF2vfteLFA==",
      "license": "Apache-2.0",
      "optional": true,
      "engines": {
        "node": ">=14.0.0"
      }
    },
    "node_modules/@google-cloud/promisify": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/@google-cloud/promisify/-/promisify-4.0.0.tgz",
      "integrity": "sha512-Orxzlfb9c67A15cq2JQEyVc7wEsmFBmHjZWZYQMUyJ1qivXyMwdyNOs9odi79hze+2zqdTtu1E19IM/FtqZ10g==",
      "license": "Apache-2.0",
      "optional": true,
      "engines": {
        "node": ">=14"
      }
    },
    "node_modules/@google-cloud/storage": {
      "version": "7.16.0",
      "resolved": "https://registry.npmjs.org/@google-cloud/storage/-/storage-7.16.0.tgz",
      "integrity": "sha512-7/5LRgykyOfQENcm6hDKP8SX/u9XxE5YOiWOkgkwcoO+cG8xT/cyOvp9wwN3IxfdYgpHs8CE7Nq2PKX2lNaEXw==",
      "license": "Apache-2.0",
      "optional": true,
      "dependencies": {
        "@google-cloud/paginator": "^5.0.0",
        "@google-cloud/projectify": "^4.0.0",
        "@google-cloud/promisify": "<4.1.0",
        "abort-controller": "^3.0.0",
        "async-retry": "^1.3.3",
        "duplexify": "^4.1.3",
        "fast-xml-parser": "^4.4.1",
        "gaxios": "^6.0.2",
        "google-auth-library": "^9.6.3",
        "html-entities": "^2.5.2",
        "mime": "^3.0.0",
        "p-limit": "^3.0.1",
        "retry-request": "^7.0.0",
        "teeny-request": "^9.0.0",
        "uuid": "^8.0.0"
      },
      "engines": {
        "node": ">=14"
      }
    },
    "node_modules/@google-cloud/storage/node_modules/uuid": {
      "version": "8.3.2",
      "resolved": "https://registry.npmjs.org/uuid/-/uuid-8.3.2.tgz",
      "integrity": "sha512-+NYs2QeMWy+GWFOEm9xnn6HCDp0l7QBD7ml8zLUmJ+93Q5NF0NocErnwkTkXVFNiX3/fpC6afS8Dhb/gz7R7eg==",
      "license": "MIT",
      "optional": true,
      "bin": {
        "uuid": "dist/bin/uuid"
      }
    },
    "node_modules/@grpc/grpc-js": {
      "version": "1.13.4",
      "resolved": "https://registry.npmjs.org/@grpc/grpc-js/-/grpc-js-1.13.4.tgz",
      "integrity": "sha512-GsFaMXCkMqkKIvwCQjCrwH+GHbPKBjhwo/8ZuUkWHqbI73Kky9I+pQltrlT0+MWpedCoosda53lgjYfyEPgxBg==",
      "license": "Apache-2.0",
      "optional": true,
      "dependencies": {
        "@grpc/proto-loader": "^0.7.13",
        "@js-sdsl/ordered-map": "^4.4.2"
      },
      "engines": {
        "node": ">=12.10.0"
      }
    },
    "node_modules/@grpc/proto-loader": {
      "version": "0.7.15",
      "resolved": "https://registry.npmjs.org/@grpc/proto-loader/-/proto-loader-0.7.15.tgz",
      "integrity": "sha512-tMXdRCfYVixjuFK+Hk0Q1s38gV9zDiDJfWL3h1rv4Qc39oILCu1TRTDt7+fGUI8K4G1Fj125Hx/ru3azECWTyQ==",
      "license": "Apache-2.0",
      "optional": true,
      "dependencies": {
        "lodash.camelcase": "^4.3.0",
        "long": "^5.0.0",
        "protobufjs": "^7.2.5",
        "yargs": "^17.7.2"
      },
      "bin": {
        "proto-loader-gen-types": "build/bin/proto-loader-gen-types.js"
      },
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/@js-sdsl/ordered-map": {
      "version": "4.4.2",
      "resolved": "https://registry.npmjs.org/@js-sdsl/ordered-map/-/ordered-map-4.4.2.tgz",
      "integrity": "sha512-iUKgm52T8HOE/makSxjqoWhe95ZJA1/G1sYsGev2JDKUSS14KAgg1LHb+Ba+IPow0xflbnSkOsZcO08C7w1gYw==",
      "license": "MIT",
      "optional": true,
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/js-sdsl"
      }
    },
    "node_modules/@opentelemetry/api": {
      "version": "1.9.0",
      "resolved": "https://registry.npmjs.org/@opentelemetry/api/-/api-1.9.0.tgz",
      "integrity": "sha512-3giAOQvZiH5F9bMlMiv8+GSPMeqg0dbaeo58/0SlA9sxSqZhnUtxzX9/2FzyhS9sWQf5S0GJE0AKBrFqjpeYcg==",
      "license": "Apache-2.0",
      "optional": true,
      "engines": {
        "node": ">=8.0.0"
      }
    },
    "node_modules/@protobufjs/aspromise": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/@protobufjs/aspromise/-/aspromise-1.1.2.tgz",
      "integrity": "sha512-j+gKExEuLmKwvz3OgROXtrJ2UG2x8Ch2YZUxahh+s1F2HZ+wAceUNLkvy6zKCPVRkU++ZWQrdxsUeQXmcg4uoQ==",
      "license": "BSD-3-Clause",
      "optional": true
    },
    "node_modules/@protobufjs/base64": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/@protobufjs/base64/-/base64-1.1.2.tgz",
      "integrity": "sha512-AZkcAA5vnN/v4PDqKyMR5lx7hZttPDgClv83E//FMNhR2TMcLUhfRUBHCmSl0oi9zMgDDqRUJkSxO3wm85+XLg==",
      "license": "BSD-3-Clause",
      "optional": true
    },
    "node_modules/@protobufjs/codegen": {
      "version": "2.0.4",
      "resolved": "https://registry.npmjs.org/@protobufjs/codegen/-/codegen-2.0.4.tgz",
      "integrity": "sha512-YyFaikqM5sH0ziFZCN3xDC7zeGaB/d0IUb9CATugHWbd1FRFwWwt4ld4OYMPWu5a3Xe01mGAULCdqhMlPl29Jg==",
      "license": "BSD-3-Clause",
      "optional": true
    },
    "node_modules/@protobufjs/eventemitter": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/@protobufjs/eventemitter/-/eventemitter-1.1.0.tgz",
      "integrity": "sha512-j9ednRT81vYJ9OfVuXG6ERSTdEL1xVsNgqpkxMsbIabzSo3goCjDIveeGv5d03om39ML71RdmrGNjG5SReBP/Q==",
      "license": "BSD-3-Clause",
      "optional": true
    },
    "node_modules/@protobufjs/fetch": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/@protobufjs/fetch/-/fetch-1.1.0.tgz",
      "integrity": "sha512-lljVXpqXebpsijW71PZaCYeIcE5on1w5DlQy5WH6GLbFryLUrBD4932W/E2BSpfRJWseIL4v/KPgBFxDOIdKpQ==",
      "license": "BSD-3-Clause",
      "optional": true,
      "dependencies": {
        "@protobufjs/aspromise": "^1.1.1",
        "@protobufjs/inquire": "^1.1.0"
      }
    },
    "node_modules/@protobufjs/float": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/@protobufjs/float/-/float-1.0.2.tgz",
      "integrity": "sha512-Ddb+kVXlXst9d+R9PfTIxh1EdNkgoRe5tOX6t01f1lYWOvJnSPDBlG241QLzcyPdoNTsblLUdujGSE4RzrTZGQ==",
      "license": "BSD-3-Clause",
      "optional": true
    },
    "node_modules/@protobufjs/inquire": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/@protobufjs/inquire/-/inquire-1.1.0.tgz",
      "integrity": "sha512-kdSefcPdruJiFMVSbn801t4vFK7KB/5gd2fYvrxhuJYg8ILrmn9SKSX2tZdV6V+ksulWqS7aXjBcRXl3wHoD9Q==",
      "license": "BSD-3-Clause",
      "optional": true
    },
    "node_modules/@protobufjs/path": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/@protobufjs/path/-/path-1.1.2.tgz",
      "integrity": "sha512-6JOcJ5Tm08dOHAbdR3GrvP+yUUfkjG5ePsHYczMFLq3ZmMkAD98cDgcT2iA1lJ9NVwFd4tH/iSSoe44YWkltEA==",
      "license": "BSD-3-Clause",
      "optional": true
    },
    "node_modules/@protobufjs/pool": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/@protobufjs/pool/-/pool-1.1.0.tgz",
      "integrity": "sha512-0kELaGSIDBKvcgS4zkjz1PeddatrjYcmMWOlAuAPwAeccUrPHdUqo/J6LiymHHEiJT5NrF1UVwxY14f+fy4WQw==",
      "license": "BSD-3-Clause",
      "optional": true
    },
    "node_modules/@protobufjs/utf8": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/@protobufjs/utf8/-/utf8-1.1.0.tgz",
      "integrity": "sha512-Vvn3zZrhQZkkBE8LSuW3em98c0FwgO4nxzv6OdSxPKJIEKY2bGbHn+mhGIPerzI4twdxaP8/0+06HBpwf345Lw==",
      "license": "BSD-3-Clause",
      "optional": true
    },
    "node_modules/@socket.io/component-emitter": {
      "version": "3.1.2",
      "resolved": "https://registry.npmjs.org/@socket.io/component-emitter/-/component-emitter-3.1.2.tgz",
      "integrity": "sha512-9BCxFwvbGg/RsZK9tjXd8s4UcwR0MWeFQ1XEKIQVVvAGJyINdrqKMcTRyLoK8Rse1GjzLV9cwjWV1olXRWEXVA==",
      "license": "MIT"
    },
    "node_modules/@tootallnate/once": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/@tootallnate/once/-/once-2.0.0.tgz",
      "integrity": "sha512-XCuKFP5PS55gnMVu3dty8KPatLqUoy/ZYzDzAGCQ8JNFCkLXzmI7vNHCR+XpbZaMWQK/vQubr7PkYq8g470J/A==",
      "license": "MIT",
      "optional": true,
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@types/body-parser": {
      "version": "1.19.6",
      "resolved": "https://registry.npmjs.org/@types/body-parser/-/body-parser-1.19.6.tgz",
      "integrity": "sha512-HLFeCYgz89uk22N5Qg3dvGvsv46B8GLvKKo1zKG4NybA8U2DiEO3w9lqGg29t/tfLRJpJ6iQxnVw4OnB7MoM9g==",
      "license": "MIT",
      "dependencies": {
        "@types/connect": "*",
        "@types/node": "*"
      }
    },
    "node_modules/@types/caseless": {
      "version": "0.12.5",
      "resolved": "https://registry.npmjs.org/@types/caseless/-/caseless-0.12.5.tgz",
      "integrity": "sha512-hWtVTC2q7hc7xZ/RLbxapMvDMgUnDvKvMOpKal4DrMyfGBUfB1oKaZlIRr6mJL+If3bAP6sV/QneGzF6tJjZDg==",
      "license": "MIT",
      "optional": true
    },
    "node_modules/@types/connect": {
      "version": "3.4.38",
      "resolved": "https://registry.npmjs.org/@types/connect/-/connect-3.4.38.tgz",
      "integrity": "sha512-K6uROf1LD88uDQqJCktA4yzL1YYAK6NgfsI0v/mTgyPKWsX1CnJ0XPSDhViejru1GcRkLWb8RlzFYJRqGUbaug==",
      "license": "MIT",
      "dependencies": {
        "@types/node": "*"
      }
    },
    "node_modules/@types/cors": {
      "version": "2.8.19",
      "resolved": "https://registry.npmjs.org/@types/cors/-/cors-2.8.19.tgz",
      "integrity": "sha512-mFNylyeyqN93lfe/9CSxOGREz8cpzAhH+E93xJ4xWQf62V8sQ/24reV2nyzUWM6H6Xji+GGHpkbLe7pVoUEskg==",
      "license": "MIT",
      "dependencies": {
        "@types/node": "*"
      }
    },
    "node_modules/@types/express": {
      "version": "4.17.23",
      "resolved": "https://registry.npmjs.org/@types/express/-/express-4.17.23.tgz",
      "integrity": "sha512-Crp6WY9aTYP3qPi2wGDo9iUe/rceX01UMhnF1jmwDcKCFM6cx7YhGP/Mpr3y9AASpfHixIG0E6azCcL5OcDHsQ==",
      "license": "MIT",
      "dependencies": {
        "@types/body-parser": "*",
        "@types/express-serve-static-core": "^4.17.33",
        "@types/qs": "*",
        "@types/serve-static": "*"
      }
    },
    "node_modules/@types/express-serve-static-core": {
      "version": "4.19.6",
      "resolved": "https://registry.npmjs.org/@types/express-serve-static-core/-/express-serve-static-core-4.19.6.tgz",
      "integrity": "sha512-N4LZ2xG7DatVqhCZzOGb1Yi5lMbXSZcmdLDe9EzSndPV2HpWYWzRbaerl2n27irrm94EPpprqa8KpskPT085+A==",
      "license": "MIT",
      "dependencies": {
        "@types/node": "*",
        "@types/qs": "*",
        "@types/range-parser": "*",
        "@types/send": "*"
      }
    },
    "node_modules/@types/http-errors": {
      "version": "2.0.5",
      "resolved": "https://registry.npmjs.org/@types/http-errors/-/http-errors-2.0.5.tgz",
      "integrity": "sha512-r8Tayk8HJnX0FztbZN7oVqGccWgw98T/0neJphO91KkmOzug1KkofZURD4UaD5uH8AqcFLfdPErnBod0u71/qg==",
      "license": "MIT"
    },
    "node_modules/@types/jsonwebtoken": {
      "version": "9.0.10",
      "resolved": "https://registry.npmjs.org/@types/jsonwebtoken/-/jsonwebtoken-9.0.10.tgz",
      "integrity": "sha512-asx5hIG9Qmf/1oStypjanR7iKTv0gXQ1Ov/jfrX6kS/EO0OFni8orbmGCn0672NHR3kXHwpAwR+B368ZGN/2rA==",
      "license": "MIT",
      "dependencies": {
        "@types/ms": "*",
        "@types/node": "*"
      }
    },
    "node_modules/@types/long": {
      "version": "4.0.2",
      "resolved": "https://registry.npmjs.org/@types/long/-/long-4.0.2.tgz",
      "integrity": "sha512-MqTGEo5bj5t157U6fA/BiDynNkn0YknVdh48CMPkTSpFTVmvao5UQmm7uEF6xBEo7qIMAlY/JSleYaE6VOdpaA==",
      "license": "MIT",
      "optional": true
    },
    "node_modules/@types/mime": {
      "version": "1.3.5",
      "resolved": "https://registry.npmjs.org/@types/mime/-/mime-1.3.5.tgz",
      "integrity": "sha512-/pyBZWSLD2n0dcHE3hq8s8ZvcETHtEuF+3E7XVt0Ig2nvsVQXdghHVcEkIWjy9A0wKfTn97a/PSDYohKIlnP/w==",
      "license": "MIT"
    },
    "node_modules/@types/ms": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/@types/ms/-/ms-2.1.0.tgz",
      "integrity": "sha512-GsCCIZDE/p3i96vtEqx+7dBUGXrc7zeSK3wwPHIaRThS+9OhWIXRqzs4d6k1SVU8g91DrNRWxWUGhp5KXQb2VA==",
      "license": "MIT"
    },
    "node_modules/@types/node": {
      "version": "24.2.1",
      "resolved": "https://registry.npmjs.org/@types/node/-/node-24.2.1.tgz",
      "integrity": "sha512-DRh5K+ka5eJic8CjH7td8QpYEV6Zo10gfRkjHCO3weqZHWDtAaSTFtl4+VMqOJ4N5jcuhZ9/l+yy8rVgw7BQeQ==",
      "license": "MIT",
      "dependencies": {
        "undici-types": "~7.10.0"
      }
    },
    "node_modules/@types/qs": {
      "version": "6.14.0",
      "resolved": "https://registry.npmjs.org/@types/qs/-/qs-6.14.0.tgz",
      "integrity": "sha512-eOunJqu0K1923aExK6y8p6fsihYEn/BYuQ4g0CxAAgFc4b/ZLN4CrsRZ55srTdqoiLzU2B2evC+apEIxprEzkQ==",
      "license": "MIT"
    },
    "node_modules/@types/range-parser": {
      "version": "1.2.7",
      "resolved": "https://registry.npmjs.org/@types/range-parser/-/range-parser-1.2.7.tgz",
      "integrity": "sha512-hKormJbkJqzQGhziax5PItDUTMAM9uE2XXQmM37dyd4hVM+5aVl7oVxMVUiVQn2oCQFN/LKCZdvSM0pFRqbSmQ==",
      "license": "MIT"
    },
    "node_modules/@types/request": {
      "version": "2.48.13",
      "resolved": "https://registry.npmjs.org/@types/request/-/request-2.48.13.tgz",
      "integrity": "sha512-FGJ6udDNUCjd19pp0Q3iTiDkwhYup7J8hpMW9c4k53NrccQFFWKRho6hvtPPEhnXWKvukfwAlB6DbDz4yhH5Gg==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "@types/caseless": "*",
        "@types/node": "*",
        "@types/tough-cookie": "*",
        "form-data": "^2.5.5"
      }
    },
    "node_modules/@types/send": {
      "version": "0.17.5",
      "resolved": "https://registry.npmjs.org/@types/send/-/send-0.17.5.tgz",
      "integrity": "sha512-z6F2D3cOStZvuk2SaP6YrwkNO65iTZcwA2ZkSABegdkAh/lf+Aa/YQndZVfmEXT5vgAp6zv06VQ3ejSVjAny4w==",
      "license": "MIT",
      "dependencies": {
        "@types/mime": "^1",
        "@types/node": "*"
      }
    },
    "node_modules/@types/serve-static": {
      "version": "1.15.8",
      "resolved": "https://registry.npmjs.org/@types/serve-static/-/serve-static-1.15.8.tgz",
      "integrity": "sha512-roei0UY3LhpOJvjbIP6ZZFngyLKl5dskOtDhxY5THRSpO+ZI+nzJ+m5yUMzGrp89YRa7lvknKkMYjqQFGwA7Sg==",
      "license": "MIT",
      "dependencies": {
        "@types/http-errors": "*",
        "@types/node": "*",
        "@types/send": "*"
      }
    },
    "node_modules/@types/tough-cookie": {
      "version": "4.0.5",
      "resolved": "https://registry.npmjs.org/@types/tough-cookie/-/tough-cookie-4.0.5.tgz",
      "integrity": "sha512-/Ad8+nIOV7Rl++6f1BdKxFSMgmoqEoYbHRpPcx3JEfv8VRsQe9Z4mCXeJBzxs7mbHY/XOZZuXlRNfhpVPbs6ZA==",
      "license": "MIT",
      "optional": true
    },
    "node_modules/abort-controller": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/abort-controller/-/abort-controller-3.0.0.tgz",
      "integrity": "sha512-h8lQ8tacZYnR3vNQTgibj+tODHI5/+l06Au2Pcriv/Gmet0eaj4TwWH41sO9wnHDiQsEj19q0drzdWdeAHtweg==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "event-target-shim": "^5.0.0"
      },
      "engines": {
        "node": ">=6.5"
      }
    },
    "node_modules/accepts": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/accepts/-/accepts-2.0.0.tgz",
      "integrity": "sha512-5cvg6CtKwfgdmVqY1WIiXKc3Q1bkRqGLi+2W/6ao+6Y7gu/RCwRuAhGEzh5B4KlszSuTLgZYuqFqo5bImjNKng==",
      "license": "MIT",
      "dependencies": {
        "mime-types": "^3.0.0",
        "negotiator": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/agent-base": {
      "version": "7.1.4",
      "resolved": "https://registry.npmjs.org/agent-base/-/agent-base-7.1.4.tgz",
      "integrity": "sha512-MnA+YT8fwfJPgBx3m60MNqakm30XOkyIoH1y6huTQvC0PwZG7ki8NacLBcrPbNoo8vEZy7Jpuk7+jMO+CUovTQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 14"
      }
    },
    "node_modules/ansi-regex": {
      "version": "5.0.1",
      "resolved": "https://registry.npmjs.org/ansi-regex/-/ansi-regex-5.0.1.tgz",
      "integrity": "sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==",
      "license": "MIT",
      "optional": true,
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/ansi-styles": {
      "version": "4.3.0",
      "resolved": "https://registry.npmjs.org/ansi-styles/-/ansi-styles-4.3.0.tgz",
      "integrity": "sha512-zbB9rCJAT1rbjiVDb2hqKFHNYLxgtk8NURxZ3IZwD3F6NtxbXZQCnnSi1Lkx+IDohdPlFp222wVALIheZJQSEg==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "color-convert": "^2.0.1"
      },
      "engines": {
        "node": ">=8"
      },
      "funding": {
        "url": "https://github.com/chalk/ansi-styles?sponsor=1"
      }
    },
    "node_modules/arrify": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/arrify/-/arrify-2.0.1.tgz",
      "integrity": "sha512-3duEwti880xqi4eAMN8AyR4a0ByT90zoYdLlevfrvU43vb0YZwZVfxOgxWrLXXXpyugL0hNZc9G6BiB5B3nUug==",
      "license": "MIT",
      "optional": true,
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/async-retry": {
      "version": "1.3.3",
      "resolved": "https://registry.npmjs.org/async-retry/-/async-retry-1.3.3.tgz",
      "integrity": "sha512-wfr/jstw9xNi/0teMHrRW7dsz3Lt5ARhYNZ2ewpadnhaIp5mbALhOAP+EAdsC7t4Z6wqsDVv9+W6gm1Dk9mEyw==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "retry": "0.13.1"
      }
    },
    "node_modules/asynckit": {
      "version": "0.4.0",
      "resolved": "https://registry.npmjs.org/asynckit/-/asynckit-0.4.0.tgz",
      "integrity": "sha512-Oei9OH4tRh0YqU3GxhX79dM/mwVgvbZJaSNaRk+bshkj0S5cfHcgYakreBjrHwatXKbz+IoIdYLxrKim2MjW0Q==",
      "license": "MIT",
      "optional": true
    },
    "node_modules/base64-js": {
      "version": "1.5.1",
      "resolved": "https://registry.npmjs.org/base64-js/-/base64-js-1.5.1.tgz",
      "integrity": "sha512-AKpaYlHn8t4SVbOHCy+b5+KKgvR4vrsD8vbvrbiQJps7fKDTkjkDry6ji0rUJjC0kzbNePLwzxq8iypo41qeWA==",
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ],
      "license": "MIT"
    },
    "node_modules/base64id": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/base64id/-/base64id-2.0.0.tgz",
      "integrity": "sha512-lGe34o6EHj9y3Kts9R4ZYs/Gr+6N7MCaMlIFA3F1R2O5/m7K06AxfSeO5530PEERE6/WyEg3lsuyw4GHlPZHog==",
      "license": "MIT",
      "engines": {
        "node": "^4.5.0 || >= 5.9"
      }
    },
    "node_modules/bignumber.js": {
      "version": "9.3.1",
      "resolved": "https://registry.npmjs.org/bignumber.js/-/bignumber.js-9.3.1.tgz",
      "integrity": "sha512-Ko0uX15oIUS7wJ3Rb30Fs6SkVbLmPBAKdlm7q9+ak9bbIeFf0MwuBsQV6z7+X768/cHsfg+WlysDWJcmthjsjQ==",
      "license": "MIT",
      "engines": {
        "node": "*"
      }
    },
    "node_modules/body-parser": {
      "version": "2.2.2",
      "resolved": "https://registry.npmjs.org/body-parser/-/body-parser-2.2.2.tgz",
      "integrity": "sha512-oP5VkATKlNwcgvxi0vM0p/D3n2C3EReYVX+DNYs5TjZFn/oQt2j+4sVJtSMr18pdRr8wjTcBl6LoV+FUwzPmNA==",
      "license": "MIT",
      "dependencies": {
        "bytes": "^3.1.2",
        "content-type": "^1.0.5",
        "debug": "^4.4.3",
        "http-errors": "^2.0.0",
        "iconv-lite": "^0.7.0",
        "on-finished": "^2.4.1",
        "qs": "^6.14.1",
        "raw-body": "^3.0.1",
        "type-is": "^2.0.1"
      },
      "engines": {
        "node": ">=18"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/express"
      }
    },
    "node_modules/buffer-equal-constant-time": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/buffer-equal-constant-time/-/buffer-equal-constant-time-1.0.1.tgz",
      "integrity": "sha512-zRpUiDwd/xk6ADqPMATG8vc9VPrkck7T07OIx0gnjmJAnHnTVXNQG3vfvWNuiZIkwu9KrKdA1iJKfsfTVxE6NA==",
      "license": "BSD-3-Clause"
    },
    "node_modules/bytes": {
      "version": "3.1.2",
      "resolved": "https://registry.npmjs.org/bytes/-/bytes-3.1.2.tgz",
      "integrity": "sha512-/Nf7TyzTx6S3yRJObOAV7956r8cr2+Oj8AC5dt8wSP3BQAoeX58NoHyCU8P8zGkNXStjTSi6fzO6F0pBdcYbEg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/call-bind-apply-helpers": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/call-bind-apply-helpers/-/call-bind-apply-helpers-1.0.2.tgz",
      "integrity": "sha512-Sp1ablJ0ivDkSzjcaJdxEunN5/XvksFJ2sMBFfq6x0ryhQV/2b/KwFe21cMpmHtPOSij8K99/wSfoEuTObmuMQ==",
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "function-bind": "^1.1.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/call-bound": {
      "version": "1.0.4",
      "resolved": "https://registry.npmjs.org/call-bound/-/call-bound-1.0.4.tgz",
      "integrity": "sha512-+ys997U96po4Kx/ABpBCqhA9EuxJaQWDQg7295H4hBphv3IZg0boBKuwYpt4YXp6MZ5AmZQnU/tyMTlRpaSejg==",
      "license": "MIT",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.2",
        "get-intrinsic": "^1.3.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/cliui": {
      "version": "8.0.1",
      "resolved": "https://registry.npmjs.org/cliui/-/cliui-8.0.1.tgz",
      "integrity": "sha512-BSeNnyus75C4//NQ9gQt1/csTXyo/8Sb+afLAkzAptFuMsod9HFokGNudZpi/oQV73hnVK+sR+5PVRMd+Dr7YQ==",
      "license": "ISC",
      "optional": true,
      "dependencies": {
        "string-width": "^4.2.0",
        "strip-ansi": "^6.0.1",
        "wrap-ansi": "^7.0.0"
      },
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/color-convert": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/color-convert/-/color-convert-2.0.1.tgz",
      "integrity": "sha512-RRECPsj7iu/xb5oKYcsFHSppFNnsj/52OVTRKb4zP5onXwVF3zVmmToNcOfGC+CRDpfK/U584fMg38ZHCaElKQ==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "color-name": "~1.1.4"
      },
      "engines": {
        "node": ">=7.0.0"
      }
    },
    "node_modules/color-name": {
      "version": "1.1.4",
      "resolved": "https://registry.npmjs.org/color-name/-/color-name-1.1.4.tgz",
      "integrity": "sha512-dOy+3AuW3a2wNbZHIuMZpTcgjGuLU/uBL/ubcZF9OXbDo8ff4O8yVp5Bf0efS8uEoYo5q4Fx7dY9OgQGXgAsQA==",
      "license": "MIT",
      "optional": true
    },
    "node_modules/combined-stream": {
      "version": "1.0.8",
      "resolved": "https://registry.npmjs.org/combined-stream/-/combined-stream-1.0.8.tgz",
      "integrity": "sha512-FQN4MRfuJeHf7cBbBMJFXhKSDq+2kAArBlmRBvcvFE5BB1HZKXtSFASDhdlz9zOYwxh8lDdnvmMOe/+5cdoEdg==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "delayed-stream": "~1.0.0"
      },
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/content-disposition": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/content-disposition/-/content-disposition-1.0.0.tgz",
      "integrity": "sha512-Au9nRL8VNUut/XSzbQA38+M78dzP4D+eqg3gfJHMIHHYa3bg067xj1KxMUWj+VULbiZMowKngFFbKczUrNJ1mg==",
      "license": "MIT",
      "dependencies": {
        "safe-buffer": "5.2.1"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/content-type": {
      "version": "1.0.5",
      "resolved": "https://registry.npmjs.org/content-type/-/content-type-1.0.5.tgz",
      "integrity": "sha512-nTjqfcBFEipKdXCv4YDQWCfmcLZKm81ldF0pAopTvyrFGVbcR6P/VAAd5G7N+0tTr8QqiU0tFadD6FK4NtJwOA==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/cookie": {
      "version": "0.7.2",
      "resolved": "https://registry.npmjs.org/cookie/-/cookie-0.7.2.tgz",
      "integrity": "sha512-yki5XnKuf750l50uGTllt6kKILY4nQ1eNIQatoXEByZ5dWgnKqbnqmTrBE5B4N7lrMJKQ2ytWMiTO2o0v6Ew/w==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/cookie-signature": {
      "version": "1.2.2",
      "resolved": "https://registry.npmjs.org/cookie-signature/-/cookie-signature-1.2.2.tgz",
      "integrity": "sha512-D76uU73ulSXrD1UXF4KE2TMxVVwhsnCgfAyTg9k8P6KGZjlXKrOLe4dJQKI3Bxi5wjesZoFXJWElNWBjPZMbhg==",
      "license": "MIT",
      "engines": {
        "node": ">=6.6.0"
      }
    },
    "node_modules/cors": {
      "version": "2.8.5",
      "resolved": "https://registry.npmjs.org/cors/-/cors-2.8.5.tgz",
      "integrity": "sha512-KIHbLJqu73RGr/hnbrO9uBeixNGuvSQjul/jdFvS/KFSIH1hWVd1ng7zOHx+YrEfInLG7q4n6GHQ9cDtxv/P6g==",
      "license": "MIT",
      "dependencies": {
        "object-assign": "^4",
        "vary": "^1"
      },
      "engines": {
        "node": ">= 0.10"
      }
    },
    "node_modules/debug": {
      "version": "4.4.3",
      "resolved": "https://registry.npmjs.org/debug/-/debug-4.4.3.tgz",
      "integrity": "sha512-RGwwWnwQvkVfavKVt22FGLw+xYSdzARwm0ru6DhTVA3umU5hZc28V3kO4stgYryrTlLpuvgI9GiijltAjNbcqA==",
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.3"
      },
      "engines": {
        "node": ">=6.0"
      },
      "peerDependenciesMeta": {
        "supports-color": {
          "optional": true
        }
      }
    },
    "node_modules/delayed-stream": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/delayed-stream/-/delayed-stream-1.0.0.tgz",
      "integrity": "sha512-ZySD7Nf91aLB0RxL4KGrKHBXl7Eds1DAmEdcoVawXnLD7SDhpNgtuII2aAkg7a7QS41jxPSZ17p4VdGnMHk3MQ==",
      "license": "MIT",
      "optional": true,
      "engines": {
        "node": ">=0.4.0"
      }
    },
    "node_modules/depd": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/depd/-/depd-2.0.0.tgz",
      "integrity": "sha512-g7nH6P6dyDioJogAAGprGpCtVImJhpPk/roCzdb3fIh61/s/nPsfR6onyMwkCAR/OlC3yBC0lESvUoQEAssIrw==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/dunder-proto": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/dunder-proto/-/dunder-proto-1.0.1.tgz",
      "integrity": "sha512-KIN/nDJBQRcXw0MLVhZE9iQHmG68qAVIBg9CqmUYjmQIhgij9U5MFvrqkUL5FbtyyzZuOeOt0zdeRe4UY7ct+A==",
      "license": "MIT",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.1",
        "es-errors": "^1.3.0",
        "gopd": "^1.2.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/duplexify": {
      "version": "4.1.3",
      "resolved": "https://registry.npmjs.org/duplexify/-/duplexify-4.1.3.tgz",
      "integrity": "sha512-M3BmBhwJRZsSx38lZyhE53Csddgzl5R7xGJNk7CVddZD6CcmwMCH8J+7AprIrQKH7TonKxaCjcv27Qmf+sQ+oA==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "end-of-stream": "^1.4.1",
        "inherits": "^2.0.3",
        "readable-stream": "^3.1.1",
        "stream-shift": "^1.0.2"
      }
    },
    "node_modules/ecdsa-sig-formatter": {
      "version": "1.0.11",
      "resolved": "https://registry.npmjs.org/ecdsa-sig-formatter/-/ecdsa-sig-formatter-1.0.11.tgz",
      "integrity": "sha512-nagl3RYrbNv6kQkeJIpt6NJZy8twLB/2vtz6yN9Z4vRKHN4/QZJIEbqohALSgwKdnksuY3k5Addp5lg8sVoVcQ==",
      "license": "Apache-2.0",
      "dependencies": {
        "safe-buffer": "^5.0.1"
      }
    },
    "node_modules/ee-first": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/ee-first/-/ee-first-1.1.1.tgz",
      "integrity": "sha512-WMwm9LhRUo+WUaRN+vRuETqG89IgZphVSNkdFgeb6sS/E4OrDIN7t48CAewSHXc6C8lefD8KKfr5vY61brQlow==",
      "license": "MIT"
    },
    "node_modules/emoji-regex": {
      "version": "8.0.0",
      "resolved": "https://registry.npmjs.org/emoji-regex/-/emoji-regex-8.0.0.tgz",
      "integrity": "sha512-MSjYzcWNOA0ewAHpz0MxpYFvwg6yjy1NG3xteoqz644VCo/RPgnr1/GGt+ic3iJTzQ8Eu3TdM14SawnVUmGE6A==",
      "license": "MIT",
      "optional": true
    },
    "node_modules/encodeurl": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/encodeurl/-/encodeurl-2.0.0.tgz",
      "integrity": "sha512-Q0n9HRi4m6JuGIV1eFlmvJB7ZEVxu93IrMyiMsGC0lrMJMWzRgx6WGquyfQgZVb31vhGgXnfmPNNXmxnOkRBrg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/end-of-stream": {
      "version": "1.4.5",
      "resolved": "https://registry.npmjs.org/end-of-stream/-/end-of-stream-1.4.5.tgz",
      "integrity": "sha512-ooEGc6HP26xXq/N+GCGOT0JKCLDGrq2bQUZrQ7gyrJiZANJ/8YDTxTpQBXGMn+WbIQXNVpyWymm7KYVICQnyOg==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "once": "^1.4.0"
      }
    },
    "node_modules/engine.io": {
      "version": "6.6.4",
      "resolved": "https://registry.npmjs.org/engine.io/-/engine.io-6.6.4.tgz",
      "integrity": "sha512-ZCkIjSYNDyGn0R6ewHDtXgns/Zre/NT6Agvq1/WobF7JXgFff4SeDroKiCO3fNJreU9YG429Sc81o4w5ok/W5g==",
      "license": "MIT",
      "dependencies": {
        "@types/cors": "^2.8.12",
        "@types/node": ">=10.0.0",
        "accepts": "~1.3.4",
        "base64id": "2.0.0",
        "cookie": "~0.7.2",
        "cors": "~2.8.5",
        "debug": "~4.3.1",
        "engine.io-parser": "~5.2.1",
        "ws": "~8.17.1"
      },
      "engines": {
        "node": ">=10.2.0"
      }
    },
    "node_modules/engine.io-parser": {
      "version": "5.2.3",
      "resolved": "https://registry.npmjs.org/engine.io-parser/-/engine.io-parser-5.2.3.tgz",
      "integrity": "sha512-HqD3yTBfnBxIrbnM1DoD6Pcq8NECnh8d4As1Qgh0z5Gg3jRRIqijury0CL3ghu/edArpUYiYqQiDUQBIs4np3Q==",
      "license": "MIT",
      "engines": {
        "node": ">=10.0.0"
      }
    },
    "node_modules/engine.io/node_modules/accepts": {
      "version": "1.3.8",
      "resolved": "https://registry.npmjs.org/accepts/-/accepts-1.3.8.tgz",
      "integrity": "sha512-PYAthTa2m2VKxuvSD3DPC/Gy+U+sOA1LAuT8mkmRuvw+NACSaeXEQ+NHcVF7rONl6qcaxV3Uuemwawk+7+SJLw==",
      "license": "MIT",
      "dependencies": {
        "mime-types": "~2.1.34",
        "negotiator": "0.6.3"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/engine.io/node_modules/debug": {
      "version": "4.3.7",
      "resolved": "https://registry.npmjs.org/debug/-/debug-4.3.7.tgz",
      "integrity": "sha512-Er2nc/H7RrMXZBFCEim6TCmMk02Z8vLC2Rbi1KEBggpo0fS6l0S1nnapwmIi3yW/+GOJap1Krg4w0Hg80oCqgQ==",
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.3"
      },
      "engines": {
        "node": ">=6.0"
      },
      "peerDependenciesMeta": {
        "supports-color": {
          "optional": true
        }
      }
    },
    "node_modules/engine.io/node_modules/mime-db": {
      "version": "1.52.0",
      "resolved": "https://registry.npmjs.org/mime-db/-/mime-db-1.52.0.tgz",
      "integrity": "sha512-sPU4uV7dYlvtWJxwwxHD0PuihVNiE7TyAbQ5SWxDCB9mUYvOgroQOwYQQOKPJ8CIbE+1ETVlOoK1UC2nU3gYvg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/engine.io/node_modules/mime-types": {
      "version": "2.1.35",
      "resolved": "https://registry.npmjs.org/mime-types/-/mime-types-2.1.35.tgz",
      "integrity": "sha512-ZDY+bPm5zTTF+YpCrAU9nK0UgICYPT0QtT1NZWFv4s++TNkcgVaT0g6+4R2uI4MjQjzysHB1zxuWL50hzaeXiw==",
      "license": "MIT",
      "dependencies": {
        "mime-db": "1.52.0"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/engine.io/node_modules/negotiator": {
      "version": "0.6.3",
      "resolved": "https://registry.npmjs.org/negotiator/-/negotiator-0.6.3.tgz",
      "integrity": "sha512-+EUsqGPLsM+j/zdChZjsnX51g4XrHFOIXwfnCVPGlQk/k5giakcKsuxCObBRu6DSm9opw/O6slWbJdghQM4bBg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/es-define-property": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/es-define-property/-/es-define-property-1.0.1.tgz",
      "integrity": "sha512-e3nRfgfUZ4rNGL232gUgX06QNyyez04KdjFrF+LTRoOXmrOgFKDg4BCdsjW8EnT69eqdYGmRpJwiPVYNrCaW3g==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-errors": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/es-errors/-/es-errors-1.3.0.tgz",
      "integrity": "sha512-Zf5H2Kxt2xjTvbJvP2ZWLEICxA6j+hAmMzIlypy4xcBg1vKVnx89Wy0GbS+kf5cwCVFFzdCFh2XSCFNULS6csw==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-object-atoms": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/es-object-atoms/-/es-object-atoms-1.1.1.tgz",
      "integrity": "sha512-FGgH2h8zKNim9ljj7dankFPcICIK9Cp5bm+c2gQSYePhpaG5+esrLODihIorn+Pe6FGJzWhXQotPv73jTaldXA==",
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-set-tostringtag": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/es-set-tostringtag/-/es-set-tostringtag-2.1.0.tgz",
      "integrity": "sha512-j6vWzfrGVfyXxge+O0x5sh6cvxAog0a/4Rdd2K36zCMV5eJ+/+tOAngRO8cODMNWbVRdVlmGZQL2YS3yR8bIUA==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.6",
        "has-tostringtag": "^1.0.2",
        "hasown": "^2.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/escalade": {
      "version": "3.2.0",
      "resolved": "https://registry.npmjs.org/escalade/-/escalade-3.2.0.tgz",
      "integrity": "sha512-WUj2qlxaQtO4g6Pq5c29GTcWGDyd8itL8zTlipgECz3JesAiiOKotd8JU6otB3PACgG6xkJUyVhboMS+bje/jA==",
      "license": "MIT",
      "optional": true,
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/escape-html": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/escape-html/-/escape-html-1.0.3.tgz",
      "integrity": "sha512-NiSupZ4OeuGwr68lGIeym/ksIZMJodUGOSCZ/FSnTxcrekbvqrgdUxlJOMpijaKZVjAJrWrGs/6Jy8OMuyj9ow==",
      "license": "MIT"
    },
    "node_modules/etag": {
      "version": "1.8.1",
      "resolved": "https://registry.npmjs.org/etag/-/etag-1.8.1.tgz",
      "integrity": "sha512-aIL5Fx7mawVa300al2BnEE4iNvo1qETxLrPI/o05L7z6go7fCw1J6EQmbK4FmJ2AS7kgVF/KEZWufBfdClMcPg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/event-target-shim": {
      "version": "5.0.1",
      "resolved": "https://registry.npmjs.org/event-target-shim/-/event-target-shim-5.0.1.tgz",
      "integrity": "sha512-i/2XbnSz/uxRCU6+NdVJgKWDTM427+MqYbkQzD321DuCQJUqOuJKIA0IM2+W2xtYHdKOmZ4dR6fExsd4SXL+WQ==",
      "license": "MIT",
      "optional": true,
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/express": {
      "version": "5.1.0",
      "resolved": "https://registry.npmjs.org/express/-/express-5.1.0.tgz",
      "integrity": "sha512-DT9ck5YIRU+8GYzzU5kT3eHGA5iL+1Zd0EutOmTE9Dtk+Tvuzd23VBU+ec7HPNSTxXYO55gPV/hq4pSBJDjFpA==",
      "license": "MIT",
      "dependencies": {
        "accepts": "^2.0.0",
        "body-parser": "^2.2.0",
        "content-disposition": "^1.0.0",
        "content-type": "^1.0.5",
        "cookie": "^0.7.1",
        "cookie-signature": "^1.2.1",
        "debug": "^4.4.0",
        "encodeurl": "^2.0.0",
        "escape-html": "^1.0.3",
        "etag": "^1.8.1",
        "finalhandler": "^2.1.0",
        "fresh": "^2.0.0",
        "http-errors": "^2.0.0",
        "merge-descriptors": "^2.0.0",
        "mime-types": "^3.0.0",
        "on-finished": "^2.4.1",
        "once": "^1.4.0",
        "parseurl": "^1.3.3",
        "proxy-addr": "^2.0.7",
        "qs": "^6.14.0",
        "range-parser": "^1.2.1",
        "router": "^2.2.0",
        "send": "^1.1.0",
        "serve-static": "^2.2.0",
        "statuses": "^2.0.1",
        "type-is": "^2.0.1",
        "vary": "^1.1.2"
      },
      "engines": {
        "node": ">= 18"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/express"
      }
    },
    "node_modules/extend": {
      "version": "3.0.2",
      "resolved": "https://registry.npmjs.org/extend/-/extend-3.0.2.tgz",
      "integrity": "sha512-fjquC59cD7CyW6urNXK0FBufkZcoiGG80wTuPujX590cB5Ttln20E2UB4S/WARVqhXffZl2LNgS+gQdPIIim/g==",
      "license": "MIT"
    },
    "node_modules/farmhash-modern": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/farmhash-modern/-/farmhash-modern-1.1.0.tgz",
      "integrity": "sha512-6ypT4XfgqJk/F3Yuv4SX26I3doUjt0GTG4a+JgWxXQpxXzTBq8fPUeGHfcYMMDPHJHm3yPOSjaeBwBGAHWXCdA==",
      "license": "MIT",
      "engines": {
        "node": ">=18.0.0"
      }
    },
    "node_modules/fast-deep-equal": {
      "version": "3.1.3",
      "resolved": "https://registry.npmjs.org/fast-deep-equal/-/fast-deep-equal-3.1.3.tgz",
      "integrity": "sha512-f3qQ9oQy9j2AhBe/H9VC91wLmKBCCU/gDOnKNAYG5hswO7BLKj09Hc5HYNz9cGI++xlpDCIgDaitVs03ATR84Q==",
      "license": "MIT",
      "optional": true
    },
    "node_modules/fast-xml-parser": {
      "version": "4.5.3",
      "resolved": "https://registry.npmjs.org/fast-xml-parser/-/fast-xml-parser-4.5.3.tgz",
      "integrity": "sha512-RKihhV+SHsIUGXObeVy9AXiBbFwkVk7Syp8XgwN5U3JV416+Gwp/GO9i0JYKmikykgz/UHRrrV4ROuZEo/T0ig==",
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/NaturalIntelligence"
        }
      ],
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "strnum": "^1.1.1"
      },
      "bin": {
        "fxparser": "src/cli/cli.js"
      }
    },
    "node_modules/faye-websocket": {
      "version": "0.11.4",
      "resolved": "https://registry.npmjs.org/faye-websocket/-/faye-websocket-0.11.4.tgz",
      "integrity": "sha512-CzbClwlXAuiRQAlUyfqPgvPoNKTckTPGfwZV4ZdAhVcP2lh9KUxJg2b5GkE7XbjKQ3YJnQ9z6D9ntLAlB+tP8g==",
      "license": "Apache-2.0",
      "dependencies": {
        "websocket-driver": ">=0.5.1"
      },
      "engines": {
        "node": ">=0.8.0"
      }
    },
    "node_modules/finalhandler": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/finalhandler/-/finalhandler-2.1.0.tgz",
      "integrity": "sha512-/t88Ty3d5JWQbWYgaOGCCYfXRwV1+be02WqYYlL6h0lEiUAMPM8o8qKGO01YIkOHzka2up08wvgYD0mDiI+q3Q==",
      "license": "MIT",
      "dependencies": {
        "debug": "^4.4.0",
        "encodeurl": "^2.0.0",
        "escape-html": "^1.0.3",
        "on-finished": "^2.4.1",
        "parseurl": "^1.3.3",
        "statuses": "^2.0.1"
      },
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/firebase-admin": {
      "version": "13.4.0",
      "resolved": "https://registry.npmjs.org/firebase-admin/-/firebase-admin-13.4.0.tgz",
      "integrity": "sha512-Y8DcyKK+4pl4B93ooiy1G8qvdyRMkcNFfBSh+8rbVcw4cW8dgG0VXCCTp5NUwub8sn9vSPsOwpb9tE2OuFmcfQ==",
      "license": "Apache-2.0",
      "dependencies": {
        "@fastify/busboy": "^3.0.0",
        "@firebase/database-compat": "^2.0.0",
        "@firebase/database-types": "^1.0.6",
        "@types/node": "^22.8.7",
        "farmhash-modern": "^1.1.0",
        "google-auth-library": "^9.14.2",
        "jsonwebtoken": "^9.0.0",
        "jwks-rsa": "^3.1.0",
        "node-forge": "^1.3.1",
        "uuid": "^11.0.2"
      },
      "engines": {
        "node": ">=18"
      },
      "optionalDependencies": {
        "@google-cloud/firestore": "^7.11.0",
        "@google-cloud/storage": "^7.14.0"
      }
    },
    "node_modules/firebase-admin/node_modules/@types/node": {
      "version": "22.17.1",
      "resolved": "https://registry.npmjs.org/@types/node/-/node-22.17.1.tgz",
      "integrity": "sha512-y3tBaz+rjspDTylNjAX37jEC3TETEFGNJL6uQDxwF9/8GLLIjW1rvVHlynyuUKMnMr1Roq8jOv3vkopBjC4/VA==",
      "license": "MIT",
      "dependencies": {
        "undici-types": "~6.21.0"
      }
    },
    "node_modules/firebase-admin/node_modules/undici-types": {
      "version": "6.21.0",
      "resolved": "https://registry.npmjs.org/undici-types/-/undici-types-6.21.0.tgz",
      "integrity": "sha512-iwDZqg0QAGrg9Rav5H4n0M64c3mkR59cJ6wQp+7C4nI0gsmExaedaYLNO44eT4AtBBwjbTiGPMlt2Md0T9H9JQ==",
      "license": "MIT"
    },
    "node_modules/form-data": {
      "version": "2.5.5",
      "resolved": "https://registry.npmjs.org/form-data/-/form-data-2.5.5.tgz",
      "integrity": "sha512-jqdObeR2rxZZbPSGL+3VckHMYtu+f9//KXBsVny6JSX/pa38Fy+bGjuG8eW/H6USNQWhLi8Num++cU2yOCNz4A==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "asynckit": "^0.4.0",
        "combined-stream": "^1.0.8",
        "es-set-tostringtag": "^2.1.0",
        "hasown": "^2.0.2",
        "mime-types": "^2.1.35",
        "safe-buffer": "^5.2.1"
      },
      "engines": {
        "node": ">= 0.12"
      }
    },
    "node_modules/form-data/node_modules/mime-db": {
      "version": "1.52.0",
      "resolved": "https://registry.npmjs.org/mime-db/-/mime-db-1.52.0.tgz",
      "integrity": "sha512-sPU4uV7dYlvtWJxwwxHD0PuihVNiE7TyAbQ5SWxDCB9mUYvOgroQOwYQQOKPJ8CIbE+1ETVlOoK1UC2nU3gYvg==",
      "license": "MIT",
      "optional": true,
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/form-data/node_modules/mime-types": {
      "version": "2.1.35",
      "resolved": "https://registry.npmjs.org/mime-types/-/mime-types-2.1.35.tgz",
      "integrity": "sha512-ZDY+bPm5zTTF+YpCrAU9nK0UgICYPT0QtT1NZWFv4s++TNkcgVaT0g6+4R2uI4MjQjzysHB1zxuWL50hzaeXiw==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "mime-db": "1.52.0"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/forwarded": {
      "version": "0.2.0",
      "resolved": "https://registry.npmjs.org/forwarded/-/forwarded-0.2.0.tgz",
      "integrity": "sha512-buRG0fpBtRHSTCOASe6hD258tEubFoRLb4ZNA6NxMVHNw2gOcwHo9wyablzMzOA5z9xA9L1KNjk/Nt6MT9aYow==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/fresh": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/fresh/-/fresh-2.0.0.tgz",
      "integrity": "sha512-Rx/WycZ60HOaqLKAi6cHRKKI7zxWbJ31MhntmtwMoaTeF7XFH9hhBp8vITaMidfljRQ6eYWCKkaTK+ykVJHP2A==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/function-bind": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/function-bind/-/function-bind-1.1.2.tgz",
      "integrity": "sha512-7XHNxH7qX9xG5mIwxkhumTox/MIRNcOgDrxWsMt2pAr23WHp6MrRlN7FBSFpCpr+oVO0F744iUgR82nJMfG2SA==",
      "license": "MIT",
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/functional-red-black-tree": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/functional-red-black-tree/-/functional-red-black-tree-1.0.1.tgz",
      "integrity": "sha512-dsKNQNdj6xA3T+QlADDA7mOSlX0qiMINjn0cgr+eGHGsbSHzTabcIogz2+p/iqP1Xs6EP/sS2SbqH+brGTbq0g==",
      "license": "MIT",
      "optional": true
    },
    "node_modules/gaxios": {
      "version": "6.7.1",
      "resolved": "https://registry.npmjs.org/gaxios/-/gaxios-6.7.1.tgz",
      "integrity": "sha512-LDODD4TMYx7XXdpwxAVRAIAuB0bzv0s+ywFonY46k126qzQHT9ygyoa9tncmOiQmmDrik65UYsEkv3lbfqQ3yQ==",
      "license": "Apache-2.0",
      "dependencies": {
        "extend": "^3.0.2",
        "https-proxy-agent": "^7.0.1",
        "is-stream": "^2.0.0",
        "node-fetch": "^2.6.9",
        "uuid": "^9.0.1"
      },
      "engines": {
        "node": ">=14"
      }
    },
    "node_modules/gaxios/node_modules/uuid": {
      "version": "9.0.1",
      "resolved": "https://registry.npmjs.org/uuid/-/uuid-9.0.1.tgz",
      "integrity": "sha512-b+1eJOlsR9K8HJpow9Ok3fiWOWSIcIzXodvv0rQjVoOVNpWMpxf1wZNpt4y9h10odCNrqnYp1OBzRktckBe3sA==",
      "funding": [
        "https://github.com/sponsors/broofa",
        "https://github.com/sponsors/ctavan"
      ],
      "license": "MIT",
      "bin": {
        "uuid": "dist/bin/uuid"
      }
    },
    "node_modules/gcp-metadata": {
      "version": "6.1.1",
      "resolved": "https://registry.npmjs.org/gcp-metadata/-/gcp-metadata-6.1.1.tgz",
      "integrity": "sha512-a4tiq7E0/5fTjxPAaH4jpjkSv/uCaU2p5KC6HVGrvl0cDjA8iBZv4vv1gyzlmK0ZUKqwpOyQMKzZQe3lTit77A==",
      "license": "Apache-2.0",
      "dependencies": {
        "gaxios": "^6.1.1",
        "google-logging-utils": "^0.0.2",
        "json-bigint": "^1.0.0"
      },
      "engines": {
        "node": ">=14"
      }
    },
    "node_modules/get-caller-file": {
      "version": "2.0.5",
      "resolved": "https://registry.npmjs.org/get-caller-file/-/get-caller-file-2.0.5.tgz",
      "integrity": "sha512-DyFP3BM/3YHTQOCUL/w0OZHR0lpKeGrxotcHWcqNEdnltqFwXVfhEBQ94eIo34AfQpo0rGki4cyIiftY06h2Fg==",
      "license": "ISC",
      "optional": true,
      "engines": {
        "node": "6.* || 8.* || >= 10.*"
      }
    },
    "node_modules/get-intrinsic": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/get-intrinsic/-/get-intrinsic-1.3.0.tgz",
      "integrity": "sha512-9fSjSaos/fRIVIp+xSJlE6lfwhES7LNtKaCBIamHsjr2na1BiABJPo0mOjjz8GJDURarmCPGqaiVg5mfjb98CQ==",
      "license": "MIT",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.2",
        "es-define-property": "^1.0.1",
        "es-errors": "^1.3.0",
        "es-object-atoms": "^1.1.1",
        "function-bind": "^1.1.2",
        "get-proto": "^1.0.1",
        "gopd": "^1.2.0",
        "has-symbols": "^1.1.0",
        "hasown": "^2.0.2",
        "math-intrinsics": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/get-proto": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/get-proto/-/get-proto-1.0.1.tgz",
      "integrity": "sha512-sTSfBjoXBp89JvIKIefqw7U2CCebsc74kiY6awiGogKtoSGbgjYE/G/+l9sF3MWFPNc9IcoOC4ODfKHfxFmp0g==",
      "license": "MIT",
      "dependencies": {
        "dunder-proto": "^1.0.1",
        "es-object-atoms": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/google-auth-library": {
      "version": "9.15.1",
      "resolved": "https://registry.npmjs.org/google-auth-library/-/google-auth-library-9.15.1.tgz",
      "integrity": "sha512-Jb6Z0+nvECVz+2lzSMt9u98UsoakXxA2HGHMCxh+so3n90XgYWkq5dur19JAJV7ONiJY22yBTyJB1TSkvPq9Ng==",
      "license": "Apache-2.0",
      "dependencies": {
        "base64-js": "^1.3.0",
        "ecdsa-sig-formatter": "^1.0.11",
        "gaxios": "^6.1.1",
        "gcp-metadata": "^6.1.0",
        "gtoken": "^7.0.0",
        "jws": "^4.0.0"
      },
      "engines": {
        "node": ">=14"
      }
    },
    "node_modules/google-gax": {
      "version": "4.6.1",
      "resolved": "https://registry.npmjs.org/google-gax/-/google-gax-4.6.1.tgz",
      "integrity": "sha512-V6eky/xz2mcKfAd1Ioxyd6nmA61gao3n01C+YeuIwu3vzM9EDR6wcVzMSIbLMDXWeoi9SHYctXuKYC5uJUT3eQ==",
      "license": "Apache-2.0",
      "optional": true,
      "dependencies": {
        "@grpc/grpc-js": "^1.10.9",
        "@grpc/proto-loader": "^0.7.13",
        "@types/long": "^4.0.0",
        "abort-controller": "^3.0.0",
        "duplexify": "^4.0.0",
        "google-auth-library": "^9.3.0",
        "node-fetch": "^2.7.0",
        "object-hash": "^3.0.0",
        "proto3-json-serializer": "^2.0.2",
        "protobufjs": "^7.3.2",
        "retry-request": "^7.0.0",
        "uuid": "^9.0.1"
      },
      "engines": {
        "node": ">=14"
      }
    },
    "node_modules/google-gax/node_modules/uuid": {
      "version": "9.0.1",
      "resolved": "https://registry.npmjs.org/uuid/-/uuid-9.0.1.tgz",
      "integrity": "sha512-b+1eJOlsR9K8HJpow9Ok3fiWOWSIcIzXodvv0rQjVoOVNpWMpxf1wZNpt4y9h10odCNrqnYp1OBzRktckBe3sA==",
      "funding": [
        "https://github.com/sponsors/broofa",
        "https://github.com/sponsors/ctavan"
      ],
      "license": "MIT",
      "optional": true,
      "bin": {
        "uuid": "dist/bin/uuid"
      }
    },
    "node_modules/google-logging-utils": {
      "version": "0.0.2",
      "resolved": "https://registry.npmjs.org/google-logging-utils/-/google-logging-utils-0.0.2.tgz",
      "integrity": "sha512-NEgUnEcBiP5HrPzufUkBzJOD/Sxsco3rLNo1F1TNf7ieU8ryUzBhqba8r756CjLX7rn3fHl6iLEwPYuqpoKgQQ==",
      "license": "Apache-2.0",
      "engines": {
        "node": ">=14"
      }
    },
    "node_modules/gopd": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/gopd/-/gopd-1.2.0.tgz",
      "integrity": "sha512-ZUKRh6/kUFoAiTAtTYPZJ3hw9wNxx+BIBOijnlG9PnrJsCcSjs1wyyD6vJpaYtgnzDrKYRSqf3OO6Rfa93xsRg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/gtoken": {
      "version": "7.1.0",
      "resolved": "https://registry.npmjs.org/gtoken/-/gtoken-7.1.0.tgz",
      "integrity": "sha512-pCcEwRi+TKpMlxAQObHDQ56KawURgyAf6jtIY046fJ5tIv3zDe/LEIubckAO8fj6JnAxLdmWkUfNyulQ2iKdEw==",
      "license": "MIT",
      "dependencies": {
        "gaxios": "^6.0.0",
        "jws": "^4.0.0"
      },
      "engines": {
        "node": ">=14.0.0"
      }
    },
    "node_modules/has-symbols": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/has-symbols/-/has-symbols-1.1.0.tgz",
      "integrity": "sha512-1cDNdwJ2Jaohmb3sg4OmKaMBwuC48sYni5HUw2DvsC8LjGTLK9h+eb1X6RyuOHe4hT0ULCW68iomhjUoKUqlPQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/has-tostringtag": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/has-tostringtag/-/has-tostringtag-1.0.2.tgz",
      "integrity": "sha512-NqADB8VjPFLM2V0VvHUewwwsw0ZWBaIdgo+ieHtK3hasLz4qeCRjYcqfB6AQrBggRKppKF8L52/VqdVsO47Dlw==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "has-symbols": "^1.0.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/hasown": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/hasown/-/hasown-2.0.2.tgz",
      "integrity": "sha512-0hJU9SCPvmMzIBdZFqNPXWa6dqh7WdH0cII9y+CyS8rG3nL48Bclra9HmKhVVUHyPWNH5Y7xDwAB7bfgSjkUMQ==",
      "license": "MIT",
      "dependencies": {
        "function-bind": "^1.1.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/html-entities": {
      "version": "2.6.0",
      "resolved": "https://registry.npmjs.org/html-entities/-/html-entities-2.6.0.tgz",
      "integrity": "sha512-kig+rMn/QOVRvr7c86gQ8lWXq+Hkv6CbAH1hLu+RG338StTpE8Z0b44SDVaqVu7HGKf27frdmUYEs9hTUX/cLQ==",
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/mdevils"
        },
        {
          "type": "patreon",
          "url": "https://patreon.com/mdevils"
        }
      ],
      "license": "MIT",
      "optional": true
    },
    "node_modules/http-errors": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/http-errors/-/http-errors-2.0.1.tgz",
      "integrity": "sha512-4FbRdAX+bSdmo4AUFuS0WNiPz8NgFt+r8ThgNWmlrjQjt1Q7ZR9+zTlce2859x4KSXrwIsaeTqDoKQmtP8pLmQ==",
      "license": "MIT",
      "dependencies": {
        "depd": "~2.0.0",
        "inherits": "~2.0.4",
        "setprototypeof": "~1.2.0",
        "statuses": "~2.0.2",
        "toidentifier": "~1.0.1"
      },
      "engines": {
        "node": ">= 0.8"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/express"
      }
    },
    "node_modules/http-parser-js": {
      "version": "0.5.10",
      "resolved": "https://registry.npmjs.org/http-parser-js/-/http-parser-js-0.5.10.tgz",
      "integrity": "sha512-Pysuw9XpUq5dVc/2SMHpuTY01RFl8fttgcyunjL7eEMhGM3cI4eOmiCycJDVCo/7O7ClfQD3SaI6ftDzqOXYMA==",
      "license": "MIT"
    },
    "node_modules/http-proxy-agent": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/http-proxy-agent/-/http-proxy-agent-5.0.0.tgz",
      "integrity": "sha512-n2hY8YdoRE1i7r6M0w9DIw5GgZN0G25P8zLCRQ8rjXtTU3vsNFBI/vWK/UIeE6g5MUUz6avwAPXmL6Fy9D/90w==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "@tootallnate/once": "2",
        "agent-base": "6",
        "debug": "4"
      },
      "engines": {
        "node": ">= 6"
      }
    },
    "node_modules/http-proxy-agent/node_modules/agent-base": {
      "version": "6.0.2",
      "resolved": "https://registry.npmjs.org/agent-base/-/agent-base-6.0.2.tgz",
      "integrity": "sha512-RZNwNclF7+MS/8bDg70amg32dyeZGZxiDuQmZxKLAlQjr3jGyLx+4Kkk58UO7D2QdgFIQCovuSuZESne6RG6XQ==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "debug": "4"
      },
      "engines": {
        "node": ">= 6.0.0"
      }
    },
    "node_modules/https-proxy-agent": {
      "version": "7.0.6",
      "resolved": "https://registry.npmjs.org/https-proxy-agent/-/https-proxy-agent-7.0.6.tgz",
      "integrity": "sha512-vK9P5/iUfdl95AI+JVyUuIcVtd4ofvtrOr3HNtM2yxC9bnMbEdp3x01OhQNnjb8IJYi38VlTE3mBXwcfvywuSw==",
      "license": "MIT",
      "dependencies": {
        "agent-base": "^7.1.2",
        "debug": "4"
      },
      "engines": {
        "node": ">= 14"
      }
    },
    "node_modules/iconv-lite": {
      "version": "0.7.2",
      "resolved": "https://registry.npmjs.org/iconv-lite/-/iconv-lite-0.7.2.tgz",
      "integrity": "sha512-im9DjEDQ55s9fL4EYzOAv0yMqmMBSZp6G0VvFyTMPKWxiSBHUj9NW/qqLmXUwXrrM7AvqSlTCfvqRb0cM8yYqw==",
      "license": "MIT",
      "dependencies": {
        "safer-buffer": ">= 2.1.2 < 3.0.0"
      },
      "engines": {
        "node": ">=0.10.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/express"
      }
    },
    "node_modules/inherits": {
      "version": "2.0.4",
      "resolved": "https://registry.npmjs.org/inherits/-/inherits-2.0.4.tgz",
      "integrity": "sha512-k/vGaX4/Yla3WzyMCvTQOXYeIHvqOKtnqBduzTHpzpQZzAskKMhZ2K+EnBiSM9zGSoIFeMpXKxa4dYeZIQqewQ==",
      "license": "ISC"
    },
    "node_modules/ipaddr.js": {
      "version": "1.9.1",
      "resolved": "https://registry.npmjs.org/ipaddr.js/-/ipaddr.js-1.9.1.tgz",
      "integrity": "sha512-0KI/607xoxSToH7GjN1FfSbLoU0+btTicjsQSWQlh/hZykN8KpmMf7uYwPW3R+akZ6R/w18ZlXSHBYXiYUPO3g==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.10"
      }
    },
    "node_modules/is-fullwidth-code-point": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/is-fullwidth-code-point/-/is-fullwidth-code-point-3.0.0.tgz",
      "integrity": "sha512-zymm5+u+sCsSWyD9qNaejV3DFvhCKclKdizYaJUuHA83RLjb7nSuGnddCHGv0hk+KY7BMAlsWeK4Ueg6EV6XQg==",
      "license": "MIT",
      "optional": true,
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/is-promise": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/is-promise/-/is-promise-4.0.0.tgz",
      "integrity": "sha512-hvpoI6korhJMnej285dSg6nu1+e6uxs7zG3BYAm5byqDsgJNWwxzM6z6iZiAgQR4TJ30JmBTOwqZUw3WlyH3AQ==",
      "license": "MIT"
    },
    "node_modules/is-stream": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/is-stream/-/is-stream-2.0.1.tgz",
      "integrity": "sha512-hFoiJiTl63nn+kstHGBtewWSKnQLpyb155KHheA1l39uvtO9nWIop1p3udqPcUd/xbF1VLMO4n7OI6p7RbngDg==",
      "license": "MIT",
      "engines": {
        "node": ">=8"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/jose": {
      "version": "4.15.9",
      "resolved": "https://registry.npmjs.org/jose/-/jose-4.15.9.tgz",
      "integrity": "sha512-1vUQX+IdDMVPj4k8kOxgUqlcK518yluMuGZwqlr44FS1ppZB/5GWh4rZG89erpOBOJjU/OBsnCVFfapsRz6nEA==",
      "license": "MIT",
      "funding": {
        "url": "https://github.com/sponsors/panva"
      }
    },
    "node_modules/json-bigint": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/json-bigint/-/json-bigint-1.0.0.tgz",
      "integrity": "sha512-SiPv/8VpZuWbvLSMtTDU8hEfrZWg/mH/nV/b4o0CYbSxu1UIQPLdwKOCIyLQX+VIPO5vrLX3i8qtqFyhdPSUSQ==",
      "license": "MIT",
      "dependencies": {
        "bignumber.js": "^9.0.0"
      }
    },
    "node_modules/jsonwebtoken": {
      "version": "9.0.2",
      "resolved": "https://registry.npmjs.org/jsonwebtoken/-/jsonwebtoken-9.0.2.tgz",
      "integrity": "sha512-PRp66vJ865SSqOlgqS8hujT5U4AOgMfhrwYIuIhfKaoSCZcirrmASQr8CX7cUg+RMih+hgznrjp99o+W4pJLHQ==",
      "license": "MIT",
      "dependencies": {
        "jws": "^3.2.2",
        "lodash.includes": "^4.3.0",
        "lodash.isboolean": "^3.0.3",
        "lodash.isinteger": "^4.0.4",
        "lodash.isnumber": "^3.0.3",
        "lodash.isplainobject": "^4.0.6",
        "lodash.isstring": "^4.0.1",
        "lodash.once": "^4.0.0",
        "ms": "^2.1.1",
        "semver": "^7.5.4"
      },
      "engines": {
        "node": ">=12",
        "npm": ">=6"
      }
    },
    "node_modules/jsonwebtoken/node_modules/jwa": {
      "version": "1.4.2",
      "resolved": "https://registry.npmjs.org/jwa/-/jwa-1.4.2.tgz",
      "integrity": "sha512-eeH5JO+21J78qMvTIDdBXidBd6nG2kZjg5Ohz/1fpa28Z4CcsWUzJ1ZZyFq/3z3N17aZy+ZuBoHljASbL1WfOw==",
      "license": "MIT",
      "dependencies": {
        "buffer-equal-constant-time": "^1.0.1",
        "ecdsa-sig-formatter": "1.0.11",
        "safe-buffer": "^5.0.1"
      }
    },
    "node_modules/jsonwebtoken/node_modules/jws": {
      "version": "3.2.3",
      "resolved": "https://registry.npmjs.org/jws/-/jws-3.2.3.tgz",
      "integrity": "sha512-byiJ0FLRdLdSVSReO/U4E7RoEyOCKnEnEPMjq3HxWtvzLsV08/i5RQKsFVNkCldrCaPr2vDNAOMsfs8T/Hze7g==",
      "license": "MIT",
      "dependencies": {
        "jwa": "^1.4.2",
        "safe-buffer": "^5.0.1"
      }
    },
    "node_modules/jwa": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/jwa/-/jwa-2.0.1.tgz",
      "integrity": "sha512-hRF04fqJIP8Abbkq5NKGN0Bbr3JxlQ+qhZufXVr0DvujKy93ZCbXZMHDL4EOtodSbCWxOqR8MS1tXA5hwqCXDg==",
      "license": "MIT",
      "dependencies": {
        "buffer-equal-constant-time": "^1.0.1",
        "ecdsa-sig-formatter": "1.0.11",
        "safe-buffer": "^5.0.1"
      }
    },
    "node_modules/jwks-rsa": {
      "version": "3.2.0",
      "resolved": "https://registry.npmjs.org/jwks-rsa/-/jwks-rsa-3.2.0.tgz",
      "integrity": "sha512-PwchfHcQK/5PSydeKCs1ylNym0w/SSv8a62DgHJ//7x2ZclCoinlsjAfDxAAbpoTPybOum/Jgy+vkvMmKz89Ww==",
      "license": "MIT",
      "dependencies": {
        "@types/express": "^4.17.20",
        "@types/jsonwebtoken": "^9.0.4",
        "debug": "^4.3.4",
        "jose": "^4.15.4",
        "limiter": "^1.1.5",
        "lru-memoizer": "^2.2.0"
      },
      "engines": {
        "node": ">=14"
      }
    },
    "node_modules/jws": {
      "version": "4.0.1",
      "resolved": "https://registry.npmjs.org/jws/-/jws-4.0.1.tgz",
      "integrity": "sha512-EKI/M/yqPncGUUh44xz0PxSidXFr/+r0pA70+gIYhjv+et7yxM+s29Y+VGDkovRofQem0fs7Uvf4+YmAdyRduA==",
      "license": "MIT",
      "dependencies": {
        "jwa": "^2.0.1",
        "safe-buffer": "^5.0.1"
      }
    },
    "node_modules/limiter": {
      "version": "1.1.5",
      "resolved": "https://registry.npmjs.org/limiter/-/limiter-1.1.5.tgz",
      "integrity": "sha512-FWWMIEOxz3GwUI4Ts/IvgVy6LPvoMPgjMdQ185nN6psJyBJ4yOpzqm695/h5umdLJg2vW3GR5iG11MAkR2AzJA=="
    },
    "node_modules/lodash.camelcase": {
      "version": "4.3.0",
      "resolved": "https://registry.npmjs.org/lodash.camelcase/-/lodash.camelcase-4.3.0.tgz",
      "integrity": "sha512-TwuEnCnxbc3rAvhf/LbG7tJUDzhqXyFnv3dtzLOPgCG/hODL7WFnsbwktkD7yUV0RrreP/l1PALq/YSg6VvjlA==",
      "license": "MIT",
      "optional": true
    },
    "node_modules/lodash.clonedeep": {
      "version": "4.5.0",
      "resolved": "https://registry.npmjs.org/lodash.clonedeep/-/lodash.clonedeep-4.5.0.tgz",
      "integrity": "sha512-H5ZhCF25riFd9uB5UCkVKo61m3S/xZk1x4wA6yp/L3RFP6Z/eHH1ymQcGLo7J3GMPfm0V/7m1tryHuGVxpqEBQ==",
      "license": "MIT"
    },
    "node_modules/lodash.includes": {
      "version": "4.3.0",
      "resolved": "https://registry.npmjs.org/lodash.includes/-/lodash.includes-4.3.0.tgz",
      "integrity": "sha512-W3Bx6mdkRTGtlJISOvVD/lbqjTlPPUDTMnlXZFnVwi9NKJ6tiAk6LVdlhZMm17VZisqhKcgzpO5Wz91PCt5b0w==",
      "license": "MIT"
    },
    "node_modules/lodash.isboolean": {
      "version": "3.0.3",
      "resolved": "https://registry.npmjs.org/lodash.isboolean/-/lodash.isboolean-3.0.3.tgz",
      "integrity": "sha512-Bz5mupy2SVbPHURB98VAcw+aHh4vRV5IPNhILUCsOzRmsTmSQ17jIuqopAentWoehktxGd9e/hbIXq980/1QJg==",
      "license": "MIT"
    },
    "node_modules/lodash.isinteger": {
      "version": "4.0.4",
      "resolved": "https://registry.npmjs.org/lodash.isinteger/-/lodash.isinteger-4.0.4.tgz",
      "integrity": "sha512-DBwtEWN2caHQ9/imiNeEA5ys1JoRtRfY3d7V9wkqtbycnAmTvRRmbHKDV4a0EYc678/dia0jrte4tjYwVBaZUA==",
      "license": "MIT"
    },
    "node_modules/lodash.isnumber": {
      "version": "3.0.3",
      "resolved": "https://registry.npmjs.org/lodash.isnumber/-/lodash.isnumber-3.0.3.tgz",
      "integrity": "sha512-QYqzpfwO3/CWf3XP+Z+tkQsfaLL/EnUlXWVkIk5FUPc4sBdTehEqZONuyRt2P67PXAk+NXmTBcc97zw9t1FQrw==",
      "license": "MIT"
    },
    "node_modules/lodash.isplainobject": {
      "version": "4.0.6",
      "resolved": "https://registry.npmjs.org/lodash.isplainobject/-/lodash.isplainobject-4.0.6.tgz",
      "integrity": "sha512-oSXzaWypCMHkPC3NvBEaPHf0KsA5mvPrOPgQWDsbg8n7orZ290M0BmC/jgRZ4vcJ6DTAhjrsSYgdsW/F+MFOBA==",
      "license": "MIT"
    },
    "node_modules/lodash.isstring": {
      "version": "4.0.1",
      "resolved": "https://registry.npmjs.org/lodash.isstring/-/lodash.isstring-4.0.1.tgz",
      "integrity": "sha512-0wJxfxH1wgO3GrbuP+dTTk7op+6L41QCXbGINEmD+ny/G/eCqGzxyCsh7159S+mgDDcoarnBw6PC1PS5+wUGgw==",
      "license": "MIT"
    },
    "node_modules/lodash.once": {
      "version": "4.1.1",
      "resolved": "https://registry.npmjs.org/lodash.once/-/lodash.once-4.1.1.tgz",
      "integrity": "sha512-Sb487aTOCr9drQVL8pIxOzVhafOjZN9UU54hiN8PU3uAiSV7lx1yYNpbNmex2PK6dSJoNTSJUUswT651yww3Mg==",
      "license": "MIT"
    },
    "node_modules/long": {
      "version": "5.3.2",
      "resolved": "https://registry.npmjs.org/long/-/long-5.3.2.tgz",
      "integrity": "sha512-mNAgZ1GmyNhD7AuqnTG3/VQ26o760+ZYBPKjPvugO8+nLbYfX6TVpJPseBvopbdY+qpZ/lKUnmEc1LeZYS3QAA==",
      "license": "Apache-2.0",
      "optional": true
    },
    "node_modules/lru-cache": {
      "version": "6.0.0",
      "resolved": "https://registry.npmjs.org/lru-cache/-/lru-cache-6.0.0.tgz",
      "integrity": "sha512-Jo6dJ04CmSjuznwJSS3pUeWmd/H0ffTlkXXgwZi+eq1UCmqQwCh+eLsYOYCwY991i2Fah4h1BEMCx4qThGbsiA==",
      "license": "ISC",
      "dependencies": {
        "yallist": "^4.0.0"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/lru-memoizer": {
      "version": "2.3.0",
      "resolved": "https://registry.npmjs.org/lru-memoizer/-/lru-memoizer-2.3.0.tgz",
      "integrity": "sha512-GXn7gyHAMhO13WSKrIiNfztwxodVsP8IoZ3XfrJV4yH2x0/OeTO/FIaAHTY5YekdGgW94njfuKmyyt1E0mR6Ug==",
      "license": "MIT",
      "dependencies": {
        "lodash.clonedeep": "^4.5.0",
        "lru-cache": "6.0.0"
      }
    },
    "node_modules/math-intrinsics": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/math-intrinsics/-/math-intrinsics-1.1.0.tgz",
      "integrity": "sha512-/IXtbwEk5HTPyEwyKX6hGkYXxM9nbj64B+ilVJnC/R6B0pH5G4V3b0pVbL7DBj4tkhBAppbQUlf6F6Xl9LHu1g==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/media-typer": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/media-typer/-/media-typer-1.1.0.tgz",
      "integrity": "sha512-aisnrDP4GNe06UcKFnV5bfMNPBUw4jsLGaWwWfnH3v02GnBuXX2MCVn5RbrWo0j3pczUilYblq7fQ7Nw2t5XKw==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/merge-descriptors": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/merge-descriptors/-/merge-descriptors-2.0.0.tgz",
      "integrity": "sha512-Snk314V5ayFLhp3fkUREub6WtjBfPdCPY1Ln8/8munuLuiYhsABgBVWsozAG+MWMbVEvcdcpbi9R7ww22l9Q3g==",
      "license": "MIT",
      "engines": {
        "node": ">=18"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/mime": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/mime/-/mime-3.0.0.tgz",
      "integrity": "sha512-jSCU7/VB1loIWBZe14aEYHU/+1UMEHoaO7qxCOVJOw9GgH72VAWppxNcjU+x9a2k3GSIBXNKxXQFqRvvZ7vr3A==",
      "license": "MIT",
      "optional": true,
      "bin": {
        "mime": "cli.js"
      },
      "engines": {
        "node": ">=10.0.0"
      }
    },
    "node_modules/mime-db": {
      "version": "1.54.0",
      "resolved": "https://registry.npmjs.org/mime-db/-/mime-db-1.54.0.tgz",
      "integrity": "sha512-aU5EJuIN2WDemCcAp2vFBfp/m4EAhWJnUNSSw0ixs7/kXbd6Pg64EmwJkNdFhB8aWt1sH2CTXrLxo/iAGV3oPQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/mime-types": {
      "version": "3.0.1",
      "resolved": "https://registry.npmjs.org/mime-types/-/mime-types-3.0.1.tgz",
      "integrity": "sha512-xRc4oEhT6eaBpU1XF7AjpOFD+xQmXNB5OVKwp4tqCuBpHLS/ZbBDrc07mYTDqVMg6PfxUjjNp85O6Cd2Z/5HWA==",
      "license": "MIT",
      "dependencies": {
        "mime-db": "^1.54.0"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/ms": {
      "version": "2.1.3",
      "resolved": "https://registry.npmjs.org/ms/-/ms-2.1.3.tgz",
      "integrity": "sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==",
      "license": "MIT"
    },
    "node_modules/negotiator": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/negotiator/-/negotiator-1.0.0.tgz",
      "integrity": "sha512-8Ofs/AUQh8MaEcrlq5xOX0CQ9ypTF5dl78mjlMNfOK08fzpgTHQRQPBxcPlEtIw0yRpws+Zo/3r+5WRby7u3Gg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/node-fetch": {
      "version": "2.7.0",
      "resolved": "https://registry.npmjs.org/node-fetch/-/node-fetch-2.7.0.tgz",
      "integrity": "sha512-c4FRfUm/dbcWZ7U+1Wq0AwCyFL+3nt2bEw05wfxSz+DWpWsitgmSgYmy2dQdWyKC1694ELPqMs/YzUSNozLt8A==",
      "license": "MIT",
      "dependencies": {
        "whatwg-url": "^5.0.0"
      },
      "engines": {
        "node": "4.x || >=6.0.0"
      },
      "peerDependencies": {
        "encoding": "^0.1.0"
      },
      "peerDependenciesMeta": {
        "encoding": {
          "optional": true
        }
      }
    },
    "node_modules/node-forge": {
      "version": "1.3.3",
      "resolved": "https://registry.npmjs.org/node-forge/-/node-forge-1.3.3.tgz",
      "integrity": "sha512-rLvcdSyRCyouf6jcOIPe/BgwG/d7hKjzMKOas33/pHEr6gbq18IK9zV7DiPvzsz0oBJPme6qr6H6kGZuI9/DZg==",
      "license": "(BSD-3-Clause OR GPL-2.0)",
      "engines": {
        "node": ">= 6.13.0"
      }
    },
    "node_modules/object-assign": {
      "version": "4.1.1",
      "resolved": "https://registry.npmjs.org/object-assign/-/object-assign-4.1.1.tgz",
      "integrity": "sha512-rJgTQnkUnH1sFw8yT6VSU3zD3sWmu6sZhIseY8VX+GRu3P6F7Fu+JNDoXfklElbLJSnc3FUQHVe4cU5hj+BcUg==",
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/object-hash": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/object-hash/-/object-hash-3.0.0.tgz",
      "integrity": "sha512-RSn9F68PjH9HqtltsSnqYC1XXoWe9Bju5+213R98cNGttag9q9yAOTzdbsqvIa7aNm5WffBZFpWYr2aWrklWAw==",
      "license": "MIT",
      "optional": true,
      "engines": {
        "node": ">= 6"
      }
    },
    "node_modules/object-inspect": {
      "version": "1.13.4",
      "resolved": "https://registry.npmjs.org/object-inspect/-/object-inspect-1.13.4.tgz",
      "integrity": "sha512-W67iLl4J2EXEGTbfeHCffrjDfitvLANg0UlX3wFUUSTx92KXRFegMHUVgSqE+wvhAbi4WqjGg9czysTV2Epbew==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/on-finished": {
      "version": "2.4.1",
      "resolved": "https://registry.npmjs.org/on-finished/-/on-finished-2.4.1.tgz",
      "integrity": "sha512-oVlzkg3ENAhCk2zdv7IJwd/QUD4z2RxRwpkcGY8psCVcCYZNq4wYnVWALHM+brtuJjePWiYF/ClmuDr8Ch5+kg==",
      "license": "MIT",
      "dependencies": {
        "ee-first": "1.1.1"
      },
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/once": {
      "version": "1.4.0",
      "resolved": "https://registry.npmjs.org/once/-/once-1.4.0.tgz",
      "integrity": "sha512-lNaJgI+2Q5URQBkccEKHTQOPaXdUxnZZElQTZY0MFUAuaEqe1E+Nyvgdz/aIyNi6Z9MzO5dv1H8n58/GELp3+w==",
      "license": "ISC",
      "dependencies": {
        "wrappy": "1"
      }
    },
    "node_modules/p-limit": {
      "version": "3.1.0",
      "resolved": "https://registry.npmjs.org/p-limit/-/p-limit-3.1.0.tgz",
      "integrity": "sha512-TYOanM3wGwNGsZN2cVTYPArw454xnXj5qmWF1bEoAc4+cU/ol7GVh7odevjp1FNHduHc3KZMcFduxU5Xc6uJRQ==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "yocto-queue": "^0.1.0"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/parseurl": {
      "version": "1.3.3",
      "resolved": "https://registry.npmjs.org/parseurl/-/parseurl-1.3.3.tgz",
      "integrity": "sha512-CiyeOxFT/JZyN5m0z9PfXw4SCBJ6Sygz1Dpl0wqjlhDEGGBP1GnsUVEL0p63hoG1fcj3fHynXi9NYO4nWOL+qQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/path-to-regexp": {
      "version": "8.2.0",
      "resolved": "https://registry.npmjs.org/path-to-regexp/-/path-to-regexp-8.2.0.tgz",
      "integrity": "sha512-TdrF7fW9Rphjq4RjrW0Kp2AW0Ahwu9sRGTkS6bvDi0SCwZlEZYmcfDbEsTz8RVk0EHIS/Vd1bv3JhG+1xZuAyQ==",
      "license": "MIT",
      "engines": {
        "node": ">=16"
      }
    },
    "node_modules/proto3-json-serializer": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/proto3-json-serializer/-/proto3-json-serializer-2.0.2.tgz",
      "integrity": "sha512-SAzp/O4Yh02jGdRc+uIrGoe87dkN/XtwxfZ4ZyafJHymd79ozp5VG5nyZ7ygqPM5+cpLDjjGnYFUkngonyDPOQ==",
      "license": "Apache-2.0",
      "optional": true,
      "dependencies": {
        "protobufjs": "^7.2.5"
      },
      "engines": {
        "node": ">=14.0.0"
      }
    },
    "node_modules/protobufjs": {
      "version": "7.5.3",
      "resolved": "https://registry.npmjs.org/protobufjs/-/protobufjs-7.5.3.tgz",
      "integrity": "sha512-sildjKwVqOI2kmFDiXQ6aEB0fjYTafpEvIBs8tOR8qI4spuL9OPROLVu2qZqi/xgCfsHIwVqlaF8JBjWFHnKbw==",
      "hasInstallScript": true,
      "license": "BSD-3-Clause",
      "optional": true,
      "dependencies": {
        "@protobufjs/aspromise": "^1.1.2",
        "@protobufjs/base64": "^1.1.2",
        "@protobufjs/codegen": "^2.0.4",
        "@protobufjs/eventemitter": "^1.1.0",
        "@protobufjs/fetch": "^1.1.0",
        "@protobufjs/float": "^1.0.2",
        "@protobufjs/inquire": "^1.1.0",
        "@protobufjs/path": "^1.1.2",
        "@protobufjs/pool": "^1.1.0",
        "@protobufjs/utf8": "^1.1.0",
        "@types/node": ">=13.7.0",
        "long": "^5.0.0"
      },
      "engines": {
        "node": ">=12.0.0"
      }
    },
    "node_modules/proxy-addr": {
      "version": "2.0.7",
      "resolved": "https://registry.npmjs.org/proxy-addr/-/proxy-addr-2.0.7.tgz",
      "integrity": "sha512-llQsMLSUDUPT44jdrU/O37qlnifitDP+ZwrmmZcoSKyLKvtZxpyV0n2/bD/N4tBAAZ/gJEdZU7KMraoK1+XYAg==",
      "license": "MIT",
      "dependencies": {
        "forwarded": "0.2.0",
        "ipaddr.js": "1.9.1"
      },
      "engines": {
        "node": ">= 0.10"
      }
    },
    "node_modules/qs": {
      "version": "6.14.1",
      "resolved": "https://registry.npmjs.org/qs/-/qs-6.14.1.tgz",
      "integrity": "sha512-4EK3+xJl8Ts67nLYNwqw/dsFVnCf+qR7RgXSK9jEEm9unao3njwMDdmsdvoKBKHzxd7tCYz5e5M+SnMjdtXGQQ==",
      "license": "BSD-3-Clause",
      "dependencies": {
        "side-channel": "^1.1.0"
      },
      "engines": {
        "node": ">=0.6"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/range-parser": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/range-parser/-/range-parser-1.2.1.tgz",
      "integrity": "sha512-Hrgsx+orqoygnmhFbKaHE6c296J+HTAQXoxEF6gNupROmmGJRoyzfG3ccAveqCBrwr/2yxQ5BVd/GTl5agOwSg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/raw-body": {
      "version": "3.0.2",
      "resolved": "https://registry.npmjs.org/raw-body/-/raw-body-3.0.2.tgz",
      "integrity": "sha512-K5zQjDllxWkf7Z5xJdV0/B0WTNqx6vxG70zJE4N0kBs4LovmEYWJzQGxC9bS9RAKu3bgM40lrd5zoLJ12MQ5BA==",
      "license": "MIT",
      "dependencies": {
        "bytes": "~3.1.2",
        "http-errors": "~2.0.1",
        "iconv-lite": "~0.7.0",
        "unpipe": "~1.0.0"
      },
      "engines": {
        "node": ">= 0.10"
      }
    },
    "node_modules/readable-stream": {
      "version": "3.6.2",
      "resolved": "https://registry.npmjs.org/readable-stream/-/readable-stream-3.6.2.tgz",
      "integrity": "sha512-9u/sniCrY3D5WdsERHzHE4G2YCXqoG5FTHUiCC4SIbr6XcLZBY05ya9EKjYek9O5xOAwjGq+1JdGBAS7Q9ScoA==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "inherits": "^2.0.3",
        "string_decoder": "^1.1.1",
        "util-deprecate": "^1.0.1"
      },
      "engines": {
        "node": ">= 6"
      }
    },
    "node_modules/require-directory": {
      "version": "2.1.1",
      "resolved": "https://registry.npmjs.org/require-directory/-/require-directory-2.1.1.tgz",
      "integrity": "sha512-fGxEI7+wsG9xrvdjsrlmL22OMTTiHRwAMroiEeMgq8gzoLC/PQr7RsRDSTLUg/bZAZtF+TVIkHc6/4RIKrui+Q==",
      "license": "MIT",
      "optional": true,
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/retry": {
      "version": "0.13.1",
      "resolved": "https://registry.npmjs.org/retry/-/retry-0.13.1.tgz",
      "integrity": "sha512-XQBQ3I8W1Cge0Seh+6gjj03LbmRFWuoszgK9ooCpwYIrhhoO80pfq4cUkU5DkknwfOfFteRwlZ56PYOGYyFWdg==",
      "license": "MIT",
      "optional": true,
      "engines": {
        "node": ">= 4"
      }
    },
    "node_modules/retry-request": {
      "version": "7.0.2",
      "resolved": "https://registry.npmjs.org/retry-request/-/retry-request-7.0.2.tgz",
      "integrity": "sha512-dUOvLMJ0/JJYEn8NrpOaGNE7X3vpI5XlZS/u0ANjqtcZVKnIxP7IgCFwrKTxENw29emmwug53awKtaMm4i9g5w==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "@types/request": "^2.48.8",
        "extend": "^3.0.2",
        "teeny-request": "^9.0.0"
      },
      "engines": {
        "node": ">=14"
      }
    },
    "node_modules/router": {
      "version": "2.2.0",
      "resolved": "https://registry.npmjs.org/router/-/router-2.2.0.tgz",
      "integrity": "sha512-nLTrUKm2UyiL7rlhapu/Zl45FwNgkZGaCpZbIHajDYgwlJCOzLSk+cIPAnsEqV955GjILJnKbdQC1nVPz+gAYQ==",
      "license": "MIT",
      "dependencies": {
        "debug": "^4.4.0",
        "depd": "^2.0.0",
        "is-promise": "^4.0.0",
        "parseurl": "^1.3.3",
        "path-to-regexp": "^8.0.0"
      },
      "engines": {
        "node": ">= 18"
      }
    },
    "node_modules/safe-buffer": {
      "version": "5.2.1",
      "resolved": "https://registry.npmjs.org/safe-buffer/-/safe-buffer-5.2.1.tgz",
      "integrity": "sha512-rp3So07KcdmmKbGvgaNxQSJr7bGVSVk5S9Eq1F+ppbRo70+YeaDxkw5Dd8NPN+GD6bjnYm2VuPuCXmpuYvmCXQ==",
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ],
      "license": "MIT"
    },
    "node_modules/safer-buffer": {
      "version": "2.1.2",
      "resolved": "https://registry.npmjs.org/safer-buffer/-/safer-buffer-2.1.2.tgz",
      "integrity": "sha512-YZo3K82SD7Riyi0E1EQPojLz7kpepnSQI9IyPbHHg1XXXevb5dJI7tpyN2ADxGcQbHG7vcyRHk0cbwqcQriUtg==",
      "license": "MIT"
    },
    "node_modules/semver": {
      "version": "7.7.2",
      "resolved": "https://registry.npmjs.org/semver/-/semver-7.7.2.tgz",
      "integrity": "sha512-RF0Fw+rO5AMf9MAyaRXI4AV0Ulj5lMHqVxxdSgiVbixSCXoEmmX/jk0CuJw4+3SqroYO9VoUh+HcuJivvtJemA==",
      "license": "ISC",
      "bin": {
        "semver": "bin/semver.js"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/send": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/send/-/send-1.2.0.tgz",
      "integrity": "sha512-uaW0WwXKpL9blXE2o0bRhoL2EGXIrZxQ2ZQ4mgcfoBxdFmQold+qWsD2jLrfZ0trjKL6vOw0j//eAwcALFjKSw==",
      "license": "MIT",
      "dependencies": {
        "debug": "^4.3.5",
        "encodeurl": "^2.0.0",
        "escape-html": "^1.0.3",
        "etag": "^1.8.1",
        "fresh": "^2.0.0",
        "http-errors": "^2.0.0",
        "mime-types": "^3.0.1",
        "ms": "^2.1.3",
        "on-finished": "^2.4.1",
        "range-parser": "^1.2.1",
        "statuses": "^2.0.1"
      },
      "engines": {
        "node": ">= 18"
      }
    },
    "node_modules/serve-static": {
      "version": "2.2.0",
      "resolved": "https://registry.npmjs.org/serve-static/-/serve-static-2.2.0.tgz",
      "integrity": "sha512-61g9pCh0Vnh7IutZjtLGGpTA355+OPn2TyDv/6ivP2h/AdAVX9azsoxmg2/M6nZeQZNYBEwIcsne1mJd9oQItQ==",
      "license": "MIT",
      "dependencies": {
        "encodeurl": "^2.0.0",
        "escape-html": "^1.0.3",
        "parseurl": "^1.3.3",
        "send": "^1.2.0"
      },
      "engines": {
        "node": ">= 18"
      }
    },
    "node_modules/setprototypeof": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/setprototypeof/-/setprototypeof-1.2.0.tgz",
      "integrity": "sha512-E5LDX7Wrp85Kil5bhZv46j8jOeboKq5JMmYM3gVGdGH8xFpPWXUMsNrlODCrkoxMEeNi/XZIwuRvY4XNwYMJpw==",
      "license": "ISC"
    },
    "node_modules/side-channel": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/side-channel/-/side-channel-1.1.0.tgz",
      "integrity": "sha512-ZX99e6tRweoUXqR+VBrslhda51Nh5MTQwou5tnUDgbtyM0dBgmhEDtWGP/xbKn6hqfPRHujUNwz5fy/wbbhnpw==",
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "object-inspect": "^1.13.3",
        "side-channel-list": "^1.0.0",
        "side-channel-map": "^1.0.1",
        "side-channel-weakmap": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/side-channel-list": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/side-channel-list/-/side-channel-list-1.0.0.tgz",
      "integrity": "sha512-FCLHtRD/gnpCiCHEiJLOwdmFP+wzCmDEkc9y7NsYxeF4u7Btsn1ZuwgwJGxImImHicJArLP4R0yX4c2KCrMrTA==",
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "object-inspect": "^1.13.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/side-channel-map": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/side-channel-map/-/side-channel-map-1.0.1.tgz",
      "integrity": "sha512-VCjCNfgMsby3tTdo02nbjtM/ewra6jPHmpThenkTYh8pG9ucZ/1P8So4u4FGBek/BjpOVsDCMoLA/iuBKIFXRA==",
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.5",
        "object-inspect": "^1.13.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/side-channel-weakmap": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/side-channel-weakmap/-/side-channel-weakmap-1.0.2.tgz",
      "integrity": "sha512-WPS/HvHQTYnHisLo9McqBHOJk2FkHO/tlpvldyrnem4aeQp4hai3gythswg6p01oSoTl58rcpiFAjF2br2Ak2A==",
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.5",
        "object-inspect": "^1.13.3",
        "side-channel-map": "^1.0.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/socket.io": {
      "version": "4.8.1",
      "resolved": "https://registry.npmjs.org/socket.io/-/socket.io-4.8.1.tgz",
      "integrity": "sha512-oZ7iUCxph8WYRHHcjBEc9unw3adt5CmSNlppj/5Q4k2RIrhl8Z5yY2Xr4j9zj0+wzVZ0bxmYoGSzKJnRl6A4yg==",
      "license": "MIT",
      "dependencies": {
        "accepts": "~1.3.4",
        "base64id": "~2.0.0",
        "cors": "~2.8.5",
        "debug": "~4.3.2",
        "engine.io": "~6.6.0",
        "socket.io-adapter": "~2.5.2",
        "socket.io-parser": "~4.2.4"
      },
      "engines": {
        "node": ">=10.2.0"
      }
    },
    "node_modules/socket.io-adapter": {
      "version": "2.5.5",
      "resolved": "https://registry.npmjs.org/socket.io-adapter/-/socket.io-adapter-2.5.5.tgz",
      "integrity": "sha512-eLDQas5dzPgOWCk9GuuJC2lBqItuhKI4uxGgo9aIV7MYbk2h9Q6uULEh8WBzThoI7l+qU9Ast9fVUmkqPP9wYg==",
      "license": "MIT",
      "dependencies": {
        "debug": "~4.3.4",
        "ws": "~8.17.1"
      }
    },
    "node_modules/socket.io-adapter/node_modules/debug": {
      "version": "4.3.7",
      "resolved": "https://registry.npmjs.org/debug/-/debug-4.3.7.tgz",
      "integrity": "sha512-Er2nc/H7RrMXZBFCEim6TCmMk02Z8vLC2Rbi1KEBggpo0fS6l0S1nnapwmIi3yW/+GOJap1Krg4w0Hg80oCqgQ==",
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.3"
      },
      "engines": {
        "node": ">=6.0"
      },
      "peerDependenciesMeta": {
        "supports-color": {
          "optional": true
        }
      }
    },
    "node_modules/socket.io-parser": {
      "version": "4.2.4",
      "resolved": "https://registry.npmjs.org/socket.io-parser/-/socket.io-parser-4.2.4.tgz",
      "integrity": "sha512-/GbIKmo8ioc+NIWIhwdecY0ge+qVBSMdgxGygevmdHj24bsfgtCmcUUcQ5ZzcylGFHsN3k4HB4Cgkl96KVnuew==",
      "license": "MIT",
      "dependencies": {
        "@socket.io/component-emitter": "~3.1.0",
        "debug": "~4.3.1"
      },
      "engines": {
        "node": ">=10.0.0"
      }
    },
    "node_modules/socket.io-parser/node_modules/debug": {
      "version": "4.3.7",
      "resolved": "https://registry.npmjs.org/debug/-/debug-4.3.7.tgz",
      "integrity": "sha512-Er2nc/H7RrMXZBFCEim6TCmMk02Z8vLC2Rbi1KEBggpo0fS6l0S1nnapwmIi3yW/+GOJap1Krg4w0Hg80oCqgQ==",
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.3"
      },
      "engines": {
        "node": ">=6.0"
      },
      "peerDependenciesMeta": {
        "supports-color": {
          "optional": true
        }
      }
    },
    "node_modules/socket.io/node_modules/accepts": {
      "version": "1.3.8",
      "resolved": "https://registry.npmjs.org/accepts/-/accepts-1.3.8.tgz",
      "integrity": "sha512-PYAthTa2m2VKxuvSD3DPC/Gy+U+sOA1LAuT8mkmRuvw+NACSaeXEQ+NHcVF7rONl6qcaxV3Uuemwawk+7+SJLw==",
      "license": "MIT",
      "dependencies": {
        "mime-types": "~2.1.34",
        "negotiator": "0.6.3"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/socket.io/node_modules/debug": {
      "version": "4.3.7",
      "resolved": "https://registry.npmjs.org/debug/-/debug-4.3.7.tgz",
      "integrity": "sha512-Er2nc/H7RrMXZBFCEim6TCmMk02Z8vLC2Rbi1KEBggpo0fS6l0S1nnapwmIi3yW/+GOJap1Krg4w0Hg80oCqgQ==",
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.3"
      },
      "engines": {
        "node": ">=6.0"
      },
      "peerDependenciesMeta": {
        "supports-color": {
          "optional": true
        }
      }
    },
    "node_modules/socket.io/node_modules/mime-db": {
      "version": "1.52.0",
      "resolved": "https://registry.npmjs.org/mime-db/-/mime-db-1.52.0.tgz",
      "integrity": "sha512-sPU4uV7dYlvtWJxwwxHD0PuihVNiE7TyAbQ5SWxDCB9mUYvOgroQOwYQQOKPJ8CIbE+1ETVlOoK1UC2nU3gYvg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/socket.io/node_modules/mime-types": {
      "version": "2.1.35",
      "resolved": "https://registry.npmjs.org/mime-types/-/mime-types-2.1.35.tgz",
      "integrity": "sha512-ZDY+bPm5zTTF+YpCrAU9nK0UgICYPT0QtT1NZWFv4s++TNkcgVaT0g6+4R2uI4MjQjzysHB1zxuWL50hzaeXiw==",
      "license": "MIT",
      "dependencies": {
        "mime-db": "1.52.0"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/socket.io/node_modules/negotiator": {
      "version": "0.6.3",
      "resolved": "https://registry.npmjs.org/negotiator/-/negotiator-0.6.3.tgz",
      "integrity": "sha512-+EUsqGPLsM+j/zdChZjsnX51g4XrHFOIXwfnCVPGlQk/k5giakcKsuxCObBRu6DSm9opw/O6slWbJdghQM4bBg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/statuses": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/statuses/-/statuses-2.0.2.tgz",
      "integrity": "sha512-DvEy55V3DB7uknRo+4iOGT5fP1slR8wQohVdknigZPMpMstaKJQWhwiYBACJE3Ul2pTnATihhBYnRhZQHGBiRw==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/stream-events": {
      "version": "1.0.5",
      "resolved": "https://registry.npmjs.org/stream-events/-/stream-events-1.0.5.tgz",
      "integrity": "sha512-E1GUzBSgvct8Jsb3v2X15pjzN1tYebtbLaMg+eBOUOAxgbLoSbT2NS91ckc5lJD1KfLjId+jXJRgo0qnV5Nerg==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "stubs": "^3.0.0"
      }
    },
    "node_modules/stream-shift": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/stream-shift/-/stream-shift-1.0.3.tgz",
      "integrity": "sha512-76ORR0DO1o1hlKwTbi/DM3EXWGf3ZJYO8cXX5RJwnul2DEg2oyoZyjLNoQM8WsvZiFKCRfC1O0J7iCvie3RZmQ==",
      "license": "MIT",
      "optional": true
    },
    "node_modules/string_decoder": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/string_decoder/-/string_decoder-1.3.0.tgz",
      "integrity": "sha512-hkRX8U1WjJFd8LsDJ2yQ/wWWxaopEsABU1XfkM8A+j0+85JAGppt16cr1Whg6KIbb4okU6Mql6BOj+uup/wKeA==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "safe-buffer": "~5.2.0"
      }
    },
    "node_modules/string-width": {
      "version": "4.2.3",
      "resolved": "https://registry.npmjs.org/string-width/-/string-width-4.2.3.tgz",
      "integrity": "sha512-wKyQRQpjJ0sIp62ErSZdGsjMJWsap5oRNihHhu6G7JVO/9jIB6UyevL+tXuOqrng8j/cxKTWyWUwvSTriiZz/g==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "emoji-regex": "^8.0.0",
        "is-fullwidth-code-point": "^3.0.0",
        "strip-ansi": "^6.0.1"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/strip-ansi": {
      "version": "6.0.1",
      "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz",
      "integrity": "sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "ansi-regex": "^5.0.1"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/strnum": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/strnum/-/strnum-1.1.2.tgz",
      "integrity": "sha512-vrN+B7DBIoTTZjnPNewwhx6cBA/H+IS7rfW68n7XxC1y7uoiGQBxaKzqucGUgavX15dJgiGztLJ8vxuEzwqBdA==",
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/NaturalIntelligence"
        }
      ],
      "license": "MIT",
      "optional": true
    },
    "node_modules/stubs": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/stubs/-/stubs-3.0.0.tgz",
      "integrity": "sha512-PdHt7hHUJKxvTCgbKX9C1V/ftOcjJQgz8BZwNfV5c4B6dcGqlpelTbJ999jBGZ2jYiPAwcX5dP6oBwVlBlUbxw==",
      "license": "MIT",
      "optional": true
    },
    "node_modules/teeny-request": {
      "version": "9.0.0",
      "resolved": "https://registry.npmjs.org/teeny-request/-/teeny-request-9.0.0.tgz",
      "integrity": "sha512-resvxdc6Mgb7YEThw6G6bExlXKkv6+YbuzGg9xuXxSgxJF7Ozs+o8Y9+2R3sArdWdW8nOokoQb1yrpFB0pQK2g==",
      "license": "Apache-2.0",
      "optional": true,
      "dependencies": {
        "http-proxy-agent": "^5.0.0",
        "https-proxy-agent": "^5.0.0",
        "node-fetch": "^2.6.9",
        "stream-events": "^1.0.5",
        "uuid": "^9.0.0"
      },
      "engines": {
        "node": ">=14"
      }
    },
    "node_modules/teeny-request/node_modules/agent-base": {
      "version": "6.0.2",
      "resolved": "https://registry.npmjs.org/agent-base/-/agent-base-6.0.2.tgz",
      "integrity": "sha512-RZNwNclF7+MS/8bDg70amg32dyeZGZxiDuQmZxKLAlQjr3jGyLx+4Kkk58UO7D2QdgFIQCovuSuZESne6RG6XQ==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "debug": "4"
      },
      "engines": {
        "node": ">= 6.0.0"
      }
    },
    "node_modules/teeny-request/node_modules/https-proxy-agent": {
      "version": "5.0.1",
      "resolved": "https://registry.npmjs.org/https-proxy-agent/-/https-proxy-agent-5.0.1.tgz",
      "integrity": "sha512-dFcAjpTQFgoLMzC2VwU+C/CbS7uRL0lWmxDITmqm7C+7F0Odmj6s9l6alZc6AELXhrnggM2CeWSXHGOdX2YtwA==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "agent-base": "6",
        "debug": "4"
      },
      "engines": {
        "node": ">= 6"
      }
    },
    "node_modules/teeny-request/node_modules/uuid": {
      "version": "9.0.1",
      "resolved": "https://registry.npmjs.org/uuid/-/uuid-9.0.1.tgz",
      "integrity": "sha512-b+1eJOlsR9K8HJpow9Ok3fiWOWSIcIzXodvv0rQjVoOVNpWMpxf1wZNpt4y9h10odCNrqnYp1OBzRktckBe3sA==",
      "funding": [
        "https://github.com/sponsors/broofa",
        "https://github.com/sponsors/ctavan"
      ],
      "license": "MIT",
      "optional": true,
      "bin": {
        "uuid": "dist/bin/uuid"
      }
    },
    "node_modules/toidentifier": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/toidentifier/-/toidentifier-1.0.1.tgz",
      "integrity": "sha512-o5sSPKEkg/DIQNmH43V0/uerLrpzVedkUh8tGNvaeXpfpuwjKenlSox/2O/BTlZUtEe+JG7s5YhEz608PlAHRA==",
      "license": "MIT",
      "engines": {
        "node": ">=0.6"
      }
    },
    "node_modules/tr46": {
      "version": "0.0.3",
      "resolved": "https://registry.npmjs.org/tr46/-/tr46-0.0.3.tgz",
      "integrity": "sha512-N3WMsuqV66lT30CrXNbEjx4GEwlow3v6rr4mCcv6prnfwhS01rkgyFdjPNBYd9br7LpXV1+Emh01fHnq2Gdgrw==",
      "license": "MIT"
    },
    "node_modules/tslib": {
      "version": "2.8.1",
      "resolved": "https://registry.npmjs.org/tslib/-/tslib-2.8.1.tgz",
      "integrity": "sha512-oJFu94HQb+KVduSUQL7wnpmqnfmLsOA/nAh6b6EH0wCEoK0/mPeXU6c3wKDV83MkOuHPRHtSXKKU99IBazS/2w==",
      "license": "0BSD"
    },
    "node_modules/type-is": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/type-is/-/type-is-2.0.1.tgz",
      "integrity": "sha512-OZs6gsjF4vMp32qrCbiVSkrFmXtG/AZhY3t0iAMrMBiAZyV9oALtXO8hsrHbMXF9x6L3grlFuwW2oAz7cav+Gw==",
      "license": "MIT",
      "dependencies": {
        "content-type": "^1.0.5",
        "media-typer": "^1.1.0",
        "mime-types": "^3.0.0"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/undici-types": {
      "version": "7.10.0",
      "resolved": "https://registry.npmjs.org/undici-types/-/undici-types-7.10.0.tgz",
      "integrity": "sha512-t5Fy/nfn+14LuOc2KNYg75vZqClpAiqscVvMygNnlsHBFpSXdJaYtXMcdNLpl/Qvc3P2cB3s6lOV51nqsFq4ag==",
      "license": "MIT"
    },
    "node_modules/unpipe": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/unpipe/-/unpipe-1.0.0.tgz",
      "integrity": "sha512-pjy2bYhSsufwWlKwPc+l3cN7+wuJlK6uz0YdJEOlQDbl6jo/YlPi4mb8agUkVC8BF7V8NuzeyPNqRksA3hztKQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/util-deprecate": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/util-deprecate/-/util-deprecate-1.0.2.tgz",
      "integrity": "sha512-EPD5q1uXyFxJpCrLnCc1nHnq3gOa6DZBocAIiI2TaSCA7VCJ1UJDMagCzIkXNsUYfD1daK//LTEQ8xiIbrHtcw==",
      "license": "MIT",
      "optional": true
    },
    "node_modules/uuid": {
      "version": "11.1.0",
      "resolved": "https://registry.npmjs.org/uuid/-/uuid-11.1.0.tgz",
      "integrity": "sha512-0/A9rDy9P7cJ+8w1c9WD9V//9Wj15Ce2MPz8Ri6032usz+NfePxx5AcN3bN+r6ZL6jEo066/yNYB3tn4pQEx+A==",
      "funding": [
        "https://github.com/sponsors/broofa",
        "https://github.com/sponsors/ctavan"
      ],
      "license": "MIT",
      "bin": {
        "uuid": "dist/esm/bin/uuid"
      }
    },
    "node_modules/vary": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/vary/-/vary-1.1.2.tgz",
      "integrity": "sha512-BNGbWLfd0eUPabhkXUVm0j8uuvREyTh5ovRa/dyow/BqAbZJyC+5fU+IzQOzmAKzYqYRAISoRhdQr3eIZ/PXqg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/webidl-conversions": {
      "version": "3.0.1",
      "resolved": "https://registry.npmjs.org/webidl-conversions/-/webidl-conversions-3.0.1.tgz",
      "integrity": "sha512-2JAn3z8AR6rjK8Sm8orRC0h/bcl/DqL7tRPdGZ4I1CjdF+EaMLmYxBHyXuKL849eucPFhvBoxMsflfOb8kxaeQ==",
      "license": "BSD-2-Clause"
    },
    "node_modules/websocket-driver": {
      "version": "0.7.4",
      "resolved": "https://registry.npmjs.org/websocket-driver/-/websocket-driver-0.7.4.tgz",
      "integrity": "sha512-b17KeDIQVjvb0ssuSDF2cYXSg2iztliJ4B9WdsuB6J952qCPKmnVq4DyW5motImXHDC1cBT/1UezrJVsKw5zjg==",
      "license": "Apache-2.0",
      "dependencies": {
        "http-parser-js": ">=0.5.1",
        "safe-buffer": ">=5.1.0",
        "websocket-extensions": ">=0.1.1"
      },
      "engines": {
        "node": ">=0.8.0"
      }
    },
    "node_modules/websocket-extensions": {
      "version": "0.1.4",
      "resolved": "https://registry.npmjs.org/websocket-extensions/-/websocket-extensions-0.1.4.tgz",
      "integrity": "sha512-OqedPIGOfsDlo31UNwYbCFMSaO9m9G/0faIHj5/dZFDMFqPTcx6UwqyOy3COEaEOg/9VsGIpdqn62W5KhoKSpg==",
      "license": "Apache-2.0",
      "engines": {
        "node": ">=0.8.0"
      }
    },
    "node_modules/whatwg-url": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/whatwg-url/-/whatwg-url-5.0.0.tgz",
      "integrity": "sha512-saE57nupxk6v3HY35+jzBwYa0rKSy0XR8JSxZPwgLr7ys0IBzhGviA1/TUGJLmSVqs8pb9AnvICXEuOHLprYTw==",
      "license": "MIT",
      "dependencies": {
        "tr46": "~0.0.3",
        "webidl-conversions": "^3.0.0"
      }
    },
    "node_modules/wrap-ansi": {
      "version": "7.0.0",
      "resolved": "https://registry.npmjs.org/wrap-ansi/-/wrap-ansi-7.0.0.tgz",
      "integrity": "sha512-YVGIj2kamLSTxw6NsZjoBxfSwsn0ycdesmc4p+Q21c5zPuZ1pl+NfxVdxPtdHvmNVOQ6XSYG4AUtyt/Fi7D16Q==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "ansi-styles": "^4.0.0",
        "string-width": "^4.1.0",
        "strip-ansi": "^6.0.0"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/chalk/wrap-ansi?sponsor=1"
      }
    },
    "node_modules/wrappy": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/wrappy/-/wrappy-1.0.2.tgz",
      "integrity": "sha512-l4Sp/DRseor9wL6EvV2+TuQn63dMkPjZ/sp9XkghTEbV9KlPS1xUsZ3u7/IQO4wxtcFB4bgpQPRcR3QCvezPcQ==",
      "license": "ISC"
    },
    "node_modules/ws": {
      "version": "8.17.1",
      "resolved": "https://registry.npmjs.org/ws/-/ws-8.17.1.tgz",
      "integrity": "sha512-6XQFvXTkbfUOZOKKILFG1PDK2NDQs4azKQl26T0YS5CxqWLgXajbPZ+h4gZekJyRqFU8pvnbAbbs/3TgRPy+GQ==",
      "license": "MIT",
      "engines": {
        "node": ">=10.0.0"
      },
      "peerDependencies": {
        "bufferutil": "^4.0.1",
        "utf-8-validate": ">=5.0.2"
      },
      "peerDependenciesMeta": {
        "bufferutil": {
          "optional": true
        },
        "utf-8-validate": {
          "optional": true
        }
      }
    },
    "node_modules/y18n": {
      "version": "5.0.8",
      "resolved": "https://registry.npmjs.org/y18n/-/y18n-5.0.8.tgz",
      "integrity": "sha512-0pfFzegeDWJHJIAmTLRP2DwHjdF5s7jo9tuztdQxAhINCdvS+3nGINqPd00AphqJR/0LhANUS6/+7SCb98YOfA==",
      "license": "ISC",
      "optional": true,
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/yallist": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/yallist/-/yallist-4.0.0.tgz",
      "integrity": "sha512-3wdGidZyq5PB084XLES5TpOSRA3wjXAlIWMhum2kRcv/41Sn2emQ0dycQW4uZXLejwKvg6EsvbdlVL+FYEct7A==",
      "license": "ISC"
    },
    "node_modules/yargs": {
      "version": "17.7.2",
      "resolved": "https://registry.npmjs.org/yargs/-/yargs-17.7.2.tgz",
      "integrity": "sha512-7dSzzRQ++CKnNI/krKnYRV7JKKPUXMEh61soaHKg9mrWEhzFWhFnxPxGl+69cD1Ou63C13NUPCnmIcrvqCuM6w==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "cliui": "^8.0.1",
        "escalade": "^3.1.1",
        "get-caller-file": "^2.0.5",
        "require-directory": "^2.1.1",
        "string-width": "^4.2.3",
        "y18n": "^5.0.5",
        "yargs-parser": "^21.1.1"
      },
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/yargs-parser": {
      "version": "21.1.1",
      "resolved": "https://registry.npmjs.org/yargs-parser/-/yargs-parser-21.1.1.tgz",
      "integrity": "sha512-tVpsJW7DdjecAiFpbIB1e3qxIQsE6NoPc5/eTdrbbIC4h0LVsWhnoa3g+m2HclBIujHzsxZ4VJVA+GUuc2/LBw==",
      "license": "ISC",
      "optional": true,
      "engines": {
        "node": ">=12"
      }
    },
    "node_modules/yocto-queue": {
      "version": "0.1.0",
      "resolved": "https://registry.npmjs.org/yocto-queue/-/yocto-queue-0.1.0.tgz",
      "integrity": "sha512-rVksvsnNCdJ/ohGc6xgPwyN8eheCxsiLM8mxuE/t/mOVqJewPuO1miLpTHQiRgTKCLexL4MeAFVagts7HmNZ2Q==",
      "license": "MIT",
      "optional": true,
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    }
  }
}



--- FICHIER : package.json ---
{
  "name": "hint-or-lie",
  "version": "1.0.0",
  "description": "Jeu multijoueur en ligne - Hint or Lie (by Mits)",
  "main": "server.js",
  "author": "Mits",
  "license": "ISC",
  "dependencies": {
    "express": "^5.1.0",
    "firebase-admin": "^13.4.0",
    "socket.io": "^4.8.1"
  },
  "scripts": {
    "start": "node server.js",
    "pack": "node pack.js",
    "dev": "nodemon server.js"
  }
}


--- FICHIER : RECOMMANDATIONS_APPLIQUEES.md ---
# ðŸ“‹ Recommandations AppliquÃ©es âœ…

## Changements implÃ©mentÃ©s pour amÃ©liorer les scÃ©narios

---

## 1ï¸âƒ£ **Modal "En attente" pour Spectateurs** âœ…

### ProblÃ¨me identifiÃ©
Les spectateurs (joueurs qui rejoignent pendant une manche) n'avaient aucun feedback visuel. Ils Ã©taient "perdus" sans Ã©cran appropriÃ©.

### Solution appliquÃ©e

#### HTML (`public/index.html`)
- Ajout d'une **modale persistante** `#spectator-waiting`
- Affiche la **phase actuelle** (Indices, Vote, RÃ©vÃ©lation)
- Bouton "Quitter" pour laisser la salle
- Message explicite : "Vous rejoindrez la prochaine manche"

#### CSS (`public/css/09-spectator.css` - NOUVEAU)
- Animation `slideInDown` au dÃ©marrage
- Pulsation du titre (effet glow)
- Style cohÃ©rent avec la palette du jeu
- Z-index 1000 pour rester au-dessus du contenu

#### JavaScript (`public/js/core/socket.js`)
```javascript
socket.on('spectatorMode', ({ phase, message }) => {
  // Affiche la modal
  // Masque tous les Ã©crans de jeu
  // Met Ã  jour le label de phase
});

socket.on('roomJoined', () => {
  // Ferme la modal quand on rejoint une nouvelle manche
});
```

---

## 2ï¸âƒ£ **Reconnect Handler â€” Ã‰tat du jeu synchro** âœ…

### ProblÃ¨me identifiÃ©
Quand un joueur se reconnectait rapidement, il ne recevait pas l'Ã©tat du jeu (round, scores, phase). Les donnÃ©es locales n'Ã©taient pas Ã  jour.

### Solution appliquÃ©e

#### Serveur (`routes/sockets/index.js` - joinRoom)
```javascript
// AprÃ¨s reconnexion dÃ©tectÃ©e
const gameState = {
  state: r.state,
  phase: r.state,
  round: r.round,
  players: [...],
  scores: { ... }
};
socket.emit('gameStateSync', gameState);
```

#### Client (`public/js/core/socket.js`)
```javascript
socket.on('gameStateSync', ({ state, phase, round, players, scores }) => {
  // Met Ã  jour window.HOL.state avec les donnÃ©es serveur
  // Ensure le client est synchronisÃ©
});
```

**RÃ©sultat :** Les spectateurs reconnectÃ©s reÃ§oivent automatiquement l'Ã©tat et affichent la bonne modale de spectateur.

---

## 3ï¸âƒ£ **PÃ©nalitÃ© RP (Ranking Points)** âœ…

### Status
âœ… **DÃ‰JÃ€ IMPLÃ‰MENTÃ‰ CORRECTEMENT**

Le code dans `routes/sockets/game/controller.js` en ligne 275-284 est correct :

```javascript
// Ã€ la fin de partie (quand maxScore >= 10)
if (typeof applyPenaltyIfNotWinner === 'function') {
  const winnerIds = new Set(winnersArr.map(w => w.id));
  for (const [id, p] of activePlayers) {
    if (!winnerIds.has(id) && p?.deviceId) {
      applyPenaltyIfNotWinner({ deviceId: p.deviceId, pseudo: p.name })
        .catch(() => {}); // Silencieux
    }
  }
}
```

**Flux :**
1. Les gagnants sont identifiÃ©s (score maximal)
2. Les perdants reÃ§oivent une **pÃ©nalitÃ© RP** (fonction Firebase)
3. SauvegardÃ© en base de donnÃ©es
4. AppliquÃ© AVANT le reset de la partie

---

## 4ï¸âƒ£ **Message Spectateur au Rejoindre** âœ…

### Status
âœ… **DÃ‰JÃ€ IMPLÃ‰MENTÃ‰**

Quand quelqu'un rejoint pendant une manche, le serveur envoie :
```javascript
socket.emit('spectatorMode', { 
  phase: r.state, 
  message: 'Manche en cours. Vous rejoindrez la prochaine manche.' 
});
```

La modale spectateur affiche ce message automatiquement.

---

## ðŸ“Š RÃ©sumÃ© des changements

| Composant | Avant | AprÃ¨s |
|-----------|-------|-------|
| **UX Spectateur** | Aucun feedback | Modal explicite + phase affichÃ©e |
| **Reconnexion** | DonnÃ©es dÃ©synchronisÃ©es | Ã‰tat du jeu envoyÃ© automatiquement |
| **PÃ©nalitÃ© RP** | âœ… Fonctionnel | âœ… ConfirmÃ© fonctionnel |
| **Message feedback** | âœ… PrÃ©sent | âœ… IntÃ©grÃ© Ã  la modale |

---

## ðŸŽ¯ Prochaines Ã©tapes (Ã  discuter)

AprÃ¨s ces recommandations, on peut se pencher sur :

1. **DÃ©connexions â€” Catch-up mÃ©canique**
   - Quand un joueur dÃ©co pendant hints/voting et se reconnecte
   - Devrait-il recevoir la liste d'indices manquÃ©e ?
   - Ou relancer les donnÃ©es manuellement ?

2. **Vote hintId â†’ playerId â€” Validation robuste**
   - Que faire si un vote ne correspond Ã  aucun indice ?
   - Rejeter le vote ou l'ignorer silencieusement ?

3. **Spectateurs â†’ Actifs â€” Timing exact**
   - Un spectateur du round 2 devient-il actif dÃ¨s le round 3 ?
   - Ou au prochain lobby ready ?

4. **Fin de partie â€” Export des stats**
   - Affichage du classement final avec RP
   - Historique des manches ?

Dis-moi quand tu es prÃªt pour continuer ! ðŸš€



--- FICHIER : server.js ---
const express = require('express');
const http = require('http');
const path = require('path');
const { Server } = require('socket.io');

// routes & sockets
const setupRoutes = require('./routes');
const setupSockets = require('./routes/sockets');

// config gÃ©nÃ©rale (tes HINT_SECONDS etc. si besoin)
const config = require('./config');

const app = express();
app.use(express.static(path.join(__dirname, 'public')));
setupRoutes(app);

const server = http.createServer(app);
const io = new Server(server, { cors: { origin: '*' } });

// Firebase (optionnel)
let db = null;
try { ({ db } = require('./config/firebase.js')); }
catch { console.log('âš ï¸ Firebase non configurÃ© â€” tests sans persistence.'); }

// branchement sockets
setupSockets(io, db);

// listen
const PORT = process.env.PORT || 5500;
server.listen(PORT, () => console.log('Hint or Lie â€” port', PORT));


--- FICHIER : .vscode/settings.json ---
{
    "chat.tools.terminal.autoApprove": {
        "/^node -e \"const fs=require\\('fs'\\);const f='\\./public/css/03-components\\.css';let c=fs\\.readFileSync\\(f,'utf8'\\);c=c\\.replace\\(/\\\\/\\\\\\*\\\\s\\*===\\\\s\\*Phase bar:\\.\\*\\?@media\\.\\*\\?560px\\\\s\\*\\\\\\{\\[\\^\\}\\]\\*\\\\\\}\\\\s\\*\\\\\\}/s,'/\\* Phase bar layout moved to 04-phase\\.css \\*/'\\);fs\\.writeFileSync\\(f,c\\);\"$/": {
            "approve": true,
            "matchCommandLine": true
        }
    },
    "geminicodeassist.agentYoloMode": true
}


--- FICHIER : config/config.js ---
module.exports = {
  HINT_SECONDS: 60,
  VOTE_SECONDS: 45,
  LOBBY_READY_SECONDS: 10
};



--- FICHIER : config/firebase.js ---
// config/firebase.js
const admin = require('firebase-admin');

let db = null;

try {
  // 1) En prod (Render, etc.) : on lit la clÃ© depuis une VARIABLE Dâ€™ENV
  //    -> mets tout le JSON de la clÃ© dans FIREBASE_SERVICE_ACCOUNT
  let creds = null;
  if (process.env.FIREBASE_SERVICE_ACCOUNT) {
    creds = JSON.parse(process.env.FIREBASE_SERVICE_ACCOUNT);
    // les sauts de ligne arrivent souvent Ã©chappÃ©s dans les env vars
    if (typeof creds.private_key === 'string') {
      creds.private_key = creds.private_key.replace(/\\n/g, '\n');
    }
  } else {
    // 2) En local : on lit le fichier ignorÃ© par git
    //    (ne JAMAIS le commiter)
    creds = require('./firebase-service-account.json');
  }

  admin.initializeApp({
    credential: admin.credential.cert(creds),
  });

  db = admin.firestore();
  console.log('âœ… Firebase configurÃ©');
} catch (e) {
  console.log('âš ï¸ Firebase non configurÃ© â€”', e.message);
}

module.exports = { db };



--- FICHIER : config/index.js ---
// Constantes configurables (via variables dâ€™env.)
module.exports = {
  PORT: Number(process.env.PORT) || 3000,
  HINT_SECONDS: Number(process.env.HINT_SECONDS) || 45,
  VOTE_SECONDS: Number(process.env.VOTE_SECONDS) || 40,
  LOBBY_READY_SECONDS: Number(process.env.LOBBY_READY_SECONDS) || 10,
};


--- FICHIER : public/css/01-tokens.css ---



--- FICHIER : public/css/02-base.css ---



--- FICHIER : public/css/03-components.css ---



--- FICHIER : public/css/04-phase.css ---



--- FICHIER : public/css/05-hints.css ---



--- FICHIER : public/css/06-vote.css ---



--- FICHIER : public/css/07-modal-score.css ---



--- FICHIER : public/css/07-scoreboard.css ---



--- FICHIER : public/css/08-lobby-header.css ---



--- FICHIER : public/css/09-spectator.css ---



--- FICHIER : public/css/10-scoreboard.css ---



--- FICHIER : public/css/98-responsive.css ---



--- FICHIER : public/css/99-pwa-update.css ---



--- FICHIER : public/css/hud.css ---
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');

:root {
    --font-sans: 'Inter', sans-serif;
    
    --color-background: #0a0e14;
    --color-accent-hud: #00f2ff;
    --color-accent-glow: rgba(0, 242, 255, 0.5);
    --color-text-primary: #ffffff;
    --color-text-secondary: #a0a8b3;
    
    --color-glass-bg: rgba(255, 255, 255, 0.05);
    --color-glass-border: rgba(255, 255, 255, 0.1);
    --color-glass-border-active: rgba(0, 242, 255, 0.3);

    --panel-border-radius: 16px;
    --input-border-radius: 8px;
    --btn-border-radius: 8px;

    --transition-fast: 0.2s ease;
    --transition-medium: 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

/* --- BASE & BODY --- */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

html, body {
    height: 100%;
}

body {
    font-family: var(--font-sans);
    background-color: var(--color-background);
    color: var(--color-text-primary);
    background-image: radial-gradient(circle at 50% 50%, rgba(15, 23, 42, 0.5) 0%, var(--color-background) 70%);
    overflow: hidden; /* EmpÃªche le scroll sur le body */
}

#game-container {
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 1rem;
}

/* --- SCREENS & PANELS --- */
.screen {
    width: 100%;
    max-width: 480px;
    margin: 0 auto;
    animation: fadeIn 0.5s var(--transition-medium) forwards;
    opacity: 0;
    transform: translateY(20px);
}

@keyframes fadeIn {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.panel {
    background: var(--color-glass-bg);
    border: 1px solid var(--color-glass-border);
    border-radius: var(--panel-border-radius);
    padding: 2rem 1.5rem;
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.game-title {
    text-align: center;
    font-size: 2.5rem;
    font-weight: 900;
    letter-spacing: 1px;
}

.game-title span {
    color: var(--color-accent-hud);
}

/* --- TABS --- */
.tabs {
    display: flex;
    background: rgba(0,0,0,0.2);
    border-radius: var(--input-border-radius);
    padding: 4px;
}

.tabs button {
    flex: 1;
    padding: 0.75rem 0.5rem;
    background: transparent;
    border: none;
    color: var(--color-text-secondary);
    font-size: 1rem;
    font-weight: 700;
    border-radius: 6px;
    cursor: pointer;
    transition: all var(--transition-fast);
}

.tabs button[aria-selected="true"] {
    background: var(--color-accent-hud);
    color: var(--color-background);
    box-shadow: 0 0 15px var(--color-accent-glow);
}

.tab-pane {
    display: none;
    flex-direction: column;
    gap: 1rem;
}

.tab-pane.active {
    display: flex;
}

/* --- FORMS & BUTTONS --- */

.avatar-picker {
    text-align: center;
}

.avatar-picker img {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    border: 2px solid var(--color-glass-border);
    background: rgba(255, 255, 255, 0.1);
}

input[type="text"] {
    background: rgba(0,0,0,0.2);
    border: 1px solid var(--color-glass-border);
    color: var(--color-text-primary);
    padding: 0.9rem;
    border-radius: var(--input-border-radius);
    font-size: 1rem;
    text-align: center;
    transition: all var(--transition-fast);
}

input[type="text"]::placeholder {
    color: var(--color-text-secondary);
    opacity: 0.8;
}

input[type="text"]:focus {
    outline: none;
    border-color: var(--color-glass-border-active);
    box-shadow: 0 0 15px rgba(0, 242, 255, 0.2);
}

.btn {
    border: none;
    padding: 0.9rem;
    font-size: 1rem;
    font-weight: 700;
    border-radius: var(--btn-border-radius);
    cursor: pointer;
    transition: all var(--transition-fast);
    text-transform: uppercase;
}

.btn:active {
    transform: scale(0.95);
    transition: transform 0.1s ease;
}

.btn-primary {
    background-color: var(--color-accent-hud);
    color: var(--color-background);
    box-shadow: 0 2px 15px var(--color-accent-glow);
    opacity: 0.8; /* Default state */
}

.btn-primary.ready,
.btn-primary:hover {
    opacity: 1;
    transform: translateY(-2px);
    box-shadow: 0 4px 25px var(--color-accent-glow);
}

.btn-secondary {
    background: transparent;
    border: 1px solid var(--color-glass-border);
    color: var(--color-text-secondary);
}

.btn-secondary:hover {
    background: var(--color-glass-bg);
    color: var(--color-text-primary);
    border-color: var(--color-glass-border-active);
}

.rules-container {
    text-align: center;
    border-top: 1px solid var(--color-glass-border);
    padding-top: 1.5rem;
    margin-top: 1rem;
}
#how {
    text-align: left;
    margin-top: 1rem;
    font-size: 0.9rem;
    color: var(--color-text-secondary);
}
#how ul {
    list-style-position: inside;
    margin-top: 0.5rem;
}


/* --- LOBBY --- */
#screen-lobby {
    display: none; /* Initially hidden */
    flex-direction: column;
    gap: 1.5rem;
    height: 100%;
    width: 100%;
    max-width: 600px;
}

.lobby-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    background: var(--color-glass-bg);
    padding: 0.75rem 1rem;
    border-radius: var(--panel-border-radius);
    border: 1px solid var(--color-glass-border);
    backdrop-filter: blur(15px);
}
.lobby-header .btn-secondary {
    padding: 0.5rem 0.8rem;
    font-size: 0.9rem;
}

.lobby-code-container {
    text-align: center;
}

.lobby-code-container span {
    font-size: 0.8rem;
    color: var(--color-text-secondary);
    display: block;
}

#lobby-code {
    font-size: 1.5rem;
    font-weight: 900;
    color: var(--color-accent-hud);
    letter-spacing: 2px;
}

#lobby-ready-pill {
    background: rgba(0,0,0,0.3);
    color: var(--color-text-secondary);
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 700;
}

#screen-lobby h2 {
    text-align: center;
    font-weight: 700;
    font-size: 1.2rem;
    color: var(--color-text-secondary);
}

.player-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 1rem;
    flex-grow: 1;
    overflow-y: auto; /* Scroll if many players */
    padding: 0.5rem;
}

.player-card {
    background: var(--color-glass-bg);
    border: 1px solid var(--color-glass-border);
    border-radius: var(--input-border-radius);
    padding: 1rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    text-align: center;
    transition: all var(--transition-fast);
}

.player-card:hover {
    transform: scale(1.05);
    border-color: var(--color-glass-border-active);
}

.player-card img {
    width: 60px;
    height: 60px;
    border-radius: 50%;
}

.player-card .player-name {
    font-weight: 700;
    font-size: 1rem;
    word-break: break-all;
}
.player-card .player-status {
    font-size: 0.8rem;
    color: var(--color-accent-hud);
}

.lobby-actions {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    padding: 1rem;
    margin-top: auto; /* Pushes to the bottom */
}

#timer-lobby {
    color: var(--color-accent-hud);
    font-size: 1.2rem;
    font-weight: 700;
    text-align: center;
}

/* --- TOAST --- */
#toast {
  display: none;
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background-color: var(--color-accent-hud);
  color: var(--color-background);
  padding: 1rem 1.5rem;
  border-radius: var(--btn-border-radius);
  font-weight: 700;
  z-index: 1000;
  box-shadow: 0 0 20px var(--color-accent-glow);
  animation: toastIn 0.3s ease;
}

@keyframes toastIn {
  from {
    opacity: 0;
    transform: translate(-50%, 20px);
  }
  to {
    opacity: 1;
    transform: translate(-50%, 0);
  }
}



--- FICHIER : public/js/main.js ---
(function () {
  const { $, fmt, state, socket, startPhaseAnim } = window.HOL;

  function updateUIFromState(snap) {
      state.room = snap;

      if ($('round-num')) $('round-num').textContent = snap.round;
      
      if (window.HOL.updateScoreboard) window.HOL.updateScoreboard(snap.players);

      switch (snap.state) {
        case 'lobby':
          window.HOL.show('screen-lobby');
          break;
        case 'hints':
          window.HOL.show('screen-hint');
          break;
        case 'voting':
          window.HOL.show('screen-vote');
          break;
        case 'reveal':
          if (document.body.getAttribute('data-screen') !== 'screen-result') {
            window.HOL.show('screen-result');
          }
          break;
      }
      
      const list = $('players');
      if (list) {
          list.innerHTML = '';
          snap.players.forEach(p => {
              const card = document.createElement('div');
              card.className = 'player-card'; 
              
              // Determine status
              let statusText = '';
              if (p.disconnected) statusText = 'Déconnecté';
              else if (p.ready) statusText = 'Prêt ?';

              const avatarUrl = `https://api.dicebear.com/7.x/bottts/svg?seed=${encodeURIComponent(p.name || 'default')}&backgroundColor=b6e3f4,c0aede,d1d4f9`;
              card.innerHTML = `
                  <img src="${avatarUrl}" alt="Avatar de ${p.name}">
                  <div class="player-name">${p.name}</div>
                  ${statusText ? `<div class="player-status">${statusText}</div>` : ''}
              `;
              list.appendChild(card);
          });
      }

      const meNow = snap.players?.find(p => p.id === state.me.id);
      const meBefore = state.room?.players?.find(p => p.id === state.me.id);
      if (meBefore?.spectator && meNow && !meNow.spectator && snap.state === 'lobby') {
        window.HOL.toast('Vous rejoignez la partie !', 1500);
      }
      
      if (snap.state === 'lobby') {
        const modal = $('modal');
        if (modal && modal.style.display === 'flex') {
          const box = modal.querySelector('.box');
          if (box && box.innerHTML.includes('PARTIE TERMINEE')) {
            modal.style.display = 'none';
          }
          if (box && box.textContent.includes('Partie en cours')) {
            modal.style.display = 'none';
          }
        }
        const btnReady = $('btn-ready');
        if (btnReady) {
          btnReady.textContent = 'Je suis pret';
          btnReady.disabled = false;
        }
      }
    }
  window.HOL.updateUIFromState = updateUIFromState;
  function initTimersFromServer() {
    let lastDeadline = null;
    let localTimerRAF = null;

    socket.on('timer', ({ phase, leftMs, totalMs }) => {
      if (phase !== state.currentPhase) state.currentPhase = phase;

      lastDeadline = Date.now() + leftMs;

      startPhaseAnim(phase, totalMs || state.DUR[phase] || 0, leftMs);

      if (localTimerRAF) cancelAnimationFrame(localTimerRAF);

      function updateLocalTimer() {
        const now = Date.now();
        const remaining = Math.max(0, lastDeadline - now);

        if (phase === 'hints') {
          const el = $('timer-hints'); if (el) el.textContent = fmt(remaining);
          if (remaining <= 0) { $('btn-send-hint')?.setAttribute('disabled', 'true'); $('hint-input')?.setAttribute('disabled', 'true'); }
        } else if (phase === 'voting') {
          const el = $('timer-vote'); if (el) el.textContent = fmt(remaining);
          if (remaining <= 0) { document.querySelectorAll('#hints .vote-card').forEach(b => b.disabled = true); }
        } else if (phase === 'prestart') {
          const el = $('timer-lobby'); if (el) el.textContent = fmt(remaining);
        } else if (phase === 'reveal') {
          const el = $('timer-reveal'); if (el) el.textContent = fmt(remaining);
        } else if (phase === 'lobby') {
          const el = $('timer-lobby'); if (el) { el.textContent = fmt(remaining); if (remaining <= 0) el.style.display = 'none'; }
        }

        if (remaining > 0) {
          localTimerRAF = requestAnimationFrame(updateLocalTimer);
        } else {
          localTimerRAF = null;
        }
      }

      updateLocalTimer();
    });

    socket.on('phaseProgress', ({ phase, submitted, total }) => {
      if (phase === 'hints') {
        const el = $('progress-hints');
        if (el) el.textContent = `${submitted}/${total}`;
      } else if (phase === 'voting') {
        const el = $('progress-vote');
        if (el) el.textContent = `${submitted}/${total}`;
      }
    });

    socket.on('roomState', (snap) => {
      window.HOL.updateUIFromState(snap);
    });

    socket.on('scoresReset', () => {
      window.HOL.show('screen-lobby');
      const btnReady = $('btn-ready');
      if (btnReady) {
        btnReady.textContent = 'Je suis pret';
        btnReady.disabled = false;
      }
      state.myLobbyReady = false;
      window.HOL.toast('Partie reinitalisee !', 1500);
    });
  }

  function init() {
    window.HOL.features.home.init();
    window.HOL.features.hints.init();
    window.HOL.features.vote.init();
    window.HOL.features.results.init();
    window.HOL.features.leaderboard.init();
    initTimersFromServer();
    document.body.setAttribute('data-screen', 'screen-home');
  }

  if (document.readyState !== 'loading') init();
  else document.addEventListener('DOMContentLoaded', init);
})();



--- FICHIER : public/js/core/dom.js ---
// public/js/core/dom.js
// Helpers DOM globaux + mirroring dans window.HOL
(function () {
  // Accepte: "#id" / ".class" / "div > span"  OU  "id" nu sans '#'
  const pick = (s, root = document) => {
    if (!s) return null;
    const looksLikeSelector = s.startsWith('#') || s.startsWith('.') || /[>\[\]:\s]/.test(s);
    return looksLikeSelector ? root.querySelector(s) : root.getElementById(s);
  };
  const pickAll = (s, root = document) => {
    if (!s) return [];
    const looksLikeSelector = s.startsWith('#') || s.startsWith('.') || /[>\[\]:\s]/.test(s);
    return looksLikeSelector ? Array.from(root.querySelectorAll(s)) : (root.getElementById(s) ? [root.getElementById(s)] : []);
  };
  const on = (el, type, handler, opts) => el && el.addEventListener(type, handler, opts);

  // Expose global
  window.$  = pick;
  window.$$ = pickAll;
  window.on = on;

  // Expose aussi dans window.HOL (ton code fait: const { $, â€¦ } = window.HOL)
  window.HOL = window.HOL || {};
  window.HOL.$  = window.HOL.$  || pick;
  window.HOL.$$ = window.HOL.$$ || pickAll;
  window.HOL.on = window.HOL.on || on;
})();



--- FICHIER : public/js/core/helpers.js ---
// public/js/core/helpers.js
(function () {
  const HOL = (window.HOL = window.HOL || {});

  HOL.SCORE_SCREENS = new Set(['screen-hint', 'screen-vote', 'screen-result']);

  // SÃ©lecteurs
  HOL.$ = HOL.$ || ((s, r = document) => {
    if (!s) return null;
    const bySel = s.startsWith('#') || s.startsWith('.') || /[>\[\]:\s]/.test(s);
    return bySel ? r.querySelector(s) : r.getElementById(s);
  });

  HOL.el = HOL.el || function el(tag, text = '', attrs = {}) {
    const n = document.createElement(tag);
    if (text != null && text !== '') n.textContent = String(text);
    for (const [k, v] of Object.entries(attrs || {})) n.setAttribute(k, String(v));
    return n;
  };

  HOL.onEnter = HOL.onEnter || function (idOrSel, fn) {
    const input = HOL.$(idOrSel);
    if (!input) return;
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') { e.preventDefault(); fn && fn(); }
    });
  };

  HOL.show = HOL.show || function (screenId) {
    const ids = ['screen-home', 'screen-lobby', 'screen-hint', 'screen-vote', 'screen-result'];
    for (const id of ids) {
      const el = document.getElementById(id);
      if (el) el.style.display = (id === screenId) ? '' : 'none';
    }
    document.body.setAttribute('data-screen', screenId);
    // On dÃ©place le scoreboard si besoin
    const sb = document.getElementById('scoreboard');
    if (sb) {
      if (HOL.SCORE_SCREENS.has(screenId)) {
        sb.style.display = 'block';
        document.getElementById(screenId).appendChild(sb);
      } else {
        sb.style.display = 'none';
      }
    }
  };

  HOL.toast = HOL.toast || function (msg, ms = 2200) {
    let t = document.getElementById('toast');
    if (!t) return console.log("Toast:", msg);
    t.textContent = String(msg || '');
    t.style.display = 'block';
    t.style.opacity = '1';
    clearTimeout(HOL._toastTimer);
    HOL._toastTimer = setTimeout(() => { t.style.display = 'none'; }, ms);
  };

  HOL.getDeviceId = HOL.getDeviceId || function () {
    const K = 'hol_device_id';
    let id = localStorage.getItem(K);
    if (!id) { id = 'd-' + Math.random().toString(36).slice(2, 9); localStorage.setItem(K, id); }
    return id;
  };

  HOL.fmt = HOL.fmt || function fmt(ms) {
    const s = Math.max(0, Math.floor((ms ?? 0) / 1000));
    return `${String(Math.floor(s/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;
  };

  HOL.shareInviteLink = async function({ code, name }) {
    const url = `${location.origin}${location.pathname}?code=${code}${name ? '&n='+name : ''}`;
    if (navigator.share) {
      try { await navigator.share({ title: 'Hint or Lie', text: `Code ${code}`, url }); return; } catch {}
    }
    try { await navigator.clipboard.writeText(url); HOL.toast('Lien copiÃ© âœ…'); } catch { HOL.toast('Erreur copie'); }
  };

})();


--- FICHIER : public/js/core/socket.js ---
(function () {
  window.HOL = window.HOL || {};
  
  const socket = io({
    transports: ['websocket', 'polling'],
    reconnectionAttempts: 5,
    timeout: 10000
  });

  socket.on('spectatorMode', ({ phase, message }) => {
    const modal = document.getElementById('spectator-waiting');
    const phaseDisplay = document.getElementById('spectator-phase');
    if (modal) {
      const phaseLabel = {
        'hints': 'ðŸ“ Phase Indices',
        'voting': 'ðŸ—³ï¸ Phase Vote',
        'reveal': 'ðŸŽ­ RÃ©vÃ©lation',
      }[phase] || 'â³ ' + phase;
      
      if (phaseDisplay) phaseDisplay.textContent = phaseLabel;
      modal.style.display = 'block';
      
      const screenIds = ['screen-home', 'screen-lobby', 'screen-hint', 'screen-vote', 'screen-result'];
      screenIds.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = 'none';
      });
    }
  });

  socket.on('roomJoined', () => {
    const modal = document.getElementById('spectator-waiting');
    if (modal) modal.style.display = 'none';
  });

  const btnLeaveSpectator = document.getElementById('btn-leave-spectator');
  if (btnLeaveSpectator) {
    btnLeaveSpectator.addEventListener('click', () => {
      socket.emit('leaveRoom');
      const modal = document.getElementById('spectator-waiting');
      if (modal) modal.style.display = 'none';
    });
  }

  socket.on('gameStateSync', (gameData) => {
    if (window.HOL.state) {
      window.HOL.state.currentPhase = gameData.phase;
    }
    if (window.HOL.updateUIFromState) {
        window.HOL.updateUIFromState({
            state: gameData.state,
            round: gameData.round,
            players: gameData.players,
        });
    }
  });

  window.HOL.socket = socket;
})();


--- FICHIER : public/js/core/state.js ---
// public/js/core/state.js
// Ã‰tat global + animations de phase
(function () {
  const HOL = window.HOL || (window.HOL = {});

  const state = {
    me: { id: null, code: null },
    room: { players: [], state: 'lobby', round: 0 },
    myIsImpostor: false,
    myLobbyReady: false,
    currentPhase: null,
    roundDomain: null,  // domaine/thÃ¨me de la manche
    DUR: { hints: 45_000, voting: 40_000, prestart: 4_000 }, // valeurs par dÃ©faut (le serveur pilote le timer)
    phaseAnim: { phase: null, deadline: 0, total: 0, raf: null },
  };

  function tierFromWins(w) {
    if (w >= 120) return 'Diamond';
    if (w >= 60) return 'Platinum';
    if (w >= 25) return 'Gold';
    if (w >= 10) return 'Silver';
    return 'Bronze';
  }

  // âœ… updateScoreboard est fourni par leaderboard.js

  function resetPhaseProgress() {
    document.querySelectorAll('.phase-progress .bar').forEach(el => el.style.width = '0%');
    document.querySelectorAll('.phase-bar').forEach(el => el.style.setProperty('--progress', '0'));
    stopPhaseAnim();
  }

  function phaseScope(phase) {
    if (phase === 'hints') return document.querySelector('#screen-hint .phase-bar');
    if (phase === 'voting') return document.querySelector('#screen-vote .phase-bar');
    if (phase === 'prestart') return document.querySelector('#screen-result .phase-bar');
    if (phase === 'lobby') return document.querySelector('#screen-lobby .phase-bar');
    return null;
  }

  function tickPhase() {
    const el = phaseScope(state.phaseAnim.phase);
    if (!el) return;
    const left = Math.max(0, state.phaseAnim.deadline - Date.now());
    const done = Math.min(1, (state.phaseAnim.total - left) / Math.max(1, state.phaseAnim.total));
    el.style.setProperty('--progress', String(done));
    const bar = el.querySelector('.phase-progress .bar');
    if (bar) bar.style.width = `${Math.round(done * 100)}%`;
    if (left > 0) {
      state.phaseAnim.raf = requestAnimationFrame(tickPhase);
    } else {
      state.phaseAnim.raf = null;
      document.body.classList.add('flash-now');
      setTimeout(() => document.body.classList.remove('flash-now'), 260);
    }
  }

  function stopPhaseAnim() { if (state.phaseAnim.raf) cancelAnimationFrame(state.phaseAnim.raf); state.phaseAnim.raf = null; }

  function startPhaseAnim(phase, totalMs, leftMs) {
    if (!phase || !totalMs) return;
    state.phaseAnim.phase = phase; state.phaseAnim.total = totalMs; state.phaseAnim.deadline = Date.now() + (leftMs ?? totalMs);
    stopPhaseAnim(); state.phaseAnim.raf = requestAnimationFrame(tickPhase);
  }

  // âš ï¸ NE PAS rÃ©Ã©crire HOL.getDeviceId ici.
  // helpers.js fournit dÃ©jÃ  HOL.getDeviceId ; on le laisse tel quel.

  Object.assign(HOL, {
    state,
    tierFromWins,
    resetPhaseProgress,
    startPhaseAnim,
    stopPhaseAnim,
    // ðŸ‘‡ On n'ajoute PAS getDeviceId ici pour Ã©viter d'Ã©craser celui de helpers.js
  });
})();



--- FICHIER : public/js/dev/guard.js ---
// public/js/dev/guard.js
(function () {
  // Activer/dÃ©sactiver le mode debug
  const DEBUG = /[?&](dev|debug)=1/i.test(location.search) || window.HOL_DEBUG === true;

  function log(...a){ console.log('[GUARD]', ...a); }
  function warn(...a){ console.warn('[GUARD]', ...a); }

  function checkDOM() {
    const required = [
      'screen-home','screen-lobby','screen-hint','screen-vote','screen-result',
      'btn-create','btn-join','name-create','name-join','join-code',
      'hint-input','btn-send-hint','hint-status','impostor-tip',
      'hints',
      'scoreboard','score-list',
      'lobby-ready-pill','round-num','timer-hints','timer-vote','timer-reveal'
    ];
    const missing = required.filter(id => !document.getElementById(id));
    if (missing.length) warn('IDs manquants dans le DOM:', missing);
  }

  function checkHOL() {
    const ok = (p) => {
      try { return !!eval(p); } catch { return false; }
    };
    const reqFns = [
      'window.HOL', 'HOL.$', 'HOL.onEnter', 'HOL.show', 'HOL.fmt',
      'HOL.updateScoreboard',
      'HOL.features && HOL.features.home && HOL.features.home.init',
      'HOL.features && HOL.features.hints && HOL.features.hints.init',
      'HOL.features && HOL.features.vote && HOL.features.vote.init',
      'HOL.features && HOL.features.results && HOL.features.results.init',
    ];
    const miss = reqFns.filter(p => !ok(p));
    if (miss.length) warn('Fonctions/modules attendus non prÃ©sents:', miss);
  }

  function wireSocketLogging() {
    const s = window.HOL && window.HOL.socket;
    if (!s) { warn('Socket HOL manquant'); return; }
    // Forcer lâ€™affichage des emits et des Ã©vÃ©nements entrants
    const origEmit = s.emit.bind(s);
    s.emit = (ev, ...args) => { console.log('[emit]', ev, ...args); return origEmit(ev, ...args); };
    if (s.onAny) s.onAny((ev, ...args) => console.log('âŸµ', ev, ...args));
    log('Socket logging activÃ©');
  }

  function run() {
    checkDOM();
    checkHOL();
    wireSocketLogging();
    if (DEBUG) {
      window.addEventListener('error', (e) => warn('JS error:', e.message, e.filename+':'+e.lineno));
      log('Mode DEBUG actif');
    }
  }

  if (document.readyState !== 'loading') run();
  else document.addEventListener('DOMContentLoaded', run);
})();



--- FICHIER : public/js/features/hints.js ---
(function () {
  const { $, $$, toast, show, state, socket, resetPhaseProgress, onEnter } = window.HOL;

  let sending = false;
  let locked  = false;
  let liveBox = null;
  let liveList = null;

  const ui = {
    role:   () => $('my-role'),
    theme:  () => $('theme-hint-name'),
    tip:    () => $('impostor-tip'),
    input:  () => $('hint-input'),
    send:   () => $('btn-send-hint'),
    status: () => $('hint-status'),
    wordChip:     () => $('crew-word-chip'),
    wordChipText: () => $('crew-word'),
  };

  function applyRoleTheme(isImpostor) {
    const body = document.body;
    body.classList.remove('theme-impostor', 'theme-crew');
    if (isImpostor) {
      body.classList.add('theme-impostor');
      body.style.animation = 'flash-red 0.5s ease-out';
      setTimeout(() => body.style.animation = '', 500);
    } else {
      body.classList.add('theme-crew');
    }
  }

  function resetTheme() {
    document.body.classList.remove('theme-impostor', 'theme-crew');
  }

  function playRoleCinematic(isImpostor, callback) {
    const overlay = $('role-reveal-overlay');
    const roleText = $('reveal-role-text');
    if (!overlay || !roleText) { callback(); return; } 

    overlay.style.display = '';
    roleText.textContent = isImpostor ? 'IMPOSTEUR' : 'Ã‰QUIPIER';
    roleText.className = isImpostor ? 'impostor' : 'crew';
    overlay.classList.add('playing');

    setTimeout(() => {
      overlay.classList.remove('playing');
      callback(); 
    }, 3000); 
  }

  function setRound(num) { $$('.round-live').forEach(el => el.textContent = String(num || 0)); }
  
  function ensureLiveUI() {
    if (liveBox && liveList) return;
    liveBox = document.createElement('div');
    liveBox.id = 'crew-live-box';
    liveBox.className = 'tip';
    liveBox.innerHTML = `<strong>ðŸ“¡ Indices interceptÃ©s (live)</strong><ul id="crew-live-list" style="margin-top:8px;"></ul>`;
    liveList = liveBox.querySelector('#crew-live-list');
  }

  function sendHint() {
    if (locked || sending) return;
    const val = (ui.input()?.value || '').trim();
    if (!val) {
      const status = ui.status();
      if (status) {
        status.textContent = 'Ã‰cris un indice ðŸ˜‰';
        status.classList.add('error');
        setTimeout(() => {
          if (status.textContent === 'Ã‰cris un indice ðŸ˜‰') {
            status.textContent = '';
            status.classList.remove('error');
          }
        }, 2200);
      }
      return;
    }
    sending = true;
    ui.send().disabled = true;
    socket.emit('submitHint', { hint: val });
  }

  function initSocket() {
    socket.on('roundInfo', ({ word, wordDisplay, isImpostor, domain, round }) => {
      playRoleCinematic(isImpostor, () => {
        state.myIsImpostor = !!isImpostor;
        sending = false; locked = false;
        const status = ui.status();
        if (status) {
          status.textContent = '';
          status.classList.remove('error');
        }
        show('screen-hint');
        resetPhaseProgress();
        applyRoleTheme(isImpostor);

        if (ui.theme()) ui.theme().textContent = domain || 'â€”';
        if (ui.role()) {
          ui.role().textContent = isImpostor ? 'IMPOSTEUR' : 'Ã‰QUIPIER';
          ui.role().style.color = isImpostor ? 'var(--danger)' : 'var(--crew)';
        }

        const tipEl = ui.tip();
        if (isImpostor) {
          tipEl.style.display = 'block';
          tipEl.innerHTML = "ðŸ¤« <strong>CHUT !</strong> Tu nâ€™as pas de mot.<br>Observe les indices et invente un mensonge !";
          ui.wordChip().style.display = 'none';
          ensureLiveUI();
          if (liveList) liveList.innerHTML = '';
          ui.input()?.insertAdjacentElement('beforebegin', liveBox);
          liveBox.style.display = 'block';
        } else {
          tipEl.style.display = 'none';
          ui.wordChip().style.display = 'block';
          ui.wordChipText().textContent = wordDisplay || word || 'â€”';
          if (liveBox) liveBox.style.display = 'none';
        }

        ui.input().value = '';
        ui.input().disabled = false;
        ui.send().disabled = false;
        setRound(round);
      });
    });

    socket.on('hintAck', () => {
      locked = true; sending = false;
      const status = ui.status();
      if (status) {
        status.textContent = 'Indice envoyÃ© âœ…';
        status.classList.remove('error');
      }
    });

    socket.on('hintRejected', ({ reason }) => {
      sending = false;
      const btn = ui.send();
      if (btn) btn.disabled = false;
      const status = ui.status();
      if (status) {
        status.textContent = reason || 'Indice rejetÃ©.';
        status.classList.add('error');
      }
      toast(reason || 'Indice rejetÃ©.', 'danger');
    });

    socket.on('crewHintsLive', ({ hints }) => {
      if (!state.myIsImpostor) return;
      ensureLiveUI();
      liveList.innerHTML = '';
      hints.forEach(h => {
        const li = document.createElement('li');
        li.className = 'live-hint-item';

        const nameSpan = document.createElement('span');
        nameSpan.className = 'live-hint-name';
        nameSpan.textContent = h.name;

        const hintSpan = document.createElement('span');
        hintSpan.className = 'live-hint-text';
        hintSpan.textContent = `"${h.hint}"`;

        li.appendChild(nameSpan);
        li.appendChild(hintSpan);

        liveList.appendChild(li);
      });
    });

    socket.on('crewHintAdded', (h) => {
      if (!state.myIsImpostor) return;
      ensureLiveUI();
      const li = document.createElement('li');
      li.className = 'live-hint-item';

      const nameSpan = document.createElement('span');
      nameSpan.className = 'live-hint-name';
      nameSpan.textContent = h.name;

      const hintSpan = document.createElement('span');
      hintSpan.className = 'live-hint-text';
      hintSpan.textContent = `"${h.hint}"`;

      li.appendChild(nameSpan);
      li.appendChild(hintSpan);
      
      const delay = liveList.children.length * 100;
      li.style.animationDelay = `${delay}ms`;

      liveList.appendChild(li);
    });

    socket.on('timer', ({ phase, leftMs }) => {
      if (phase !== 'hints' && phase !== 'prestart') resetTheme();
    });
  }

  function init() { 
    ui.send()?.addEventListener('click', sendHint);
    onEnter('hint-input', sendHint);
    initSocket(); 
  }

  window.HOL.features = window.HOL.features || {};
  window.HOL.features.hints = { init };
})();


--- FICHIER : public/js/features/home.js ---
(function () {
    const { $, el, onEnter, show, toast, getDeviceId, state, updateScoreboard, socket } = window.HOL;

    function updateAvatarPreview(name) {
        const seed = (name || '').trim() || 'Joueur';
        const url = `https://api.dicebear.com/7.x/bottts/svg?seed=${encodeURIComponent(seed)}&backgroundColor=b6e3f4,c0aede,d1d4f9`;
        const imgs = document.querySelectorAll('[id^="avatar-preview-img"]');
        imgs.forEach(img => {
            img.src = url;
        });
    }

    function initTabs() {
        const tabs = { join: $('tab-join'), create: $('tab-create') };
        const panes = { join: $('pane-join'), create: $('pane-create') };

        function activateTab(which) {
            const isJoin = which === 'join';
            tabs.join?.setAttribute('aria-selected', isJoin ? 'true' : 'false');
            tabs.create?.setAttribute('aria-selected', isJoin ? 'false' : 'true');
            panes.join?.classList.toggle('active', isJoin);
            panes.create?.classList.toggle('active', !isJoin);
            
            const input = isJoin ? $('name-join') : $('name-create');
            input?.focus();
            updateAvatarPreview(input?.value);
        }

        tabs.join?.addEventListener('click', () => activateTab('join'));
        tabs.create?.addEventListener('click', () => activateTab('create'));
        $('join-code')?.addEventListener('input', e => { e.target.value = e.target.value.replace(/\D/g, '').slice(0, 4); });

        ['name-join', 'name-create'].forEach(id => {
            const input = $(id);
            if (input) {
                input.addEventListener('input', (e) => updateAvatarPreview(e.target.value));
            }
        });
    }

    function initHomeActions() {

        $('btn-join').onclick = () => {
            const name = $('name-join')?.value.trim() || 'Joueur';
            const code = ($('join-code')?.value.trim() || '').replace(/\D/g, '').slice(0, 4);
            if (code.length !== 4) { toast('Code Ã  4 chiffres requis.'); return; }
            socket.emit('hello', { deviceId: getDeviceId(), pseudo: name, name });
            socket.emit('joinRoom', { code, pseudo: name, name, deviceId: getDeviceId() });
        };

        $('btn-create').onclick = () => {
            const name = $('name-create')?.value.trim() || 'Joueur';
            socket.emit('hello', { deviceId: getDeviceId(), pseudo: name });
            socket.emit('createRoom', { name: name, deviceId: getDeviceId() });
        };

        $('btn-how')?.addEventListener('click', () => {
            const panel = $('how');
            const btn = $('btn-how');
            const visible = panel.style.display !== 'none';

            if (visible) {
                panel.style.display = 'none';
                btn.textContent = 'RÃ¨gles rapides';
            } else {
                panel.style.display = 'block';
                btn.textContent = 'Masquer les rÃ¨gles';
                panel.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        });

        $('btn-ready')?.addEventListener('click', () => {
            const roomState = window.HOL?.state?.room?.state;
            const br = $('btn-ready');

            if (roomState === 'reveal') {
                socket.emit('playerReadyNext');
                if (br) {
                    br.textContent = 'PrÃªt âœ“';
                    br.disabled = true;
                }
                return;
            }

            if (roomState === 'lobby') {
                state.myLobbyReady = !state.myLobbyReady;
                
                if (br) {
                    br.textContent = state.myLobbyReady ? 'Annuler prÃªt' : 'Je suis prÃªt';
                    br.classList.toggle('ready', state.myLobbyReady);
                }
                
                socket.emit('playerReadyLobby', { ready: state.myLobbyReady });
                return;
            }

            if (br) {
                br.disabled = true;
                br.title = 'Manche en cours...';
            }
        });

        $('btn-back-home')?.addEventListener('click', () => {
            socket.emit('leaveRoom');
            state.myLobbyReady = false;
            if ($('btn-ready')) $('btn-ready').textContent = 'Je suis prÃªt';
            show('screen-home');
        });

        onEnter('name-join', () => $('btn-join')?.click());
        onEnter('join-code', () => $('btn-join')?.click());
        onEnter('name-create', () => $('btn-create')?.click());
    }

    function initSocketRoom() {
        socket.on('system', ({ text }) => toast(text));
        
        socket.on('connect', () => {
            socket.emit('getLeaderboard');
            state.me.id = socket.id;
        });

        const codeSpan = $('lobby-code');
        if (codeSpan && !codeSpan._wired) {
            codeSpan._wired = true;
            const pill = codeSpan.parentElement;
            if (pill) {
                pill.style.cursor = 'pointer';
                pill.addEventListener('click', async () => {
                    try { await navigator.clipboard.writeText(codeSpan.textContent.trim()); toast('Code copiÃ© ðŸ“‹'); }
                    catch { toast('Copie impossible'); }
                });
            }
        }

        const onRoomEntry = ({ code }) => {
            state.me.code = code;
            $('lobby-code').textContent = code;
            show('screen-lobby');
            state.myLobbyReady = false;
            if ($('btn-ready')) $('btn-ready').textContent = 'Je suis prÃªt';
        };

        socket.on('roomCreated', onRoomEntry);
        socket.on('roomJoined', onRoomEntry);
        socket.on('errorMsg', (message) => toast(message || 'Erreur de salle.'));




        socket.on('lobbyReadyProgress', ({ ready, total }) => {
            if ($('lobby-ready-pill')) $('lobby-ready-pill').textContent = `${ready}/${total} prÃªts`;
        });

        socket.on('lobbyCountdownStarted', ({ seconds }) => {
            const el = $('timer-lobby');
            if (el) { el.style.display = 'inline-block'; el.textContent = `00:${String(seconds).padStart(2, '0')}`; }
        });

        socket.on('spectatorMode', ({ message }) => {
            if (state.room?.state === 'lobby') return;
            
            const modal = document.getElementById('modal');
            if (!modal) return;
            
            const box = modal.querySelector('.box');
            if(box) {
                box.innerHTML = `
                    <h2>â³ Partie en cours</h2>
                    <p>${message || 'Veuillez patienter, vous rejoindrez la prochaine manche.'}</p>
                    <p style="margin-top:15px; font-size:0.8rem; opacity:0.7;">Vous pouvez suivre le dÃ©roulement en attendant.</p>
                `;
            }
            
            modal.style.display = 'flex';
        });

        socket.on('leftRoom', () => {
            state.myLobbyReady = false;
            const btnReady = $('btn-ready');
            if (btnReady) {
                btnReady.textContent = 'Je suis prÃªt';
                btnReady.disabled = false;
                btnReady.classList.remove('ready');
                btnReady.title = '';
            }
            window.HOL.show('screen-home');
        });
    }

    function init() {
        initTabs();
        initHomeActions();
        initSocketRoom();
    }

    window.HOL.features = window.HOL.features || {};
    window.HOL.features.home = { init };
})();


--- FICHIER : public/js/features/leaderboard.js ---
// public/js/features/leaderboard.js
// âœ… Scoreboard unifiÃ© avec structure grid : LED | AVATAR | NOM | PTS

(function () {
  const { $ } = window.HOL;

  function updateScoreboard(players) {
    const list = $('score-list');
    if (!list) return;

    list.innerHTML = '';
    const sorted = [...(players || [])].sort((a, b) => (b.score || 0) - (a.score || 0));

    sorted.forEach(p => {
      const li = document.createElement('li');
      
      // âœ… 1. LED (positionnÃ© en absolute, parent en relative)
      const ledContainer = document.createElement('div');
      ledContainer.style.cssText = 'position: relative; width: 10px; height: 32px;';
      
      const led = document.createElement('div');
      led.className = 'status-led';
      
      // Logique de couleur
      if (p.disconnected) {
        led.classList.add('is-disconnected');
      } else if (p.spectator) {
        led.classList.add('is-ready');  // Orange pour spectateur
      } else if (p.active) {
        led.classList.add('is-active');  // Vert pour actif
      }
      
      ledContainer.appendChild(led);
      li.appendChild(ledContainer);

      // âœ… 2. Avatar (taille forcÃ©e)
      const img = document.createElement('img');
      const seed = (p.name || '').trim() || 'default';
      img.src = `https://api.dicebear.com/7.x/bottts/svg?seed=${encodeURIComponent(seed)}&backgroundColor=b6e3f4,c0aede,d1d4f9`;
      img.className = 'score-avatar';
      img.style.cssText = 'width: 32px; height: 32px; border-radius: 50%; object-fit: cover; background: rgba(255, 255, 255, 0.05);';
      li.appendChild(img);

      // âœ… 3. Nom (avec mention si spectateur)
      let nameText = p.name || 'Joueur';
      if (p.spectator) nameText += ' (en attente)';
      if (p.disconnected) nameText += ' (dÃ©connectÃ©)';
      
      const nameSpan = document.createElement('span');
      nameSpan.className = 'name';
      nameSpan.textContent = nameText;
      li.appendChild(nameSpan);

      // âœ… 4. Score
      const scoreSpan = document.createElement('span');
      scoreSpan.className = 'pts';
      scoreSpan.textContent = String(p.score || 0);
      li.appendChild(scoreSpan);

      // Highlight du joueur local
      if (p.id === window.HOL?.state?.me?.id) {
        li.classList.add('me');
      }

      list.appendChild(li);
    });
  }

  function init() {}

  window.HOL = window.HOL || {};
  window.HOL.updateScoreboard = updateScoreboard;
  window.HOL.features = window.HOL.features || {};
  window.HOL.features.leaderboard = { init };
})();



--- FICHIER : public/js/features/results.js ---
(function () {
  const { $, show, socket, state } = window.HOL;

  function playResultCinematic({ win, text, isGameOver = false }) {
    const resultOverlay = $('result-reveal-overlay');
    const resultText = $('reveal-result-text');

    resultText.textContent = text;
    if (isGameOver) {
      resultText.style.fontSize = 'clamp(2rem, 10vw, 5rem)';
    }
    resultText.className = win ? 'victory' : 'defeat';
    resultOverlay.classList.add('playing');

    if (win && window.confetti) {
      const config = isGameOver
        ? { particleCount: 200, spread: 90, origin: { y: 0.6 }, gravity: 0.8 }
        : { particleCount: 100, spread: 70, origin: { y: 0.6 } };
      confetti(config);
      if (isGameOver) {
        setTimeout(() => confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } }), 500);
      }
    }

    return new Promise(resolve => setTimeout(() => {
      resultOverlay.classList.remove('playing');
      resolve();
    }, isGameOver ? 3500 : 2500));
  }

  function initUI() {
    $('btn-next').onclick = () => {
      $('btn-next').disabled = true;
      $('btn-next').textContent = 'PrÃªt âœ“';
      socket.emit('playerReadyNext');
    };
    $('btn-modal-lobby').onclick = () => { 
      show('screen-lobby'); 
      $('modal').style.display = 'none'; 
    };
  }

  function initSocket() {
    socket.on('roundResult', async (res) => {
      if (res.isGameOver) return;

      const win = state.myIsImpostor ? !res.impostorCaught : res.impostorCaught;
      await playResultCinematic({ win, text: win ? 'VICTOIRE !' : 'DÃ‰FAITE...' });
      
      show('screen-result');

      $('btn-next').disabled = false;
      $('btn-next').textContent = 'Manche suivante';
      $('res-common').textContent = res.common || '';

      const impName = res.impostorName || '(?)';
      const impContainer = $('res-imp-name');
      impContainer.innerHTML = '';
      impContainer.style.display = 'flex';
      impContainer.style.flexDirection = 'column';
      impContainer.style.alignItems = 'center';
      impContainer.style.gap = '10px';

      const img = document.createElement('img');
      img.src = `https://api.dicebear.com/7.x/bottts/svg?seed=${encodeURIComponent(impName)}&backgroundColor=b6e3f4,c0aede,d1d4f9`;
      img.style.width = '120px';
      img.style.height = '120px';
      img.style.borderRadius = '50%';
      img.style.border = `4px solid ${res.impostorCaught ? 'var(--crew)' : 'var(--danger)'}`;
      img.style.boxShadow = `0 0 20px rgba(${res.impostorCaught ? '59, 130, 246' : '239, 68, 68'}, 0.4)`;

      const nameSpan = document.createElement('span');
      nameSpan.textContent = impName;
      nameSpan.style.fontSize = '1.8rem';
      nameSpan.style.fontWeight = '900';
      nameSpan.style.color = res.impostorCaught ? 'var(--crew)' : 'var(--danger)';

      impContainer.appendChild(img);
      impContainer.appendChild(nameSpan);

      const votesContainer = $('res-votes');
      votesContainer.innerHTML = '';

      if (res.votesDetail && state.room?.players) {
        const title = document.createElement('h4');
        title.textContent = 'DÃ©tail des votes';
        title.style.textAlign = 'center';
        title.style.marginBottom = '10px';
        votesContainer.appendChild(title);

        const votesList = document.createElement('div');
        votesList.style.display = 'flex';
        votesList.style.flexDirection = 'column';
        votesList.style.gap = '8px';
        votesList.style.alignItems = 'center';

        const playersById = new Map(state.room.players.map(p => [p.id, p.name]));
        const voteEntries = Object.entries(res.votesDetail);

        voteEntries.forEach(([voterId, votedId], index) => {
          setTimeout(() => {
            const voterName = playersById.get(voterId);
            const votedName = playersById.get(votedId);

            if (voterName && votedName) {
              const voteElement = document.createElement('div');
              voteElement.style.display = 'flex';
              voteElement.style.alignItems = 'center';
              voteElement.style.gap = '8px';
              voteElement.style.padding = '4px 8px';
              voteElement.style.background = 'rgba(255, 255, 255, 0.05)';
              voteElement.style.borderRadius = '6px';
              voteElement.style.width = 'fit-content';

              const voterSpan = document.createElement('span');
              voterSpan.textContent = voterName;
              voterSpan.style.fontWeight = '700';

              const arrow = document.createElement('span');
              arrow.textContent = 'â†’';
              arrow.style.color = 'var(--muted)';

              const votedSpan = document.createElement('span');
              votedSpan.textContent = votedName;
              votedSpan.style.fontWeight = '700';
              votedSpan.style.color = votedId === res.impostorId ? 'var(--danger)' : 'var(--crew)';

              voteElement.appendChild(voterSpan);
              voteElement.appendChild(arrow);
              voteElement.appendChild(votedSpan);
              votesList.appendChild(voteElement);
            }
          }, index * 400);
        });

        votesContainer.appendChild(votesList);
      }
    });

    socket.on('gameOver', async ({ winners, finalScores, winnersCount }) => {
      const playerWon = winners.some(w => w.id === state.me.id);
      const text = winnersCount > 1 ? 'ðŸ† Ã‰GALITÃ‰ !' : 'ðŸ† PARTIE TERMINÃ‰E !';
      
      await playResultCinematic({ win: playerWon, text, isGameOver: true });
      showGameOverModal(winners, finalScores);
    });
  }

  function showGameOverModal(winners, finalScores) {
    const modal = $('modal');
    if (!modal) return;

    modal.style.display = 'flex';
    const box = modal.querySelector('.box');
    if (!box) return;

    const title = document.createElement('h2');
    title.style.cssText = `
      font-size: 2.5rem;
      text-align: center;
      background: linear-gradient(45deg, var(--accent), #ff3b3b);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 20px;
      animation: pulse-glow 1.5s ease-in-out infinite;
    `;
    title.textContent = 'ðŸ† PARTIE TERMINÃ‰E !';

    const winnersSection = document.createElement('div');
    winnersSection.style.cssText = `
      background: rgba(74, 222, 128, 0.1);
      border: 2px solid rgba(74, 222, 128, 0.3);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
      text-align: center;
    `;

    const winnersTitle = document.createElement('h3');
    winnersTitle.textContent = winners.length > 1 ? 'Gagnants ðŸŽ‰' : 'Gagnant ðŸŽ‰';
    winnersTitle.style.cssText = 'margin-top: 0; color: var(--accent-3);';
    winnersSection.appendChild(winnersTitle);

    winners.forEach((w, i) => {
      const winnerDiv = document.createElement('div');
      winnerDiv.style.cssText = `
        padding: 8px;
        margin: 8px 0;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        font-weight: 800;
        font-size: 1.3rem;
        animation: slideInRight ${0.5 + i * 0.2}s ease-out;
      `;
      winnerDiv.innerHTML = `
        <img src="https://api.dicebear.com/7.x/bottts/svg?seed=${encodeURIComponent(w.name)}" 
             style="width: 48px; height: 48px; border-radius: 50%; margin-right: 12px; vertical-align: middle;">
        <span>${w.name}</span>
        <span style="color: var(--accent-3); margin-left: 12px;">+${w.score}pts</span>
      `;
      winnersSection.appendChild(winnerDiv);
    });

    const scoreboardSection = document.createElement('div');
    scoreboardSection.style.cssText = `
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
    `;

    const scoreboardTitle = document.createElement('h4');
    scoreboardTitle.textContent = 'Classement Final';
    scoreboardTitle.style.cssText = 'text-align: center; margin-top: 0; color: var(--muted);';
    scoreboardSection.appendChild(scoreboardTitle);

    if (state.room?.players) {
      const sorted = [...state.room.players]
        .sort((a, b) => (finalScores[b.id] || 0) - (finalScores[a.id] || 0));

      sorted.forEach((p, i) => {
        const medal = i === 0 ? 'ðŸ¥‡' : i === 1 ? 'ðŸ¥ˆ' : i === 2 ? 'ðŸ¥‰' : 'Â·';
        const scoreDiv = document.createElement('div');
        scoreDiv.style.cssText = `
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 8px;
          border-bottom: 1px solid rgba(255, 255, 255, 0.05);
          animation: fadeIn ${0.3 + i * 0.1}s ease-out;
        `;
        scoreDiv.innerHTML = `
          <span>${medal} ${p.name}</span>
          <span style="font-weight: 800; color: var(--accent);">${finalScores[p.id] || 0}pts</span>
        `;
        scoreboardSection.appendChild(scoreDiv);
      });
    }

    const actionsDiv = document.createElement('div');
    actionsDiv.style.cssText = `
      display: flex;
      gap: 10px;
      margin-top: 20px;
    `;

    const btnHome = document.createElement('button');
    btnHome.textContent = 'ðŸ  Accueil';
    btnHome.type = 'button';
    btnHome.style.cssText = `
      flex: 1;
      padding: 12px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 800;
      cursor: pointer;
      transition: 0.2s;
    `;
    btnHome.onclick = () => {
      modal.style.display = 'none';
      socket.emit('leaveRoom');
    };
    btnHome.onmouseover = () => btnHome.style.opacity = '0.9';
    btnHome.onmouseout = () => btnHome.style.opacity = '1';

    const btnRestart = document.createElement('button');
    btnRestart.textContent = 'ðŸ”„ Recommencer';
    btnRestart.type = 'button';

    const isHost = window.HOL?.state?.room?.hostId === window.HOL?.state?.me?.id;

    if (isHost) {
      btnRestart.style.cssText = `
        flex: 1;
        padding: 12px;
        background: var(--accent);
        color: #4d0d17;
        border: none;
        border-radius: 8px;
        font-weight: 800;
        cursor: pointer;
        transition: 0.2s;
      `;
      btnRestart.onclick = () => {
        modal.style.display = 'none';
        socket.emit('resetScores');
      };
      btnRestart.onmouseover = () => btnRestart.style.opacity = '0.9';
      btnRestart.onmouseout = () => btnRestart.style.opacity = '1';
    } else {
      btnRestart.textContent = 'ðŸ”„ Seul l\'hÃ´te peut recommencer';
      btnRestart.disabled = true;
      btnRestart.style.cssText = `
        flex: 1;
        padding: 12px;
        background: rgba(255, 255, 255, 0.1);
        color: var(--muted);
        border: none;
        border-radius: 8px;
        font-weight: 800;
        cursor: not-allowed;
      `;
    }

    actionsDiv.appendChild(btnHome);
    actionsDiv.appendChild(btnRestart);

    box.innerHTML = '';
    box.appendChild(title);
    box.appendChild(winnersSection);
    box.appendChild(scoreboardSection);
    box.appendChild(actionsDiv);
  }

  function init() { initUI(); initSocket(); }
  window.HOL.features = window.HOL.features || {};
  window.HOL.features.results = { init };
})();


--- FICHIER : public/js/features/vote.js ---
// public/js/features/vote.js
// Phase "Vote" â€” Affichage en mode "Cartes / Tuiles" ðŸƒ

(function () {
  const { $, show, socket, resetPhaseProgress, state } = window.HOL;

  let myTarget = null;     // dernier choix local (hintId)
  let votingClosed = false;

  // Fixe le thÃ¨me avec fallback
  function setVoteTheme(domainMaybe) {
    const text =
      (domainMaybe && String(domainMaybe).trim()) ||
      (state?.roundDomain && String(state.roundDomain).trim()) ||
      ($('theme-hint-name')?.textContent?.trim()) ||
      'â€”';
    const el = $('theme-vote-name');
    if (el) el.textContent = text;
  }

  // --- NOUVEAU RENDU : CARTES CLIQUABLES ---
  function renderHintsWithVote(hints) {
    const box = $('hints'); if (!box) return;
    
    // Nettoyage ancien systÃ¨me (si encore prÃ©sent)
    // Le conteneur #hints contient maintenant directement les cartes

    box.style.display = '';   
    box.innerHTML = ''; // On efface la liste prÃ©cÃ©dente

    const shuffledHints = [...(hints || [])].sort(() => Math.random() - 0.5);

    shuffledHints.forEach(h => {
      // CrÃ©ation de la CARTE (c'est un bouton gÃ©ant)
      const card = document.createElement('button');
      card.type = 'button';
      card.className = 'vote-card'; // La classe CSS qu'on a ajoutÃ©e tout Ã  l'heure
      card.dataset.id = h.id;

      // Le texte de l'indice
      const fullText = (h.text ?? h.hint ?? '').toString().trim();
      const strong = document.createElement('strong');
      strong.textContent = fullText || 'â€”';
      
      card.appendChild(strong);

      // Le clic sur la carte
      card.onclick = () => {
        if (votingClosed) return;
        myTarget = h.id;

        // Visuel : On retire la sÃ©lection des autres cartes et on allume celle-ci
        box.querySelectorAll('.vote-card').forEach(b => b.classList.remove('selected'));
        card.classList.add('selected');

        // Envoi au serveur
        socket.emit('submitVote', { hintId: h.id });

        // Petit effet immÃ©diat sur le compteur (UX fluide)
        const pv = $('progress-vote');
        if (pv) {
          const [cur, tot] = (pv.textContent || '0/0').split('/').map(x => parseInt(x, 10) || 0);
          if (cur < tot) pv.textContent = `${cur + 1}/${tot}`;
        }
      };

      box.appendChild(card);
    });
  }
  // ------------------------------------------

  // Handler commun pour recevoir la liste des indices
  function handleHintsForVote(hints, domain, round) {
    votingClosed = false;
    myTarget = null;

    show('screen-vote');
    resetPhaseProgress();

    setVoteTheme(domain);           
    renderHintsWithVote(hints);     // Affiche les cartes

    const pv = $('progress-vote'); if (pv) pv.textContent = `0/${(hints || []).length}`;
  }

  function initSocket() {
    socket.on('hintsList', (hints) => {
      const mapped = (hints || []).map(h => ({
        id: h.id,
        text: (typeof h.text === 'string') ? h.text : (h.hint || '')
      }));
      handleHintsForVote(mapped, null, null);
    });

    socket.on('phaseProgress', ({ phase, submitted, total }) => {
      if (phase === 'voting') {
        const elv = $('progress-vote'); if (elv) elv.textContent = `${submitted}/${total}`;
      }
    });

    socket.on('voteAck', () => {
    });

    socket.on('timer', ({ phase, leftMs }) => {
      if (phase === 'voting' && leftMs <= 0) {
        votingClosed = true;
        document.querySelectorAll('.vote-card').forEach(b => b.disabled = true);
      }
    });
  }

  function init() { initSocket(); }
  
  window.HOL.features = window.HOL.features || {};
  window.HOL.features.vote = { init };
})();


--- FICHIER : public/js/pwa/update.js ---
// Enregistre le SW, dÃ©tecte une MAJ et affiche le bandeau "Mettre Ã  jour"
(function () {
  if (!('serviceWorker' in navigator)) return;

  const BANNER_ID = 'update-banner';
  function ensureBanner() {
    if (document.getElementById(BANNER_ID)) return;
    const wrap = document.createElement('div');
    wrap.id = BANNER_ID;
    wrap.innerHTML = `
      <div class="update-card" role="status" aria-live="polite">
        <span>âœ¨ Nouvelle version disponible</span>
        <div class="update-actions">
          <button id="update-reload" type="button">Mettre Ã  jour</button>
          <button id="update-dismiss" type="button" aria-label="Fermer">Plus tard</button>
        </div>
      </div>`;
    document.body.appendChild(wrap);
    document.getElementById('update-dismiss')?.addEventListener('click', () => wrap.remove());
    document.getElementById('update-reload')?.addEventListener('click', async () => {
      const regs = await navigator.serviceWorker.getRegistrations();
      regs.forEach(r => r.waiting?.postMessage({ type: 'SKIP_WAITING' }));
      // petit dÃ©lai puis reload
      setTimeout(() => location.reload(), 150);
    });
  }

  window.addEventListener('load', async () => {
    const reg = await navigator.serviceWorker.register('/sw.js').catch(() => null);
    if (!reg) return;

    function check(registration) {
      if (registration.waiting) {
        ensureBanner(); return;
      }
      registration.addEventListener('updatefound', () => {
        const sw = registration.installing;
        if (!sw) return;
        sw.addEventListener('statechange', () => {
          if (sw.state === 'installed' && navigator.serviceWorker.controller) ensureBanner();
        });
      });
    }
    check(reg);
    navigator.serviceWorker.addEventListener('controllerchange', () => {
      // on a pris la main â†’ on peut retirer le bandeau si prÃ©sent
      document.getElementById(BANNER_ID)?.remove();
    });
  });
})();



--- FICHIER : routes/index.js ---
// routes/index.js
const express = require('express');
const router = express.Router();
const path = require('path');

// CORRECTIF DES CHEMINS POUR RENDER
const rootDir = path.join(__dirname, '..');

// 1. Import de la config
const config = require(path.join(rootDir, 'config', 'index.js'));

// 2. Import de l'Ã©tat des salles (nÃ©cessaire pour certaines routes)
// On pointe bien vers sockets/state/room.js
const { rooms } = require('./sockets/state/room.js');

// 3. Import du setup des Sockets (pour l'exporter vers server.js)
const setupSockets = require('./sockets/index.js');

// --- TES ROUTES HTTP ---

// Route de test
router.get('/health', (req, res) => {
  res.json({ status: 'ok', rooms: rooms.size });
});

// --- EXPORT POUR SERVER.JS ---

// Cette fonction est celle que server.js appelle Ã  la ligne 15
function setupRoutes(app) {
  app.use('/', router);
}

// On exporte la fonction directement ET en tant que propriÃ©tÃ© pour Ãªtre sÃ»r
module.exports = setupRoutes;
module.exports.setupRoutes = setupRoutes;
module.exports.setupSockets = setupSockets;


--- FICHIER : routes/sockets/index.js ---
// routes/sockets/index.js
const path = require('path');

const { HINT_SECONDS, VOTE_SECONDS, LOBBY_READY_SECONDS } =
  require(path.join(__dirname, '..', '..', 'config', 'index.js'));

const { rooms, snapshot, broadcast, createRoom } =
  require(path.join(__dirname, 'state', 'room.js'));

const { clearRoomTimer, startPhaseTimer } =
  require(path.join(__dirname, 'timer.js'));

const { isHintAllowed } =
  require(path.join(__dirname, 'game', 'validate.js'));

let makePersistence = () => ({
  upsertRoundResult: async () => {},
  getTop50:          async () => [],
  getMyStats:        async () => null,
  applyPenaltyIfNotWinner: async () => ({ ok:false, reason:'no-db' }),
});
try {
  makePersistence = require(path.join(__dirname, '..', 'utils', 'persistence.js')).makePersistence;
} catch {
  console.log('â„¹ï¸ Persistence non branchÃ©e (utils/persistence.js introuvable).');
}

const { createController } =
  require(path.join(__dirname, 'game', 'controller.js'));

function normalizeLocal(s) {
  return String(s || '')
    .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
    .toLowerCase()
    .replace(/[^a-z0-9]+/gi, ' ')
    .trim().replace(/\s+/g, ' ');
}

module.exports = function setupSockets(io, db){
  const { upsertRoundResult, getTop50, getMyStats, applyPenaltyIfNotWinner } = makePersistence(db);
  const controller = createController({ io, upsertRoundResult, applyPenaltyIfNotWinner, HINT_SECONDS, VOTE_SECONDS });

  io.on('connection',(socket)=>{
    let joined  = { code:null };
    let profile = { deviceId:null, lastPseudo:null };

    socket.on('hello', ({ deviceId, pseudo } = {})=>{
      if (deviceId) profile.deviceId   = String(deviceId).slice(0,64);
      if (pseudo)   profile.lastPseudo = String(pseudo).slice(0,16);
    });

    socket.on('getLeaderboard', async ()=>{
      try{
        const top = await getTop50();
        const payload = top.map(x => ({
          deviceId: x.deviceId,
          pseudo:   x.lastPseudo || 'Joueur',
          wins:     Number(x.wins || 0),
          rp:       Number(x.rp || 0),
        }));
        socket.emit('leaderboard', payload);
        socket.emit('leaderboardData', payload);
      }catch{
        socket.emit('errorMsg','Impossible de charger le Top 50');
      }
    });

    socket.on('getMyStats', async ({ deviceId })=>{
      const doc = await getMyStats(String(deviceId||''));
      socket.emit('myStats', doc ? {
        rp:Number(doc.rp||0), rounds:Number(doc.rounds||0), wins:Number(doc.wins||0),
        winsCrew:Number(doc.winsCrew||0), winsImpostor:Number(doc.winsImpostor||0)
      } : { rp:0, rounds:0, wins:0, winsCrew:0, winsImpostor:0 });
    });

    socket.on('createRoom', ({ name, deviceId, pseudo } = {}) => {
      try {
        const displayName = String(name || pseudo || profile.lastPseudo || 'Joueur').slice(0, 16);
        
        const code = createRoom(socket.id, displayName);

        socket.join(code);
        joined.code = code;
        profile.lastPseudo = displayName;
        profile.deviceId = String(deviceId || profile.deviceId || '').slice(0, 64) || null;

        const r = rooms.get(code);
        if (r && r.players.has(socket.id)) {
          r.players.get(socket.id).deviceId = profile.deviceId;
        }

        socket.emit('roomCreated', { code });
        broadcast(io, code);
      } catch (err) {
        socket.emit('errorMsg', 'Erreur lors de la crÃ©ation de la salle.');
      }
    });
    socket.on('joinRoom', ({ code, name, deviceId, pseudo } = {})=>{
      code = String(code || '').trim();
      if (!/^\d{4}$/.test(code)) return socket.emit('errorMsg','Code invalide (4 chiffres)');
      const r = rooms.get(code); if (!r) return socket.emit('errorMsg','Salle introuvable');

      socket.join(code);
      joined.code = code;

      const displayName = String(name || pseudo || profile.lastPseudo || 'Joueur').slice(0,16);
      profile.lastPseudo = displayName;
      profile.deviceId   = String(deviceId || profile.deviceId || '').slice(0,64) || null;

      let disconnectedPlayerEntry = null;
      for (const [id, p] of r.players.entries()) {
        if (p.name === displayName && p.disconnected) {
          disconnectedPlayerEntry = [id, p];
          break;
        }
      }

      if (disconnectedPlayerEntry) {
        const [oldId, pData] = disconnectedPlayerEntry;
        r.players.delete(oldId); 
        if(r.active?.has(oldId)) {
          r.active.delete(oldId);
        }
        pData.disconnected = false;
        pData.disconnectedSince = undefined;
        r.players.set(socket.id, pData);

        io.to(code).emit('system', { text: `ðŸŽ‰ ${displayName} est de retour !` });

        const gameState = {
          state: r.state,
          phase: r.state,
          round: r.round || 0,
          players: Array.from(r.players.entries()).map(([id, p]) => ({
            id: id,
            name: p.name,
            score: p.score || 0,
            disconnected: !!p.disconnected
          })),
          scores: Object.fromEntries(
            Array.from(r.players.entries()).map(([id, p]) => [id, p.score || 0])
          )
        };
        socket.emit('gameStateSync', gameState);

        if (r.state !== 'lobby' && pData.spectator) {
          socket.emit('spectatorMode', { 
            phase: r.state, 
            message: 'Vous continuez Ã  regarder la manche en cours.' 
          });
        }

      } else {
        const isPseudoTaken = Array.from(r.players.values()).some(p => !p.disconnected && p.name === displayName);
        if (isPseudoTaken) {
          socket.leave(code);
          joined.code = null;
          return socket.emit('errorMsg', 'Ce pseudo est dÃ©jÃ  pris, merci d\'en choisir un autre.');
        }

        r.players.set(socket.id, {
          name: displayName, hint:null, vote:null, isImpostor:false, score:0,
          deviceId: profile.deviceId,
          spectator: false
        });
      }

      if (r.state !== 'lobby') {
        const p = r.players.get(socket.id);
        if (p) p.spectator = true;
        socket.emit('spectatorMode', { 
          phase: r.state, 
          message: 'Manche en cours. Vous rejoindrez la prochaine manche.' 
        });

        if (r.active && r.active.size) {
          if (r.state === 'hints') {
            const submitted = Array.from(r.active).filter(id => typeof r.players.get(id)?.hint === 'string').length;
            io.to(code).emit('phaseProgress', { phase:'hints', submitted, total: r.active.size });
          } else if (r.state === 'voting') {
            const submitted = Array.from(r.active).filter(id => !!r.players.get(id)?.vote).length;
            io.to(code).emit('phaseProgress', { phase:'voting', submitted, total: r.active.size });
          }
        }
      }

      socket.emit('roomJoined', { code });
      broadcast(io, code);

      r.lobbyReady ||= new Set();
      const connectedCount = Array.from(r.players.values()).filter(p => !p.disconnected).length;
      io.to(code).emit('lobbyReadyProgress', { ready: r.lobbyReady.size, total: connectedCount });
    });

    socket.on('leaveRoom', ()=>{
      const code = joined.code; if(!code) return;
      const r = rooms.get(code); if(!r) return;
      
      const me = r.players.get(socket.id);
      const name = me?.name || 'Un joueur';

      r.players.delete(socket.id);
      if (r.active?.has(socket.id)) r.active.delete(socket.id);
      if (r.lobbyReady?.has(socket.id)) r.lobbyReady.delete(socket.id);
      if (r.readyNext?.has(socket.id)) r.readyNext.delete(socket.id);

      if (r.players.size === 0) {
        rooms.delete(code);
        socket.leave(code);
        joined.code = null;
        return;
      }

      if (r.timer?.phase === 'lobby') {
        clearRoomTimer(r);
        io.to(code).emit('lobbyCountdownCancelled');
      }

      if (r.hostId === socket.id) {
        const first = r.players.keys().next().value;
        if (first) r.hostId = first;
      }
      
      io.to(code).emit('system', { text: `ðŸ‘‹ ${name} a quittÃ© la partie.` });

      const activePlayers = Array.from(r.players.values()).filter(p => !p.disconnected);
      if ((r.state === 'hints' || r.state === 'voting') && activePlayers.length < 3) {
        clearRoomTimer(r);
        for (const p of r.players.values()) {
          p.hint = null; p.vote = null; p.isImpostor = false;
        }
        r.state = 'lobby';
        r.lobbyReady = new Set();
        r.readyNext  = new Set();
        r.used = {};
        r.impostor = null;

        io.to(code).emit('lobbyCountdownCancelled');
        io.to(code).emit('errorMsg', 'Pas assez de joueurs actifs, retour au lobby');
      }

      socket.leave(code);
      joined.code = null;
      broadcast(io, code);
      socket.emit('leftRoom');
    });

    socket.on('playerReadyLobby', ({ ready })=>{
      const r = rooms.get(joined.code); if(!r) return; if (r.state !== 'lobby') return;

      r.lobbyReady ||= new Set();
      if (ready) r.lobbyReady.add(socket.id); else r.lobbyReady.delete(socket.id);

      const connectedCount = Array.from(r.players.values()).filter(p => !p.disconnected).length;
      io.to(joined.code).emit('lobbyReadyProgress', { ready: r.lobbyReady.size, total: connectedCount });

      if (r.lobbyReady.size === connectedCount && connectedCount >= 3){
        clearRoomTimer(r);
        startPhaseTimer(io, joined.code, LOBBY_READY_SECONDS, 'lobby', ()=> controller.startRound(joined.code));
        io.to(joined.code).emit('lobbyCountdownStarted', { seconds: LOBBY_READY_SECONDS });
      } else if (r.timer?.phase === 'lobby'){
        clearRoomTimer(r);
        io.to(joined.code).emit('lobbyCountdownCancelled');
      }
    });

    socket.on('startRound', ()=>{
      const r = rooms.get(joined.code); if(!r) return;
      if (r.hostId !== socket.id) return socket.emit('errorMsg',"Seul l'hÃ´te peut dÃ©marrer");
      controller.startRound(joined.code);
      socket.emit('actionAck', { action:'startRound', status:'ok' });
    });

    socket.on('submitHint', ({ hint })=>{
      const r = rooms.get(joined.code); if(!r || r.state!=='hints') return;
      if (r.state === 'gameOver') return socket.emit('errorMsg', 'La partie est terminÃ©e');
      const p = r.players.get(socket.id); if(!p) return;

      if (p.spectator || !r.active?.has(socket.id)) return socket.emit('errorMsg', 'Tu participeras au prochain round (spectateur)');
      if (typeof p.hint === 'string') return;

      const raw = String(hint||'').trim().slice(0,40);

      const mySecret = r.words.common;
      const check = isHintAllowed(mySecret, raw, r.words.domain);
      if (!check.ok) return socket.emit('hintRejected', { reason: check.reason });

      r.usedHints ||= new Set();
      const key = normalizeLocal(raw);
      if (r.usedHints.has(key)) return socket.emit('hintRejected', { reason: "Indice dÃ©jÃ  utilisÃ© par un autre joueur." });
      r.usedHints.add(key);

      p.hint = raw;
      socket.emit('hintAck');

      if (!p.isImpostor) {
        r.liveCrewHints ||= [];
        const item = { id: socket.id, name: p.name, hint: raw };
        r.liveCrewHints.push({ name: p.name, hint: raw });

        if (r.impostor) {
          const impSock = io.sockets.sockets.get(r.impostor);
          if (impSock) impSock.emit('crewHintAdded', item);
          else io.to(r.impostor).emit('crewHintAdded', item);
        }
      }

      const submitted = Array.from(r.active).filter(id => typeof r.players.get(id)?.hint === 'string').length;
      io.to(joined.code).emit('phaseProgress', { phase:'hints', submitted, total: r.active.size });

      controller.maybeStartVoting(joined.code);
    });

    socket.on('submitVote', ({ hintId, targetId } = {}) => {
      const r = rooms.get(joined.code); if (!r || r.state !== 'voting') return;
      if (r.state === 'gameOver') return socket.emit('errorMsg', 'La partie est terminÃ©e');
      const me = r.players.get(socket.id); if (!me) return;

      if (me.spectator || !r.active?.has(socket.id)) {
        return socket.emit('errorMsg', 'Tu voteras Ã  la prochaine manche (spectateur)');
      }

      const voteVal = hintId || targetId;
      if (!voteVal) return;

      controller.handleVote(joined.code, socket.id, voteVal);
      socket.emit('voteAck');
    });

    socket.on('playerReadyNext', ()=>{
      const r = rooms.get(joined.code); if(!r) return; if (r.state !== 'reveal') return;
      r.readyNext ||= new Set();
      r.readyNext.add(socket.id);
      const activeCount = Array.from(r.players.values()).filter(p => !p.disconnected).length;
      io.to(joined.code).emit('readyProgress', { ready: r.readyNext.size, total: activeCount });
      if (r.readyNext.size >= activeCount && activeCount > 0){
        startPhaseTimer(io, joined.code, 3, 'prestart', ()=> controller.startRound(joined.code));
      }
    });

    socket.on('resetScores', ()=>{
      const r = rooms.get(joined.code); if(!r) return;
      if (r.hostId !== socket.id) return socket.emit('errorMsg',"Seul l'hÃ´te peut rÃ©initialiser");
      for (const p of r.players.values()) p.score = 0;
      r.round = 0; r.state='lobby'; r.used={}; r.lobbyReady = new Set(); r.readyNext = new Set();
      clearRoomTimer(r);
      io.to(joined.code).emit('lobbyCountdownCancelled');
      io.to(joined.code).emit('scoresReset');
      broadcast(io, joined.code);
    });

    socket.on('disconnect', () => {
      const code = joined.code; if (!code) return;
      const r = rooms.get(code); if (!r) return;

      const me = r.players.get(socket.id);
      if (!me) return;

      me.disconnected = true;
      me.disconnectedSince = r.round;
      const name = me.name || 'Un joueur';
      const wasHost = (r.hostId === socket.id);
      const wasImpostor = !!me.isImpostor;

      const activePlayers = Array.from(r.players.values()).filter(p => !p.disconnected);
      if (activePlayers.length === 0) {
        rooms.delete(code);
        return;
      }

      if (wasHost) {
        const firstActive = Array.from(r.players.entries()).find(([id, p]) => !p.disconnected);
        if (firstActive) {
          r.hostId = firstActive[0];
        }
      }

      io.to(code).emit('system', { text: `ðŸ‘‹ ${name} a quittÃ© la partie` });

      const totalPlayers = activePlayers.length;
      if (r.lobbyReady) {
        io.to(code).emit('lobbyReadyProgress', { ready: r.lobbyReady.size, total: totalPlayers });
      }
      if (r.readyNext) {
        io.to(code).emit('readyProgress', { ready: r.readyNext.size, total: totalPlayers });
      }


      const activeInGame = Array.from(r.active || []).filter(id => !r.players.get(id)?.disconnected);
      if ((r.state === 'hints' || r.state === 'voting') && activeInGame.length < 3) {
        clearRoomTimer(r);
        for (const id of r.players.keys()) {
          const p = r.players.get(id);
          if (p) { p.hint = null; p.vote = null; p.isImpostor = false; }
        }
        r.state = 'lobby';
        r.lobbyReady = new Set();
        r.readyNext  = new Set();
        r.used = {};
        r.impostor = null;

        io.to(code).emit('lobbyCountdownCancelled');
        io.to(code).emit('errorMsg', 'Pas assez de joueurs actifs, retour au lobby');
        broadcast(io, code);
        return;
      }

      if (r.state === 'hints') {
        const activeConnected = Array.from(r.active).filter(id => !r.players.get(id)?.disconnected);
        const submitted = activeConnected.filter(id => typeof r.players.get(id)?.hint === 'string').length;
        io.to(code).emit('phaseProgress', { phase:'hints', submitted, total: activeConnected.length });
        if (submitted === activeConnected.length && activeConnected.length > 0) {
          controller.maybeStartVoting(code);
        }
      } else if (r.state === 'voting') {
        const activeConnected = Array.from(r.active).filter(id => !r.players.get(id)?.disconnected);
        const submitted = activeConnected.filter(id => !!r.players.get(id)?.vote).length;
        io.to(code).emit('phaseProgress', { phase:'voting', submitted, total: activeConnected.length });
        if (submitted === activeConnected.length && activeConnected.length > 0) {
          controller.finishVoting(code);
        }
      }

      if (wasImpostor && (r.state === 'hints' || r.state === 'voting')) {
        clearRoomTimer(r);
        for (const id of r.active || []) {
          const p = r.players.get(id);
          if (p && !p.isImpostor && !p.disconnected) p.score = (p.score || 0) + 1;
        }

        io.to(code).emit('roundResult', {
          round: r.round,
          impostorId: socket.id,
          impostorName: name,
          common: r.words?.common,
          impostor: null,
          impostorHint: null,
          commonDisplay: r.words?.common,
          impostorDisplay: "â€”",
          votes: {},
          impostorCaught: true,
          domain: r.words?.domain
        });

        r.state = 'reveal';
        r.readyNext = new Set();
        io.to(code).emit('readyProgress', { ready: 0, total: totalPlayers });

        const scores = Array.from(r.players.values()).filter(p => !p.disconnected).map(p => p.score || 0);
        const maxScore = Math.max(0, ...scores);
        if (maxScore >= 10) {
           const winnersArr = Array.from(r.players.entries())
            .filter(([_, p]) => !p.disconnected && (p.score || 0) === maxScore)
            .map(([id, p]) => ({ id, name: p.name, score: p.score || 0 }));
          io.to(code).emit('gameOver', { winners: winnersArr, round: r.round, autoReset: true });

          for (const p of r.players.values()) { p.score = 0; p.hint = null; p.vote = null; p.isImpostor = false; p.spectator = false; }
          r.round = 0; r.state = 'lobby'; r.lobbyReady = new Set(); r.readyNext = new Set(); r.used = {};
          clearRoomTimer(r);
        }
      }

      broadcast(io, code);
    });
  });
};


--- FICHIER : routes/sockets/persistence.js ---
// routes/utils/persistence.js
function makePersistence(db) {
  // Fallback si pas de DB (no-op sÃ»r)
  if (!db) {
    return {
      upsertRoundResult:        async () => {},
      applyPenaltyIfNotWinner:  async () => ({ ok:false, reason:'no-db' }),
      getTop50:                 async () => [],
      getMyStats:               async () => null,
    };
  }

  const admin = require('firebase-admin');
  const { getHlRank, getPenaltyByRank } = require('./hlrank');

  // Enregistre les points gagnÃ©s sur la MANCHE (tes rÃ¨gles actuelles)
  async function upsertRoundResult({ deviceId, pseudo, didWin, isImpostor }) {
    try {
      const ref = db.collection('players').doc(String(deviceId));
      await db.runTransaction(async (tx) => {
        const snap = await tx.get(ref);
        const prev = snap.exists ? (snap.data() || {}) : {};

        const prevRP = Number(prev.rp || 0);
        const delta = didWin ? (isImpostor ? 3 : 1) : 0; // (tu ne mettais pas de malus par manche)
        let newRP = prevRP + delta;

        tx.set(ref, {
          deviceId: String(deviceId),
          lastPseudo: String(pseudo || prev.lastPseudo || 'Joueur').slice(0, 16),
          rounds: Number(prev.rounds || 0) + 1,
          wins: Number(prev.wins || 0) + (didWin ? 1 : 0),
          winsCrew: Number(prev.winsCrew || 0) + (didWin && !isImpostor ? 1 : 0),
          winsImpostor: Number(prev.winsImpostor || 0) + (didWin && isImpostor ? 1 : 0),
          rp: newRP,
          updatedAt: admin.firestore.FieldValue.serverTimestamp(),
        }, { merge: true });
      });
    } catch (e) {
      console.error('upsertRoundResult error', e);
    }
  }

  // PÃ©nalitÃ© de FIN DE PARTIE (non-vainqueurs), basÃ©e sur le rang AVANT pÃ©nalitÃ©
  async function applyPenaltyIfNotWinner({ deviceId, pseudo }) {
    try {
      const ref = db.collection('players').doc(String(deviceId));
      let result = null;

      await db.runTransaction(async (tx) => {
        const snap = await tx.get(ref);
        const prev = snap.exists ? (snap.data() || {}) : {};
        const rpBefore = Number(prev.rp || 0);
        const rankBefore = getHlRank(rpBefore);
        const penalty = getPenaltyByRank(rankBefore);
        const rpAfter = Math.max(0, rpBefore - penalty);

        tx.set(ref, {
          deviceId: String(deviceId),
          lastPseudo: String(pseudo || prev.lastPseudo || 'Joueur').slice(0, 16),
          rp: rpAfter,
          updatedAt: admin.firestore.FieldValue.serverTimestamp(),
        }, { merge: true });

        result = { ok: true, rpBefore, rankBefore, penalty, rpAfter };
      });

      return result || { ok:false, reason:'txn' };
    } catch (e) {
      console.error('applyPenaltyIfNotWinner error', e);
      return { ok:false, reason: e.message };
    }
  }

  async function getTop50() {
    try {
      const qs = await db.collection('players')
        .orderBy('rp', 'desc')
        .orderBy('wins', 'desc')
        .limit(50)
        .get();
      return qs.docs.map(d => ({ deviceId: d.id, ...(d.data() || {}) }));
    } catch (e) {
      console.error('getTop50 error', e);
      return [];
    }
  }

  async function getMyStats(deviceId) {
    try {
      const snap = await db.collection('players').doc(String(deviceId)).get();
      return snap.exists ? (snap.data() || {}) : null;
    } catch (e) {
      console.error('getMyStats error', e);
      return null;
    }
  }

  return { upsertRoundResult, applyPenaltyIfNotWinner, getTop50, getMyStats };
}

module.exports = { makePersistence };



--- FICHIER : routes/sockets/timer.js ---
// routes/sockets/timer.js
const path = require('path');

// âœ… chemin corrigÃ©: state/room.js
const { rooms: _rooms } =
  require(path.join(__dirname, 'state', 'room.js'));

function clearRoomTimer(room){
  if (room?.timer?.interval) clearInterval(room.timer.interval);
  if (room) room.timer = { interval:null, deadline:0, phase:null };
}

function startPhaseTimer(io, code, seconds, phase, onExpire){
  const room = _rooms.get(code); if(!room) return;
  clearRoomTimer(room);
  const deadline = Date.now() + seconds*1000;
  const totalMs = seconds * 1000;

  const thisTimerInterval = setInterval(()=>{
    const currentRoom = _rooms.get(code);
    if (!currentRoom) {
        clearInterval(thisTimerInterval);
        return;
    }

    // If the room's current timer isn't this one, this one is stale and should just stop.
    if (currentRoom.timer.interval !== thisTimerInterval) {
        clearInterval(thisTimerInterval);
        return;
    }

    const leftMs = Math.max(0, deadline - Date.now());
    io.to(code).emit('timer', { phase, leftMs, totalMs });

    if (leftMs <= 0){
      // This timer is expiring. Clear it from the room state BEFORE calling onExpire.
      // This prevents onExpire from clearing a *new* timer if it creates one.
      clearInterval(thisTimerInterval);
      currentRoom.timer = { interval:null, deadline:0, phase:null };

      // Now call the original callback.
      onExpire?.();
    }
  }, 500);

  // Store the new timer's identity in the room.
  room.timer = { interval: thisTimerInterval, deadline, phase };
}

module.exports = { clearRoomTimer, startPhaseTimer };



--- FICHIER : routes/sockets/game/controller.js ---
// routes/sockets/game/controller.js
const path = require('path');

const { rooms, broadcast } =
  require(path.join(__dirname, '..', 'state', 'room.js'));
const { labelWordByDomain } =
  require(path.join(__dirname, 'words.js'));
const { pickPair } =
  require(path.join(__dirname, 'picker.js'));
const { clearRoomTimer, startPhaseTimer } =
  require(path.join(__dirname, '..', 'timer.js'));

function createController({ io, upsertRoundResult, applyPenaltyIfNotWinner, HINT_SECONDS, VOTE_SECONDS }) {

  function startRound(code) {
    const r = rooms.get(code); if (!r) return;

    for (const [id, p] of r.players.entries()) {
      if (p.disconnected && (r.round - p.disconnectedSince) >= 2) {
        r.players.delete(id);
        if(r.active?.has(id)) r.active.delete(id);
      }
    }
    
    for (const p of r.players.values()) {
      p.spectator = false;
    }

    clearRoomTimer(r);
    r.lobbyReady = new Set();
    r.readyNext  = new Set();

    r.active = new Set(Array.from(r.players.entries()).filter(([_, p]) => !p.disconnected).map(([id]) => id));

    if (r.active.size < 3) {
      io.to(code).emit('errorMsg', 'Minimum 3 joueurs');
      r.state = 'lobby';
      return broadcast(io, code);
    }

    for (const p of r.players.values()) {
      p.hint = null;
      p.vote = null;
      p.isImpostor = false;
    }

    r.hints = [];
    r.hintAuthor = new Map();

    const pair = pickPair(r);
    r.words = { common: pair.common, impostor: null, domain: pair.domain };
    r.lastDomain = pair.domain;
    r.lastCommon = pair.common;

    const activeIds = Array.from(r.active);
    const impId = activeIds[Math.floor(Math.random() * activeIds.length)];
    r.impostor = impId;
    const imp = r.players.get(impId);
    if (imp) imp.isImpostor = true;

    r.usedHints = new Set();
    r.liveCrewHints = [];

    r.round = (r.round || 0) + 1;
    r.state = 'hints';

    for (const id of r.active) {
      const p = r.players.get(id);
      if (!p) continue;

      if (p.isImpostor) {
        io.to(id).emit('roundInfo', {
          word: null,
          wordDisplay: 'Aucun mot â€” observe les indices',
          isImpostor: true,
          domain: r.words.domain,
          round: r.round,
        });
      } else {
        const myword = r.words.common;
        io.to(id).emit('roundInfo', {
          word: myword,
          wordDisplay: labelWordByDomain(myword, r.words.domain),
          isImpostor: false,
          domain: r.words.domain,
          round: r.round,
        });
      }
    }

    if (r.impostor) io.to(r.impostor).emit('crewHintsLive', { hints: r.liveCrewHints });

    io.to(code).emit('phaseProgress', { phase: 'hints', submitted: 0, total: r.active.size, round: r.round });

    startPhaseTimer(io, code, HINT_SECONDS, 'hints', () => {
      const room = rooms.get(code); if (!room) return;
      for (const id of room.active) {
        const p = room.players.get(id);
        if (p && typeof p.hint !== 'string') p.hint = '';
      }
      maybeStartVoting(code);
    });

    broadcast(io, code);
  }

  function maybeStartVoting(code) {
    const r = rooms.get(code); if (!r) return;
    if (r.state !== 'hints') return;
    const activeConnected = Array.from(r.active || []).filter(id => !r.players.get(id)?.disconnected);
    const submitted = activeConnected.filter(id => typeof r.players.get(id)?.hint === 'string').length;
    const total = activeConnected.length;

    if (submitted === total && total > 0) {
      clearRoomTimer(r);
      r.state = 'voting';

      r.hints = [];
      r.hintAuthor = new Map();
      const now = Date.now();

      for (const id of r.active) {
        const p = r.players.get(id);
        if (!p || typeof p.hint !== 'string') continue;
        const text = p.hint.trim();
        const hid  = `H_${r.round || 1}_${id}`;
        r.hints.push({ id: hid, playerId: id, text, ts: now });
        r.hintAuthor.set(hid, id);
      }

      const hintsPayload = r.hints.map(h => ({ id: h.id, hint: h.text }));
      io.to(code).emit('hintsList', hintsPayload);

      startPhaseTimer(io, code, VOTE_SECONDS, 'voting', () => finishVoting(code));
      broadcast(io, code);
    } else {
      io.to(code).emit('phaseProgress', { phase: 'hints', submitted, total, round: r.round });
    }
  }

  function handleVote(code, playerId, voteId) {
    const r = rooms.get(code);
    if (!r || r.state !== 'voting') return;

    const p = r.players.get(playerId);
    if (!p) return;

    p.vote = voteId;

    const activeConnected = Array.from(r.active || []).filter(id => !r.players.get(id)?.disconnected);
    const submitted = activeConnected.filter(id => r.players.get(id)?.vote).length;
    const total = activeConnected.length;

    io.to(code).emit('phaseProgress', { phase: 'voting', submitted, total, round: r.round });

    if (submitted === total && total > 0) {
      finishVoting(code);
    }
  }

  function finishVoting(code) {
    const r = rooms.get(code); if (!r) return;
    if (r.state !== 'voting') return;

    clearRoomTimer(r);

    const activeConnected = Array.from(r.active || []).filter(id => !r.players.get(id)?.disconnected);
    const impId = r.impostor;

    if (r.hintAuthor && typeof r.hintAuthor.get === 'function') {
      for (const id of activeConnected) {
        const p = r.players.get(id);
        if (p?.vote && r.hintAuthor.has(p.vote)) {
          p.vote = r.hintAuthor.get(p.vote);
        }
      }
    }

    const tally = {};
    for (const id of activeConnected) {
      const p = r.players.get(id);
      if (p?.vote) tally[p.vote] = (tally[p.vote] || 0) + 1;
    }

    let max = -1;
    let leaders = [];
    for (const [candidate, v] of Object.entries(tally)) {
      if (v > max) { max = v; leaders = [candidate]; }
      else if (v === max) { leaders.push(candidate); }
    }
    const caught = (leaders.length === 1 && leaders[0] === impId);

    if (caught) {
      for (const id of activeConnected) {
        const p = r.players.get(id);
        if (p && !p.isImpostor) p.score = (p.score || 0) + 1;
      }
    } else {
      const imp = r.players.get(impId);
      if (imp) imp.score = (imp.score || 0) + 2;
    }

    const winners = new Set();
    if (caught) {
      for (const id of activeConnected) {
        if (!r.players.get(id)?.isImpostor) winners.add(id);
      }
    } else if (impId) {
      winners.add(impId);
    }

    for (const id of activeConnected) {
       const p = r.players.get(id);
       const didWin = winners.has(id);
       if (p?.deviceId) {
         upsertRoundResult?.({ deviceId: p.deviceId, pseudo: p.name, didWin, isImpostor: !!p.isImpostor });
       }
    }

const impostorHint =
  (Array.isArray(r.hints) ? r.hints.find(h => h.playerId === impId)?.text : '') || 'â€”';

const votesDetail = {};
for (const id of activeConnected) {
  const p = r.players.get(id);
  if (p?.vote) {
    votesDetail[id] = p.vote;
  }
}
io.to(code).emit('roundResult', {
  round: r.round,
  impostorId: impId,
  impostorName: r.players.get(impId)?.name || '?',
  common: r.words?.common,
  impostor: null,
  impostorHint,
  commonDisplay: labelWordByDomain(r.words?.common, r.words?.domain),
  impostorDisplay: 'â€”',
  votes: tally,
  votesDetail: votesDetail,
  impostorCaught: caught,
  domain: r.words?.domain,
});

    const activePlayers = Array.from(r.players.entries()).filter(([_, p]) => !p.disconnected);
    const maxScore = Math.max(0, ...activePlayers.map(([_, p]) => p.score || 0));
    const isGameOver = maxScore >= 10;

    if (!isGameOver) {
      r.state = 'reveal';
      r.readyNext = new Set();
      io.to(code).emit('readyProgress', { ready: 0, total: activePlayers.length });
      
      broadcast(io, code);

    } else {
      const winnersArr = activePlayers
        .filter(([_, p]) => (p.score || 0) === maxScore)
        .map(([id, p]) => ({ id, name: p.name, score: p.score || 0, deviceId: p.deviceId }));

      if (typeof applyPenaltyIfNotWinner === 'function') {
        const winnerIds = new Set(winnersArr.map(w => w.id));
        for (const [id, p] of activePlayers) {
          if (!winnerIds.has(id) && p?.deviceId) {
            applyPenaltyIfNotWinner({ deviceId: p.deviceId, pseudo: p.name })
              .catch(() => {});
          }
        }
      }

      r.state = 'gameOver';

      io.to(code).emit('gameOver', {
        winners: winnersArr,
        round: r.round,
        finalScores: Object.fromEntries(activePlayers.map(([id, p]) => [id, p.score || 0])),
        winnersCount: winnersArr.length,
        isGameOver: true,
      });

      for (const p of r.players.values()) {
        p.score = 0;
        p.hint = null;
        p.vote = null;
        p.isImpostor = false;
        p.spectator = false;
      }
      r.round = 0;
      r.state = 'lobby';
      r.lobbyReady = new Set();
      r.readyNext = new Set();
      r.used = {};
      r.impostor = null;

      broadcast(io, code);
    }
  }

  return { startRound, maybeStartVoting, finishVoting, handleVote };
}

module.exports = { createController };



--- FICHIER : routes/sockets/game/picker.js ---
// routes/sockets/game/picker.js
const path = require('path');

const { DOMAINS } =
  require(path.join(__dirname, 'words.js'));
const { pick } =
  require(path.join(__dirname, '..', 'utils', 'random.js'));

// Tirage "unique" sans clusters, avec anti-doublons + anti rÃ©pÃ©tition immÃ©diate
function pickPair(room) {
  room.used ||= {};
  room.lastDomains ||= [];
  const cooldown = room.domainCooldown ?? 1;

  const all = Object.keys(DOMAINS);
  const validDomains = all.filter(d => (DOMAINS[d]?.length || 0) >= 2);
  if (!validDomains.length) return { common: 'Erreur', impostor: 'Erreur', domain: 'Aucun domaine' };

  // Ã©vite de reprendre le mÃªme domaine trop souvent (cooldown)
  const banned = new Set(room.lastDomains.slice(-cooldown));
  const candidates = validDomains.filter(d => !banned.has(d));
  const domain = (candidates.length ? pick(candidates) : pick(validDomains));

  room.used[domain] ||= new Set();
  const usedSet = room.used[domain];

  // anti-doublons: on privilÃ©gie les mots jamais sortis; sinon on rouvre le pool
  const pool0 = DOMAINS[domain].slice();
  let pool = pool0.filter(w => !usedSet.has(w));
  if (pool.length < 2) pool = pool0.slice();

  // mot commun: Ã©viter de retomber deux fois de suite sur le mÃªme
  let common = pick(pool);
  let guard = 0;
  while (common === room.lastCommon && pool.length > 1 && guard++ < 10) {
    common = pick(pool);
  }

  // imposteur â‰  commun; fallback si nÃ©cessaire
  let impostorChoices = pool.filter(w => w !== common);
  if (!impostorChoices.length) impostorChoices = pool0.filter(w => w !== common);
  const impostor = pick(impostorChoices);

  // marquer comme utilisÃ©s
  usedSet.add(common);
  usedSet.add(impostor);

  room.lastCommon = common;
  room.lastDomains.push(domain);
  if (room.lastDomains.length > 5) room.lastDomains.shift();

  return { common, impostor, domain };
}

module.exports = { pickPair };



--- FICHIER : routes/sockets/game/validate.js ---
// routes/sockets/game/validate.js
const deburr = (s='') => s.normalize('NFD').replace(/[\u0300-\u036f]/g,'');
const normalize = (s='') =>
  deburr(String(s).toLowerCase()).replace(/[^a-z0-9 ]+/g,' ').replace(/\s+/g,' ').trim();

function levenshtein(a,b){
  a = normalize(a); b = normalize(b);
  const m=a.length, n=b.length; if(!m) return n; if(!n) return m;
  const dp = Array.from({length:m+1},()=>Array(n+1).fill(0));
  for(let i=0;i<=m;i++) dp[i][0]=i; for(let j=0;j<=n;j++) dp[0][j]=j;
  for(let i=1;i<=m;i++) for(let j=1;j<=n;j++)
    dp[i][j]=Math.min(dp[i-1][j]+1, dp[i][j-1]+1, dp[i-1][j-1]+(a[i-1]===b[i-1]?0:1));
  return dp[m][n];
}

function isHintAllowed(secretWord, hint, domain){
  const h = normalize(hint);
  const w = normalize(secretWord);
  if (!h) return { ok:false, reason:"Indice vide." };
  const plurals = new Set([w, w+'s', w+'es']);
  if (plurals.has(h)) return { ok:false, reason:"Indice identique au mot." };
  const wordsInHint = new Set(h.split(' '));
  if (wordsInHint.has(w) || wordsInHint.has(w+'s') || wordsInHint.has(w+'es')) return { ok:false, reason:"Tu as utilisÃ© le mot lui-mÃªme." };
  if (h.includes(w) && w.length>=4) return { ok:false, reason:"Indice trop proche du mot." };
  if (w.length>=5 && levenshtein(w,h) <= 2) return { ok:false, reason:"Indice presque identique." };
  const dom = normalize(domain||'');
  const domTokens = dom.split(' ').filter(Boolean);
  const banned = new Set();
  for (const t of domTokens){ banned.add(t); if (t.endsWith('es')) banned.add(t.slice(0,-2)); if (t.endsWith('s')) banned.add(t.slice(0,-1)); }
  if (banned.has(h)) return { ok:false, reason:"Nâ€™utilise pas le nom du thÃ¨me." };
  for (const token of wordsInHint){ if (banned.has(token)) return { ok:false, reason:"Indice trop proche du thÃ¨me." }; }
  return { ok:true };
}

module.exports = { deburr, normalize, levenshtein, isHintAllowed };



--- FICHIER : routes/sockets/game/words.js ---
// --- sockets/game/words.js ---
const DOMAINS = {
  "Fruits Fleurs LÃ©gumes": [
    "Mangue","Papaye","Ananas","Banane","Pomme","Poire","Raisin","Myrtille",
    "PastÃ¨que","Melon","Citron","Orange","Kiwi","Fraise","Noix de coco","Concombre",
    "Tomate","Poivron","Oignons","Hibiscus","Tipanier (frangipanier)","Rose","Corossol",
    "Laitue","Carotte","Aubergine","Courgette","Basilic"
  ],
  "Animaux": [
    "Chat","Chien","Tortue","Kangourou","Dauphin","Requin","Panda","Koala","Tigre",
    "Lion","Perroquet","Toucan","Cheval","ZÃ¨bre","Aigle","Faucon","Loutre","Castor",
    "Grenouille","Serpent","Souris","Poisson","HÃ©risson"
  ],
  "Villes": [
    "Paris","Londres","Tokyo","Osaka","New York","Los Angeles","Rome","AthÃ¨nes",
    "Madrid","Barcelone","Berlin","Munich","Rio","SÃ£o Paulo","Sydney","Melbourne",
    "MontrÃ©al","Toronto","Le Caire","Alexandrie","DubaÃ¯","Abu Dhabi","Manchester"
  ],
  "Pays": [
    "France","Japon","BrÃ©sil","Canada","Ã‰gypte","Italie","Espagne","Allemagne",
    "Australie","Maroc","Mexique","Ã‰tats-Unis","Chine","Inde","Royaume-Uni"
  ],
  "Sports": [
    "Football","Rugby","Tennis","Badminton","Basket","Handball","Boxe","Kung-fu",
    "Formule 1","Rallye","Surf","Voile","Cyclisme","VTT (VÃ©lo tout-terrain)","Ski","Snowboard","Golf",
    "Cricket","Danse"
  ],
  "Objets": [
    "Chaise","Tabouret","Table","Bureau","TÃ©lÃ©phone","Tablette","Ordinateur","Console",
    "ClÃ©","Serrure","Lampe","Bougie","Valise","Sac Ã  Dos","Montre","Bracelet","Lunettes",
    "Casque","Stylo","Crayon","Tasse","Verre","Ciseaux","Cutter"
  ],
  "Nature": [
    "Plage","Montagne","ForÃªt","DÃ©sert","Lac","RiviÃ¨re","ÃŽle","Continent","Volcan",
    "Glacier","Cascade","Geyser","Ciel","OcÃ©an","Soleil","Lune"
  ],
  "MÃ©tiers": [
    "MÃ©decin","Infirmier","Professeur","Pompier","Policier","Cuisinier",
    "Serveur","Pilote","HÃ´tesse de l'Air","Architecte","IngÃ©nieur",
    "Boulanger","Plombier","Ã‰lectricien","VÃ©tÃ©rinaire"
  ],
  "Transports": [
    "Voiture","Moto","Bus","Tram","Train","MÃ©tro","Avion","HÃ©licoptÃ¨re","Bateau",
    "Voilier","VÃ©lo","Trottinette","Jet-sky","Sous-marin","MongolfiÃ¨re","Deltaplane"
  ],
  "Couleurs Formes": [
    "Rouge","Orange","Bleu","Cyan","Vert","Vert citron","Noir","Gris","Blanc","Ivoire",
    "Cercle","Ellipse","CarrÃ©","Rectangle","Triangle","Pyramide"
  ],
  "CinÃ©ma": [
    "Star Wars","Harry Potter","Le Seigneur des Anneaux","Marvel","DC Comics","Batman",
    "Superman","Iron Man","Captain America","Avengers","Black Panther","Doctor Strange",
    "Spider-Man","Hulk","Joker","Wonder Woman","Aquaman","The Flash","Avatar","Titanic",
    "Jurassic Park","Jurassic World","Indiana Jones","Matrix","Inception","Interstellar",
    "Le Roi Lion","La Reine des Neiges","Toy Story","Cars","Coco","Vice-Versa","Les Indestructibles"
  ],
  "Manga": [
    "Naruto","One Piece","Dragon Ball","Bleach","PokÃ©mon","My Hero Academia","Attack on Titan",
    "Death Note","Fullmetal Alchemist","One Punch Man","Demon Slayer","Jujutsu Kaisen",
    "Hunter x Hunter","Fairy Tail","Black Clover","Chainsaw Man"
  ],
  "PersonnalitÃ©s": [
    "BeyoncÃ©","Rihanna","Cristiano Ronaldo","Lionel Messi","Taylor Swift","Ariana Grande",
    "Keanu Reeves","Tom Cruise","Elon Musk","Jeff Bezos","Drake","The Weeknd","Shakira",
    "Eminem","Adele","Lady Gaga","Robert Downey Jr.","Chris Hemsworth","Scarlett Johansson",
    "Zendaya","Dwayne Johnson","Jason Momoa","Serena Williams","Roger Federer","Michael Jordan",
    "Usain Bolt","Lewis Hamilton"
  ],
  "Marques": [
    "Apple","Samsung","Xiaomi","Sony","Dell","HP","JBL","Lenovo","BMW","Mercedes","Audi",
    "Tesla","Toyota","Honda","Peugeot","Renault","Ford","Ferrari","Lamborghini","Adidas",
    "Nike","Puma","Reebok","Lacoste","Coca-Cola","Pepsi","NestlÃ©","Red Bull","Starbucks",
    "Nutella","McDonaldâ€™s","Burger King","KFC"
  ]
};
const CLUSTERS = {
  "Couleurs Formes": [
    ["Rouge","Orange","Bleu","Cyan","Vert","Vert citron","Noir","Gris","Blanc","Ivoire"],
    ["Cercle","Ellipse","CarrÃ©","Rectangle","Triangle","Pyramide"]
  ],
  "Fruits Fleurs LÃ©gumes": [
    ["Mangue","Papaye","Ananas","Banane","Pomme","Poire","Raisin","Myrtille","PastÃ¨que","Melon","Citron","Orange","Kiwi","Fraise","Noix de coco","Corossol"],
    ["Concombre","Tomate","Poivron","Oignons","Laitue","Carotte","Aubergine","Courgette","Basilic"],
    ["Hibiscus","Tipanier (frangipanier)","Rose"]
  ],
  "Animaux": [
    ["Chat","Chien","Kangourou","Panda","Koala","Tigre","Lion","Cheval","ZÃ¨bre","Loutre","Castor","Ours"],
    ["Perroquet","Toucan","Aigle","Faucon"],
    ["Dauphin","Requin","Poisson","Tortue"],
    ["HÃ©risson","Grenouille","Serpent","Souris"]
  ],
  "Transports": [
    ["Voiture","Moto","Bus","Tram","Train","MÃ©tro","Trottinette","VÃ©lo"],
    ["Avion","HÃ©licoptÃ¨re","MongolfiÃ¨re","Deltaplane"],
    ["Voilier","Jet-sky","Sous-marin","Ferry"]
  ],
  "Sports": [
    ["Football","Rugby","Basket","Handball"],
    ["Tennis","Badminton","Golf","Cricket"],
    ["Boxe","Kung-fu","Danse","KaratÃ©"],
    ["Formule 1","Rallye","Surf","Voile","Cyclisme","VTT (VÃ©lo tout-terrain)","Ski","Snowboard"]
  ]
};
const CLUSTER_LABELS = {
  "Fruits Fleurs LÃ©gumes": ["(fruit)","(lÃ©gume)","(fleur)"],
  "Couleurs Formes": ["(couleur)","(forme)"]
};
function labelWordByDomain(word, domain){
  const clusters = CLUSTERS?.[domain];
  const labels = CLUSTER_LABELS?.[domain];
  if (!clusters || !labels) return word;
  for (let i = 0; i < clusters.length && i < labels.length; i++){
    if (clusters[i].includes(word)) return `${word} ${labels[i]}`;
  }
  return word;
}
module.exports = { DOMAINS, CLUSTERS, CLUSTER_LABELS, labelWordByDomain };


--- FICHIER : routes/sockets/state/room.js ---
// --- sockets/state/room.js ---
const { genCode } = require('../utils/random');

// code -> room
const rooms = new Map();

/**
 * CrÃ©e une salle et initialise tous les Ã©tats.
 * - players: Map<socketId, { name, hint, vote, isImpostor, score, deviceId? }>
 * - active:  Set<socketId> (joueurs comptabilisÃ©s pour la manche en cours)
 * - lobbies & timers gÃ©rÃ©s par index.js / timer.js
 */
function createRoom(hostId, hostName) {
  let code;
  do { code = genCode(); } while (rooms.has(code));

  const r = {
    hostId,
    state: 'lobby',
    round: 0,
    words: null,

    players: new Map(),      // tous les connectÃ©s dans la salle
    active:  new Set(),      // sous-ensemble comptÃ© pour la manche courante

    lastDomain: null,
    lastCommon: null,

    timer: { interval: null, deadline: 0, phase: null },

    lobbyReady: new Set(),
    readyNext:  new Set(),
    used:       {},

    impostor: null,
  };

  r.players.set(hostId, {
    name: hostName,
    hint: null,
    vote: null,
    isImpostor: false,
    score: 0,
  });

  rooms.set(code, r);
  return code;
}

/**
 * Snapshot minimal envoyÃ© aux clients pour lâ€™UI de base.
 */
function snapshot(code) {
  const r = rooms.get(code);
  if (!r) return null;

  const players = Array.from(r.players.entries()).map(([id, p]) => ({
    id,
    name:  p.name,
    score: p.score,
    disconnected: !!p.disconnected,
    spectator: !!p.spectator,
    ready: r.lobbyReady.has(id),
    active: r.active.has(id),
  }));

  return {
    code,
    state: r.state,
    round: r.round,
    players,
  };
}

/**
 * Broadcast un snapshot standard Ã  toute la salle.
 */
function broadcast(io, code) {
  const s = snapshot(code);
  if (s) io.to(code).emit('roomState', s);
}

module.exports = { rooms, createRoom, snapshot, broadcast };



--- FICHIER : routes/sockets/utils/random.js ---
// --- sockets/utils/random.js ---
const CODE_CHARS = '0123456789';
const CODE_LENGTH = 4;
const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];
const genCode = () => Array.from({ length: CODE_LENGTH }, () => CODE_CHARS[Math.floor(Math.random() * CODE_CHARS.length)]).join('');
module.exports = { pick, genCode };



--- FICHIER : utils/hlrank.js ---
// utils/hlrank.js
// routes/utils/hlrank.js
// Paliers HL Rank + pÃ©nalitÃ©s

function getHlRank(rp) {
  if (rp >= 200) return 'MaÃ®tre';
  if (rp >= 150) return 'Diamant';
  if (rp >= 120) return 'Or';
  if (rp >= 80)  return 'Argent';
  if (rp >= 40)  return 'Bronze';
  return 'Novice';
}

function getPenaltyByRank(rank) {
  switch(rank) {
    case 'MaÃ®tre':   return 5;
    case 'Diamant':  return 4;
    case 'Or':       return 3;
    case 'Argent':   return 2;
    case 'Bronze':   return 1;
    case 'Novice':   return 0;
    default: return 0;
  }
}

module.exports = { getHlRank, getPenaltyByRank };

/**
 * Calcule les updates de fin de partie pour TOUS les joueurs.
 * - On applique la pÃ©nalitÃ© Ã  tous sauf au vainqueur.
 * - La pÃ©nalitÃ© est basÃ©e sur le RANG AVANT mise Ã  jour.
 *
 * @param {Array} players - Liste des joueurs de la partie, format:
 *   {
 *     id: string,          // identifiant stable (deviceId, userIdâ€¦)
 *     pseudo: string,
 *     rp_total: number,    // total AVANT cette partie (HL Points cumulÃ©s)
 *     earned: number       // points gagnÃ©s pendant la partie (ton systÃ¨me actuel)
 *   }
 * @param {string} winnerId - id du vainqueur (celui qui atteint 10 en premier)
 * @param {Object} [opts]
 *   @param {boolean} [opts.clampMinZero=true] - empÃªche de passer sous 0
 *
 * @returns {Array} updates - une ligne par joueur :
 *   {
 *     id, pseudo,
 *     rp_before, rp_gain, penalty, rp_after,
 *     rank_before, rank_after,
 *     victoires_inc, parties_inc
 *   }
 */
function computeEndgameUpdates(players, winnerId, opts = {}) {
  const { clampMinZero = true } = opts;

  return players.map(p => {
    const rp_before = Number(p.rp_total) || 0;
    const rank_before = getHlRank(rp_before);
    const isWinner = p.id === winnerId;

    const rp_gain = Number(p.earned) || 0;            // points gagnÃ©s pendant la partie (dÃ©jÃ  selon tes rÃ¨gles actuelles)
    const penalty  = isWinner ? 0 : getPenaltyByRank(rank_before);

    let rp_after = rp_before + rp_gain - penalty;
    if (clampMinZero && rp_after < 0) rp_after = 0;

    const rank_after = getHlRank(rp_after);

    return {
      id: p.id,
      pseudo: p.pseudo || '',
      rp_before,
      rp_gain,
      penalty,
      rp_after,
      rank_before,
      rank_after,
      victoires_inc: isWinner ? 1 : 0,
      parties_inc: 1,
      isWinner
    };
  });
}

module.exports = {
  getHlRank,
  getPenaltyByRank,
  computeEndgameUpdates,
};



--- FICHIER : public/index.html ---
<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hint or Lie Â· by Mits</title>

    <link rel="prefetch" href="/images/background-hero.svg?v=1" as="image" type="image/svg+xml">
    <script defer src="/socket.io/socket.io.js"></script>

    <link rel="manifest" href="/manifest.json">
    
    <link rel="stylesheet" href="/css/hud.css">
    <link rel="stylesheet" href="/css/99-pwa-update.css">
    <link rel="stylesheet" href="/css/98-responsive.css">

    <meta name="theme-color" content="#0a0e14">
    <link rel="icon" type="image/png" href="/icons/icon-32.png">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
</head>
<body>

    <main id="game-container">
        <!-- Ã‰cran d'accueil -->
        <section id="screen-home" class="screen">
            <div class="panel">
                <h1 class="game-title">Hint <span>or</span> Lie</h1>
                <div class="tabs">
                    <button id="tab-create" role="tab" aria-selected="true">CrÃ©er une salle</button>
                    <button id="tab-join" role="tab" aria-selected="false">Rejoindre</button>
                </div>

                <!-- Pane: CrÃ©er une salle -->
                <div id="pane-create" class="tab-pane active">
                    <div class="avatar-picker">
                        <img id="avatar-preview-img-create" src="https://api.dicebear.com/7.x/bottts/svg?seed=Joueur&backgroundColor=b6e3f4,c0aede,d1d4f9" alt="Avatar Preview">
                    </div>
                    <input type="text" id="name-create" placeholder="Entrez votre pseudo" maxlength="16">
                    <button id="btn-create" class="btn btn-primary">CrÃ©er</button>
                </div>

                <!-- Pane: Rejoindre une salle -->
                <div id="pane-join" class="tab-pane">
                    <div class="avatar-picker">
                        <img id="avatar-preview-img-join" src="https://api.dicebear.com/7.x/bottts/svg?seed=Joueur&backgroundColor=b6e3f4,c0aede,d1d4f9" alt="Avatar Preview">
                    </div>
                    <input type="text" id="name-join" placeholder="Entrez votre pseudo" maxlength="16">
                    <input type="text" id="join-code" placeholder="Code (4 chiffres)" inputmode="numeric" maxlength="4">
                    <button id="btn-join" class="btn btn-primary">Rejoindre</button>
                </div>
                 <div class="rules-container">
                    <button id="btn-how" class="btn btn-secondary">RÃ¨gles rapides</button>
                    <div id="how" style="display: none;">
                        <p><strong>But du jeu :</strong> L'imposteur doit se fondre parmi les Ã©quipiers.</p>
                        <ul>
                            <li><strong>Ã‰quipiers :</strong> Vous recevez un mot secret. Donnez un indice (un seul mot) pour le faire deviner aux autres.</li>
                            <li><strong>Imposteur :</strong> Vous n'avez pas le mot. Soyez malin, Ã©coutez les indices des autres et bluffez !</li>
                            <li><strong>Vote :</strong> Tout le monde vote pour dÃ©masquer l'imposteur.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Ã‰cran Lobby/Salle d'attente -->
        <section id="screen-lobby" class="screen" style="display: none;">
            <header class="lobby-header">
                <button id="btn-back-home" class="btn btn-secondary">&lt; Quitter</button>
                <div class="lobby-code-container">
                    <span>CODE</span>
                    <strong id="lobby-code">1234</strong>
                </div>
                <div id="lobby-ready-pill">0/0 prÃªts</div>
            </header>
            
            <h2>Joueurs connectÃ©s</h2>
            <div id="players" class="player-grid">
                <!-- Les cartes des joueurs seront injectÃ©es ici par le JS -->
            </div>

            <div class="lobby-actions">
                <button id="btn-ready" class="btn btn-primary">Je suis prÃªt</button>
                <div id="timer-lobby" style="display: none;"></div>
            </div>
        </section>

        <!-- Autres Ã©crans (vides pour l'instant, mais avec les IDs requis) -->
        <section id="screen-hint" class="screen" style="display: none;"></section>
        <section id="screen-vote" class="screen" style="display: none;"></section>
        <section id="screen-result" class="screen" style="display: none;"></section>
        
        <!-- Toasts / Notifications -->
        <div id="toast"></div>

        <!-- IDs requis par guard.js mais non visibles/utilisÃ©s dans le lobby -->
        <div style="display: none;">
            <input id="hint-input">
            <button id="btn-send-hint"></button>
            <div id="hint-status"></div>
            <div id="impostor-tip"></div>
            <div id="hint-instruction"></div>
            <div id="vote-buttons"></div>
            <div id="hints"></div>
            <div id="scoreboard"></div>
            <ul id="score-list"></ul>
            <div id="round-num"></div>
            <div id="timer-hints"></div>
            <div id="timer-vote"></div>
            <div id="timer-reveal"></div>
        </div>

    </main>
    
    <div id="update-banner" style="display:none;"></div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <script defer src="/js/core/dom.js"></script>
    <script defer src="/js/core/helpers.js"></script>
    <script defer src="/js/core/state.js"></script>
    <script defer src="/js/core/socket.js"></script>
  
    <script defer src="/js/features/leaderboard.js"></script>
    <script defer src="/js/features/home.js"></script>
    <script defer src="/js/features/hints.js"></script>
    <script defer src="/js/features/vote.js"></script>
    <script defer src="/js/features/results.js"></script>
    
    <script defer src="/js/pwa/update.js"></script>
    <script defer src="/js/dev/guard.js"></script>
    
    <script defer src="/js/main.js"></script>

</body>
</html>



--- FICHIER : public/manifest.json ---
{
  "name": "Hint or Lie",
  "short_name": "Hint or Lie",
  "start_url": "/",
  "scope": "/",
  "display": "standalone",
  "background_color": "#0f0b14",
  "theme_color": "#0f0b14",
  "icons": [
    { "src": "/icons/icon-192.png",      "sizes": "192x192", "type": "image/png", "purpose": "any" },
    { "src": "/icons/icon-512.png",      "sizes": "512x512", "type": "image/png", "purpose": "any" },
    { "src": "/icons/maskable-192.png",  "sizes": "192x192", "type": "image/png", "purpose": "any maskable" },
    { "src": "/icons/maskable-512.png",  "sizes": "512x512", "type": "image/png", "purpose": "any maskable" }
  ]
}



--- FICHIER : public/sw.js ---
// --- Service Worker : Hint or Lie -------------------------------------------
// âš ï¸ BUMPER LA VERSION Ã€ CHAQUE DEPLOIEMENT (dÃ©clenche la mise Ã  jour PWA)
const CACHE = 'hol-v38';

// Liste des assets Ã  prÃ©cacher (shell). Ajoute ici ce qui doit marcher offline.
const ASSETS = [
  '/',                // shell de nav
  '/index.html',
  '/style.css',

  // Images/icÃ´nes/manifest
  '/images/background-hero.svg?v=1', // <-- tu charges cette URL dans le CSS
  '/icons/icon-192.png',
  '/icons/icon-512.png',
  '/manifest.json',

  // CSS split
  '/css/01-tokens.css',
  '/css/02-base.css',
  '/css/03-components.css',
  '/css/04-phase.css',
  '/css/05-hints.css',
  '/css/06-vote.css',
  '/css/07-modal-score.css',
  '/css/98-responsive.css',
  '/css/99-pwa-update.css', // garde si tu utilises le bandeau de MAJ

 '/js/core/dom.js','/js/core/state.js','/js/core/socket.js',
  '/js/features/home.js','/js/features/hints.js','/js/features/vote.js',
  '/js/features/results.js','/js/features/leaderboard.js',
  '/js/pwa/update.js','/js/main.js',
];
// ---------------------------------------------------------------------------
// INSTALL : prÃ©-cache + passe immÃ©diatement en waiting
self.addEventListener('install', (event) => {
  event.waitUntil(
    caches.open(CACHE).then((cache) => cache.addAll(ASSETS))
  );
  self.skipWaiting();
});

// ACTIVATE : nettoyage des anciens caches + prise de contrÃ´le immÃ©diate
self.addEventListener('activate', (event) => {
  event.waitUntil(
    (async () => {
      const names = await caches.keys();
      await Promise.all(
        names.filter((n) => n !== CACHE).map((n) => caches.delete(n))
      );
      await self.clients.claim();
    })()
  );
});

// Messages depuis la page (ex: bouton "Mettre Ã  jour")
self.addEventListener('message', (event) => {
  const type = event?.data?.type;
  if (type === 'SKIP_WAITING') {
    self.skipWaiting();
  }
  if (type === 'GET_VERSION') {
    event.source?.postMessage({ type: 'SW_VERSION', cache: CACHE });
  }
});

// ---------------------------------------------------------------------------
// FETCH : stratÃ©gies par type de ressource
self.addEventListener('fetch', (event) => {
  const req = event.request;

  // On ne s'occupe que des requÃªtes mÃªme origine
  const url = new URL(req.url);
  if (url.origin !== self.location.origin) return;

  // 1) NAVIGATIONS : network-first avec fallback sur index.html du cache
  if (req.mode === 'navigate') {
    event.respondWith(networkFirstForNavigation(req));
    return;
  }

  // 2) CSS & JS : stale-while-revalidate (rapide + rafraÃ®chi en arriÃ¨re-plan)
  if (req.destination === 'style' || req.destination === 'script') {
    event.respondWith(staleWhileRevalidate(req));
    return;
  }

  // 3) IMAGES / FONTS / AUTRES : cache-first
  if (
    req.destination === 'image' ||
    req.destination === 'font' ||
    req.destination === 'manifest'
  ) {
    event.respondWith(cacheFirst(req));
    return;
  }

  // Par dÃ©faut : passe-through
});

// ---------------------------------------------------------------------------
// Helpers de stratÃ©gie

async function networkFirstForNavigation(req) {
  const cache = await caches.open(CACHE);
  try {
    // on tente la derniÃ¨re version en ligne
    const fresh = await fetch(req, { cache: 'no-store' });
    // on garde aussi une copie d'index.html pour le mode offline
    // (on met la vraie ressource en cache sous sa clÃ© d'URL)
    cache.put(req, fresh.clone());
    return fresh;
  } catch {
    // offline : on retombe sur le shell
    return (
      (await cache.match('/')) ||
      (await cache.match('/index.html')) ||
      Response.error()
    );
  }
}

async function staleWhileRevalidate(req) {
  const cache = await caches.open(CACHE);
  const cached = await cache.match(req);
  const fetchAndUpdate = fetch(req)
    .then((res) => {
      cache.put(req, res.clone());
      return res;
    })
    .catch(() => undefined);
  return cached || fetchAndUpdate || fetch(req);
}

async function cacheFirst(req) {
  const cache = await caches.open(CACHE);
  const cached = await cache.match(req);
  return cached || fetch(req).then((res) => {
    cache.put(req, res.clone());
    return res;
  });
}



